import{N as $,z as F,a5 as S,y as m}from"./BLczYTEp.js";const A="$s";function p(...e){const o=typeof e[e.length-1]=="string"?e.pop():void 0;typeof e[0]!="string"&&e.unshift(o);const[t,s]=e;if(!t||typeof t!="string")throw new TypeError("[nuxt] [useState] key must be a string: "+t);if(s!==void 0&&typeof s!="function")throw new Error("[nuxt] [useState] init must be a function: "+s);const a=A+t,u=$(),h=F(u.payload.state,a);if(h.value===void 0&&s){const d=s();if(S(d))return u.payload.state[a]=d,d;h.value=d}return h}const l=()=>async(o,t={})=>{const s=localStorage.getItem("user_token");if(s)t.headers={...t.headers,Authorization:`Basic ${s}`};else return m("/login"),Promise.reject(new Error("Unauthorized"));try{return await $fetch(o,t)}catch(a){return Promise.reject(a)}},i="/api",D=()=>{const e=p("user",()=>({auth:!1,userId:"",username:"",role:"",region:""}));async function o(){try{const a=await l()(`${i}/auth`);Object.assign(e.value,{auth:!0,userId:a.id,username:a.username,role:a.role,region:a.region}),await b().getClassify(),m("/persons")}catch(t){console.error(t),m("/login")}}return{user:e,getCurrentUser:o}},b=()=>{const e=p(`${i}/classes`,()=>({regions:{},conclusions:{},relations:{},affilations:{},educations:{},addresses:{},contacts:{},documents:{},poligrafs:{},roles:{}}));async function o(){const s=await $fetch(`${i}/classes`),a=Object.keys(e.value);for(let u=0;u<a.length;u++)e.value[a[u]]=s[u]}return{classes:e,getClassify:o}},k=()=>{const e=p("alertMessage",()=>({attr:"",text:"",show:!1,timeOut:0}));function o(t,s){window.clearTimeout(e.value.timeOut),Object.assign(e.value,{show:!0,attr:t,text:s,timeOut:window.setTimeout(()=>{e.value.show=!1},1e4)})}return{alertMessage:e,setAlert:o}},I=()=>{const e=p(`${i}/persons`,()=>({candidates:[],page:1,prev:!1,next:!0,search:"",updated:`${new Date().toLocaleDateString("ru-RU")} в ${new Date().toLocaleTimeString("ru-RU")}`}));async function o(t=1){if(e.value.page<1){e.value.page=1;return}else e.value.page=t;const s=l();try{const a=await s(`${i}/index/${e.value.page}`,{params:{search:e.value.search}});[e.value.candidates,e.value.next,e.value.prev]=a,e.value.updated=`${new Date().toLocaleDateString("ru-RU")} в ${new Date().toLocaleTimeString("ru-RU")}`}catch(a){console.error(a)}}return{persons:e,getCandidates:o}},O=()=>{const e=k(),o=p("anketa",()=>({persons:{},previous:[],educations:[],staffs:[],documents:[],addresses:[],contacts:[],relations:[],workplaces:[],affilations:[],checks:[],poligrafs:[],investigations:[],inquiries:[]})),t=p("share",()=>({candId:"",imageUrl:""}));async function s(r,n="view"){if(!(n==="self"&&!confirm("Вы действительно хотите включить/выключить режим правки")))try{const f=await l()(`${i}/${r}/${t.value.candId}`,{params:{action:n}});o.value[r]=f,n==="self"&&e.setAlert("alert-info","Режим проверки включен/отключен")}catch(c){console.error(c)}}async function a(){const r=await $fetch(`${i}/image`,{params:{image:o.value.persons.destination},responseType:"blob"});t.value.imageUrl=window.URL.createObjectURL(new Blob([r]))}async function u(){if(confirm("Вы действительно хотите изменить регион?"))try{const n=await l()(`${i}/region/${t.value.candId}`,{params:{region:o.value.persons.region}});s("persons")}catch(r){console.error(r)}}async function h(r,n){try{const f=await l()(`${i}/${r}/${t.value.candId}`,{method:"POST",body:n});s(r),e.setAlert("alert-success","Запись успешно добавлена")}catch(c){console.error(c)}}async function d(r,n){if(confirm("Вы действительно хотите удалить запись?"))try{const f=await l()(`${i}/${n}/${r}`,{method:"DELETE"});n==="persons"?m("/persons"):s(n),e.setAlert("alert-info",`Запись с ID ${r} удалена`)}catch(c){console.error(c)}}async function w(r,n,c){const f=new FormData,g=r.target;if(g&&g.files){for(let y of g.files)y.size<1024*1024*2&&f.append("file",y);try{const T=await l()(`${i}/file/${n}/${c}`,{method:"POST",body:f});n==="persons"?I().getCandidates(1):n==="image"?a():s(n==="anketa"?"persons":n),e.setAlert("alert-success","Файл или файлы успешно загружены")}catch(y){console.error(y)}}else e.setAlert("alert-warning","Ошибка при загрузке файла")}async function v(r,n){if(r=="create")try{const g=await l()(`${i}/resume`,{method:"POST",body:n});m({name:"profile",params:{id:g}}),e.setAlert("alert-success","Данные успешно добавлены")}catch(c){e.setAlert("alert-danger",`Возникла ошибка ${c}`)}else h("persons",n)}return{anketa:o,share:t,getItem:s,changeRegion:u,updateItem:h,deleteItem:d,submitFile:w,submitResume:v,getImage:a}};export{b as a,i as b,k as c,O as d,I as e,D as s,l as u};
