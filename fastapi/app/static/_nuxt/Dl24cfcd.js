import{_ as M}from"./CvFgdwu2.js";import{_ as T}from"./D7oK4O0D.js";import{_ as j}from"./CFhYP7_a.js";import{_ as F}from"./B4Od5mi1.js";import{_ as N}from"./DZZmJpvd.js";import{_ as O}from"./S6Pj9w_i.js";import{_ as R}from"./D-aUaadV.js";import{f as A,o as b,c as w,a as e,A as W,g as z,B as G,r as H,h as q,w as n,b as s,m as J,x as K,l as k,j as f,i as P,F as Q,d,t as a,p as X,e as Y}from"./BLczYTEp.js";import{_ as Z}from"./DVqmOnQS.js";import{d as ee}from"./Dot1e486.js";import{a as te,c as le,u as v,b as h}from"./CRlNADb7.js";import{_ as oe}from"./DlAUqK2U.js";import"./DISlfMCt.js";const se=["id"],ae={class:"modal-dialog"},ne={class:"modal-content"},re={class:"modal-body"},ce=A({__name:"ModalWin",props:{elemId:String},setup(i){const m=i;return(u,y)=>(b(),w("div",{class:"modal modal fade",id:m.elemId,tabindex:"-1"},[e("div",ae,[e("div",ne,[e("div",re,[W(u.$slots,"default")])])])],8,se))}}),g=i=>(X("data-v-03b1c01a"),i=i(),Y(),i),de={class:"row mb-3"},ie={class:"d-flex justify-content-between"},ue={class:"dropdown"},me=g(()=>e("button",{class:"btn btn-link text-secondary dropdown-toogle",type:"button","data-bs-toggle":"dropdown"}," Добавить пользователя ",-1)),pe={class:"dropdown-menu"},_e={class:"p-3"},fe={class:"mb-3"},be={class:"mb-3"},ve=g(()=>e("tr",null,[e("th",{width:"5%"},"#"),e("th",null,"Имя пользователя"),e("th",{width:"15%"},"Логин"),e("th",{width:"10%"},"Блокировка"),e("th",{width:"15%"},"Создан"),e("th",{width:"15%"},"Роль"),e("th",{width:"20%"},"Регион")],-1)),he={colspan:"7"},we={width:"5%"},ge={width:"15%"},ye=["onClick"],$e={width:"10%"},Ve={width:"15%"},Se={width:"15%"},xe={width:"20%"},De={class:"p-3"},ke={class:"btn-group p-3",role:"group"},Ae=g(()=>e("button",{type:"button",class:"btn btn-outline-primary","data-bs-dismiss":"modal"}," Закрыть ",-1)),Ue=A({__name:"users",setup(i){const m=te(),u=le();z(async()=>{await p()});const y=G(()=>t.value.users.filter(r=>r.deleted==t.value.viewDeleted)),t=H({search:"",users:[],profile:{},form:{},viewDeleted:!1});async function p(){try{const l=await v()(`${h}/users`,{params:{search:t.value.search}});t.value.users=l}catch(r){console.error(r)}}const $=ee(()=>{p()},500);async function _(r){if(!(r==="delete"&&!confirm("Вы действительно хотите удалить/восстановить пользователя?")))try{const V=await v()(`${h}/users/${t.value.profile.id}`,{params:{item:r}});p()}catch(l){u.setAlert("alert-warning","Невозможно выполнить операцию"),console.error(l)}}async function U(){try{const l=await v()(`${h}/users`,t.value.form);u.setAlert("alert-success","Пользователь успешно создан"),E(),p()}catch(r){u.setAlert("alert-warning","Возможно, пользователь уже существует"),console.error(r)}}function E(){Object.keys(t.value.profile).forEach(r=>delete t.value[r])}return(r,l)=>{const V=M,C=T,S=j,I=F,x=N,c=O,D=R,B=ce,L=Z;return b(),q(L,null,{default:n(()=>[s(V,{"page-header":"Список пользователей",cls:"text-secondary py-5"}),e("div",de,[J(e("input",{onInput:l[0]||(l[0]=k((...o)=>f($)&&f($)(...o),["prevent"])),class:"form-control mb-3",name:"search",id:"search",type:"text",placeholder:"Поиск по имени пользователя","onUpdate:modelValue":l[1]||(l[1]=o=>t.value.search=o)},null,544),[[K,t.value.search]])]),e("div",ie,[s(C,{name:"viewDeleted",label:"Показать удаленные",modelValue:t.value.viewDeleted,"onUpdate:modelValue":l[2]||(l[2]=o=>t.value.viewDeleted=o)},null,8,["modelValue"]),e("div",ue,[me,e("div",pe,[e("form",{onSubmit:k(U,["prevent"]),class:"form form-check"},[e("div",_e,[e("div",fe,[s(S,{name:"fullname",place:"Имя пользователя",need:!0,modelValue:t.value.form.fullname,"onUpdate:modelValue":l[3]||(l[3]=o=>t.value.form.fullname=o)},null,8,["modelValue"])]),e("div",be,[s(S,{name:"username",place:"Учетная запись",pattern:"[a-z_]+",need:!0,modelValue:t.value.form.username,"onUpdate:modelValue":l[4]||(l[4]=o=>t.value.form.username=o)},null,8,["modelValue"])]),s(I,{offset:!1})])],32)])])]),s(x,{"tbl-class":"table align-middle"},{thead:n(()=>[ve]),tbody:n(()=>[e("tr",null,[e("td",he,[s(x,{id:"overflow","tbl-class":"table table-hover align-middle no-bottom-border"},{tbody:n(()=>[(b(!0),w(Q,null,P(y.value,o=>(b(),w("tr",{height:"50px",key:o.id},[e("td",we,a(o.id),1),e("td",null,a(o.fullname),1),e("td",ge,[e("button",{class:"btn btn-link text-secondary",type:"button","data-bs-toggle":"modal","data-bs-target":"#user-modal",onClick:Ee=>t.value.profile=o},a(o.username),9,ye)]),e("td",$e,a(o.blocked?"Да":"Нет"),1),e("td",Ve,a(new Date(o.pswd_create).toLocaleString()),1),e("td",Se,a(o.role),1),e("td",xe,a(o.region),1)]))),128))]),_:1})])])]),_:1}),s(B,{"elem-id":"user-modal"},{default:n(()=>[e("div",De,[s(c,{"label-class":"col-5","input-class":"col-7",label:"ID"},{default:n(()=>[d(a(t.value.profile.id),1)]),_:1}),s(c,{label:"Регион","label-class":"col-5","input-class":"col-7"},{default:n(()=>[s(D,{name:"region",select:f(m).classes.value.regions,modelValue:t.value.profile.region,"onUpdate:modelValue":l[5]||(l[5]=o=>t.value.profile.region=o),onSubmitData:l[6]||(l[6]=o=>_(t.value.profile.region))},null,8,["select","modelValue"])]),_:1}),s(c,{label:"Роль","label-class":"col-5","input-class":"col-7"},{default:n(()=>[s(D,{name:"role",select:f(m).classes.value.roles,modelValue:t.value.profile.role,"onUpdate:modelValue":l[7]||(l[7]=o=>t.value.profile.role=o),onSubmitData:l[8]||(l[8]=o=>_(t.value.profile.role))},null,8,["select","modelValue"])]),_:1}),s(c,{"label-class":"col-5","input-class":"col-7",label:"Имя пользователя"},{default:n(()=>[d(a(t.value.profile.fullname),1)]),_:1}),s(c,{"label-class":"col-5","input-class":"col-7",label:"Логин"},{default:n(()=>[d(a(t.value.profile.username),1)]),_:1}),s(c,{"label-class":"col-5","input-class":"col-7",label:"Дата создания пароля"},{default:n(()=>[d(a(new Date(t.value.profile.pswd_create+" UTC").toLocaleString("ru-RU")),1)]),_:1}),s(c,{"label-class":"col-5","input-class":"col-7",label:"Требует смены пароля"},{default:n(()=>[d(a(t.value.profile.change_pswd?"Да":"Нет"),1)]),_:1}),s(c,{"label-class":"col-5","input-class":"col-7",label:"Попытки входа"},{default:n(()=>[d(a(t.value.profile.attempt),1)]),_:1}),s(c,{"label-class":"col-5","input-class":"col-7",label:"Заблокирован"},{default:n(()=>[d(a(t.value.profile.blocked?"Заблокирован":"Разблокирован"),1)]),_:1}),s(c,{"label-class":"col-5","input-class":"col-7",label:"Активность"},{default:n(()=>[d(a(t.value.profile.deleted?"Удален":"Активен"),1)]),_:1}),s(c,{"label-class":"col-5","input-class":"col-7",label:"Роль"},{default:n(()=>[d(a(t.value.profile.role),1)]),_:1}),s(c,{"label-class":"col-5","input-class":"col-7",label:"Дата создания профиля"},{default:n(()=>[d(a(new Date(t.value.profile.created+" UTC").toLocaleString("ru-RU")),1)]),_:1})]),e("div",ke,[e("button",{onClick:l[9]||(l[9]=o=>_("drop")),type:"button",class:"btn btn-outline-secondary"}," Сбросить пароль "),e("button",{onClick:l[10]||(l[10]=o=>_("delete")),type:"button",class:"btn btn-outline-danger"},a(t.value.profile.deleted?"Восстановить":"Отметить к удалению"),1),Ae])]),_:1})]),_:1})}}}),Ge=oe(Ue,[["__scopeId","data-v-03b1c01a"]]);export{Ge as default};
