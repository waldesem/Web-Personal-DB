{% from "elements.html.jinja" import select_macro %}

<div class="row py-3">  
  <table class="table table-sm">
    <thead>
      <tr>
        <th width="5%">#</th>
        <th width="13%">Пользователь</th>
        <th width="11%">Логин</th>
        <th width="13%">Регион</th>
        <th width="13%">Роль</th>
        <th width="10%">Обновлен</th>
        <th width="7%">Попытки</th>
        <th width="7%">Блок</th>
        <th width="7%">Удален</th>
        <th width="7%">Изменение</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td colspan="10">
          <table
            class="table table-sm table-hover align-middle"
            style="max-height: 50vh; overflow-y: auto;"
          >
            <caption class="caption-bottom text-left">Список пользователей</caption>
            <tbody>
              {% for user in users %}
              <tr>
                <td width="5%">{{ user.id }}</td>
                <td width="13%" >
                  <div class="dropdown">
                    <button
                      class="btn btn-link text-secondary dropdown-toogle"
                      type="button"
                      data-bs-toggle="dropdown"
                    >
                    {{ user.fullname }}
                    </button>
                      <ul class="dropdown-menu">
                        <li>
                          <button
                            class="btn btn-link dropdown-item"
                            hx-get="{{ url_for('route.take_user', user_id=user.id, item='block') }}"
                            hx-trigger="click"
                            hx-target="#users-info"
                            hx-swap="innerHTML"
                          >
                            Блокировка
                          </button>
                        </li>
                        <li>
                          <button 
                            class="btn btn-link dropdown-item"
                            hx-get="{{ url_for('route.take_user', user_id=user.id, item='drop') }}"
                            hx-trigger="click"
                            hx-target="#users-info"
                            hx-swap="innerHTML" 
                          >
                            Сброс пароля
                          </button>
                        </li>
                        <li>
                          <button 
                            class="btn btn-link dropdown-item"
                            hx-get="{{ url_for('route.take_user', user_id=user.id, item='delete') }}"
                            hx-trigger="click"
                            hx-target="#users-info"
                            hx-swap="innerHTML"
                          > 
                            Удаление
                          </button>
                        </li>
                      </ul>
                  </div>
                </td>
                <td width="11%">{{ user.username }}</td>
                <td width="13%">
                  <form 
                    hx-post="{{ url_for('route.take_user', user_id=user.id) }}"
                    hx-trigger="change"
                    hx-target="#users-info"
                    hx-swap="innerHTML"
                    class="form form-check" 
                    style="padding-left: 0;"
                  >
                    {{ select_macro("region", ["Главный офис", "РЦ Юг", "РЦ Запад", "РЦ Урал", "РЦ Восток"], value=user.region) }}
                  </form>
                </td>
                <td width="13%">
                  <form 
                    hx-post="{{ url_for('route.take_user', user_id=user.id) }}"
                    hx-trigger="change"
                    hx-target="#users-info"
                    hx-swap="innerHTML"
                    class="form form-check"
                    style="padding-left: 0;" 
                  >
                    {{ select_macro("role", ["admin", "user", "guest"], value=user.role) }}
                  </form>
                </td>
                <td width="10%">{{ user.created.strftime("%d.%m.%Y") }}</td>
                <td width="7%">{{ user.attempt }}</td>
                <td width="7%">{{ "Да" if user.blocked else "Нет" }}</td>
                <td width="7%">{{ "Да" if user.deleted else "Нет" }}</td>
                <td width="7%">{{ "Да" if user.change_pswd else "Нет" }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </td>
      </tr>
    </tbody>
  </table>
</div>
