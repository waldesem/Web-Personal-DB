{% from "profile/macros/anketa.html.jinja" import anketa_tab_macro %}
{% from "profile/macros/checks.html.jinja" import check_tab_macro %}
{% from "profile/macros/poligrafs.html.jinja" import poligraf_tab_macro %}
{% from "profile/macros/investigations.html.jinja" import investigation_tab_macro %}
{% from "profile/macros/inquiries.html.jinja" import inquiry_tab_macro %}
{% from "profile/macros/photo.html.jinja" import photo_card_macro %}

{% set tabs = {
  'anketa': ['Анкета', anketa_tab_macro(person['persons']['id'], person, person['persons']['isbusy'])],
  'checks': ['Проверка', check_tab_macro(person['persons']['id'], person['checks'], person['persons']['isbusy'])],
  'poligrafs': ['Полиграф', poligraf_tab_macro(person['persons']['id'], person['poligrafs'], person['persons']['isbusy'])],
  'invesigations': ['Расследования', investigation_tab_macro(person['persons']['id'], person['invesigations'], person['persons']['isbusy'])],
  'inquiries': ['Запросы', inquiry_tab_macro(person['persons']['id'], person['inquiries'], person['persons']['isbusy'])],
} %}

<div id ="photo-card" class="position-relative">
  {{ photo_card_macro(person.persons.destination, person.persons.id, person.persons.isbusy) }}
</div>

<div class="text-opacity-85 text-danger py-5 px-3">
  <h3>{{ person.persons.surname }} {{ person.persons.firstname }} {{ person.persons.patronymic if person.persons.patronymic }}
  </h3>
</div>

{% if session['user']['role'] == 'user' %}
<div class="position-relative">
  <div class="position-absolute bottom-0 end-0">
    <button 
      class="btn btn-link" 
      hx-get="{{ url_for('route.get_profile', person_id=person['persons']['id'], standing = person['persons']['isbusy']  }}" 
      hx-trigger="click"
      hx-target="#staffsec"
      hx-swap="innerHTML"
    >
      <div
        class="spinner-grow spinner-grow text-{{'danger' if person.persons.isbusy else 'success'}}"
        role="status"
        title="{{'Отключить режим проверки' if person.persons.isbusy else 'Включить режим проверки'}}"
      >
    </button>
  </div>
</div>
{% endif %}

<nav>
  <div class="nav nav-tabs nav-justified d-print-none" role="tablist">
    {% for key, values in tabs.items() %}
    <button
      class="nav-link {{ 'active' if key == 'anketa' }}"
      data-bs-target="{{'#' + key}}"
      data-bs-toggle="tab"
      type="button"
      role="tab"
    >
      {{ values[0] }}
    </button>
    {% endfor %}
  </div>
</nav>
<div class="tab-content mb-3">
  {% for key, values in tabs.items() %}
  <div
    id={{key}}
    class="tab-pane fade {{ 'show active' if key   == 'anketa' }} pt-3"
    role="tabpanel"
    tabindex="0"
  >
    {{ values[1] }}
  </div>
  {% endfor %}
</div>
