import{a as g,_ as y}from"./CvFgdwu2.js";import{_ as h}from"./CFhYP7_a.js";import{_ as k}from"./B4Od5mi1.js";import{f as V,r as _,k as x,o as d,c,b as r,a as o,l as $,m as f,v as A,q as S,s as U}from"./BLczYTEp.js";import{c as C,s as D,b as E}from"./CRlNADb7.js";import{_ as B}from"./DlAUqK2U.js";const I={class:"container pt-5"},M={class:"border border-primary rounded p-5"},N={class:"mb-3"},q={class:"input-group mb-3"},P=["type"],F=["title"],G={key:0,class:"bi bi-eye"},H={key:1,class:"bi bi-eye-slash"},L={key:0},O={class:"mb-3"},T={class:"mb-3"},j={class:"row mb-3 col-lg-9"},z=V({__name:"login",setup(J){const l=C(),v=D(),n=_(!1),s=_("create"),t=x({});async function w(){if(n.value=!1,s.value==="update"){if(t.passhash===t.new_pswd){l.setAlert("alert-warning","Старый и новый пароли совпадают");return}if(t.conf_pswd!==t.new_pswd){l.setAlert("alert-warning","Новый пароль и подтверждение не совпадают");return}}try{const i=await $fetch(`${E}/login/${s.value}`,{method:"POST",body:t}),{message:e}=i;switch(e){case"Success":{const{user_token:m}=i;localStorage.setItem("user_token",m),await v.getCurrentUser();break}case"Updated":s.value="create",l.setAlert("alert-success","Войдите с новым паролем");break;case"Denied":s.value="update",l.setAlert("alert-warning","Пароль просрочен");break;default:l.setAlert("alert-warning","Неправильный логин или пароль");break}}catch(i){console.error(i),l.setAlert("alert-warning","Неправильный логин или пароль")}}return(i,e)=>{const m=g,p=y,u=h,b=k;return d(),c("div",I,[r(m),r(p,{cls:"text-danger py-3","page-header":"StaffSec - кадровая безопасность"}),o("div",M,[r(p,{cls:"text-primary mb-3 text-center","page-header":s.value==="create"?"Вход в систему":"Изменить пароль"},null,8,["page-header"]),o("form",{class:"form form-check",onSubmit:$(w,["prevent"])},[o("div",N,[r(u,{need:!0,name:"username",place:"Логин",modelValue:t.username,"onUpdate:modelValue":e[0]||(e[0]=a=>t.username=a)},null,8,["modelValue"])]),o("div",q,[f(o("input",{name:"password",id:"password",type:n.value?"text":"password",class:"form-control",placeholder:"Пароль",required:"","onUpdate:modelValue":e[1]||(e[1]=a=>t.password=a)},null,8,P),[[A,t.password]]),o("button",{class:"btn btn-outline-primary",type:"button",title:n.value?"Скрыть":"Показать",onClick:e[2]||(e[2]=a=>n.value=!n.value)},[n.value?(d(),c("i",H)):(d(),c("i",G))],8,F)]),s.value==="update"?(d(),c("div",L,[o("div",O,[r(u,{need:!0,name:"new_pswd",place:"Новый пароль",min:8,max:16,typeof:n.value?"text":"password",modelValue:t.new_pswd,"onUpdate:modelValue":e[3]||(e[3]=a=>t.new_pswd=a)},null,8,["typeof","modelValue"])]),o("div",T,[r(u,{need:!0,name:"conf_pswd",place:"Повтор пароля",typeof:n.value?"text":"password",modelValue:t.conf_pswd,"onUpdate:modelValue":e[4]||(e[4]=a=>t.conf_pswd=a)},null,8,["typeof","modelValue"])])])):S("",!0),o("div",j,[f(o("a",{class:"link-primary mb-2",href:"#",onClick:e[5]||(e[5]=a=>s.value="update")}," Изменить пароль ",512),[[U,s.value==="create"]])]),r(b,{offset:!1,"submit-btn":s.value==="create"?"Войти":"Изменить",onCancel:e[6]||(e[6]=a=>s.value="create")},null,8,["submit-btn"])],32)])])}}}),Z=B(z,[["__scopeId","data-v-4be6c3b4"]]);export{Z as default};
