import{m as G,K as W,h as V,_ as x,d as O,q as J,t as L,s as A,L as Q,r as b,M as X,o as d,c as m,y as B,D as p,A as f,b as r,g as l,f as g,B as D,E as c,F as Z,G as ee,z as te,C as F,T as ae,N as oe,w as ne,O as se,P as le,n as E,p as ie,e as o,i as re,l as ue,u as de,a as pe,j as ce}from"./DWkXyvYO.js";import{a as me,_ as fe}from"./BxRuhaE2.js";import{_ as ye}from"./C6kt28MM.js";import{_ as z}from"./C5pnJhM4.js";import{u as ve}from"./BfHq33VY.js";import{u as be}from"./DNvdZEfF.js";import{u as ge}from"./LfyFHyhR.js";import{a as _e}from"./BU50ieNN.js";import"./DGXi7NbU.js";import"./b7Pa5xvB.js";const U=G(V.ui.strategy,V.ui.tooltip,W),he=O({components:{UKbd:z},inheritAttrs:!1,props:{text:{type:String,default:null},prevent:{type:Boolean,default:!1},shortcuts:{type:Array,default:()=>[]},openDelay:{type:Number,default:()=>U.default.openDelay},closeDelay:{type:Number,default:()=>U.default.closeDelay},popper:{type:Object,default:()=>({})},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},setup(e){const{ui:n,attrs:k}=J("tooltip",L(e,"ui"),U,L(e,"class")),_=A(()=>Q({},e.popper,n.value.popper)),[C,T]=ve(_.value),u=b(!1);let a=null,s=null;const h=A(()=>!!(X().text||e.text));function y(){s&&(clearTimeout(s),s=null),!u.value&&(a=a||setTimeout(()=>{u.value=!0,a=null},e.openDelay))}function $(){a&&(clearTimeout(a),a=null),u.value&&(s=s||setTimeout(()=>{u.value=!1,s=null},e.closeDelay))}return{ui:n,attrs:k,popper:_,trigger:C,container:T,open:u,onMouseEnter:y,onMouseLeave:$,isVisible:h}}});function ke(e,n,k,_,C,T){const u=z;return d(),m("div",F({ref:"trigger",class:e.ui.wrapper},e.attrs,{onMouseenter:n[0]||(n[0]=(...a)=>e.onMouseEnter&&e.onMouseEnter(...a)),onMouseleave:n[1]||(n[1]=(...a)=>e.onMouseLeave&&e.onMouseLeave(...a))}),[B(e.$slots,"default",{open:e.open},()=>[n[2]||(n[2]=p(" Hover "))]),e.open&&!e.prevent&&e.isVisible?(d(),m("div",{key:0,ref:"container",class:f([e.ui.container,e.ui.width])},[r(ae,F({appear:""},e.ui.transition),{default:l(()=>{var a;return[g("div",null,[e.popper.arrow?(d(),m("div",{key:0,"data-popper-arrow":"",class:f(Object.values(e.ui.arrow))},null,2)):D("",!0),g("div",{class:f([e.ui.base,e.ui.background,e.ui.color,e.ui.rounded,e.ui.shadow,e.ui.ring])},[B(e.$slots,"text",{},()=>[p(c(e.text),1)]),(a=e.shortcuts)!=null&&a.length?(d(),m("span",{key:0,class:f(e.ui.shortcuts)},[g("span",{class:f(e.ui.middot)},"·",2),(d(!0),m(Z,null,ee(e.shortcuts,s=>(d(),te(u,{key:s,size:"xs"},{default:l(()=>[p(c(s),1)]),_:2},1024))),128))],2)):D("",!0)],2)])]}),_:3},16)],2)):D("",!0)],16)}const we=x(he,[["render",ke]]),De={key:0,class:"relative"},Ce={class:"my-6"},Te=["title"],$e={class:"caption-bottom text-left mt-2"},Se={key:1,class:"justify-center flex pt-4"},Oe=O({__name:"persons",async setup(e){let n,k;const _=be(),C=ge(),T=oe(),u=b([]),a=b(1),s=b(!1),h=b(!1),y=b(""),$=b("Данные обновляются..."),{refresh:S,status:M}=([n,k]=ne(async()=>_e("candidates",async()=>{[u.value,s.value]=await _("/api/index/"+a.value,{params:{search:y.value}}),$.value=de(pe(),"DD.MM.YYYY в HH:mm").value},{watch:[a]})),n=await n,k(),n);se(()=>y.value,()=>{S()},{debounce:500,maxWait:1e3});const{open:H,reset:j,onCancel:P,onChange:Y}=le({accept:".json",multiple:!1});return Y(async w=>{if(!w)return;h.value=!0;const i=new FormData;i.append("file",w[0]);const{person_id:v}=await _("/api/json",{method:"POST",body:i});if(j(),h.value=!1,v)return await S(),E("/profile/"+v);T.add({icon:"i-heroicons-information-circle",title:"Внимание",description:"Файл не был загружен",color:"red"})}),P(()=>{j()}),ie("/profile/[id]"),(w,i)=>{const v=ue,I=fe,K=me,R=ce,q=ye,N=we;return d(),m("div",null,[o(C).role=="user"?(d(),m("div",De,[g("div",{class:f(["absolute inset-y-0 right-0",{"animate-pulse":o(M)=="pending"||o(h)}])},[r(v,{icon:"i-heroicons-cloud-arrow-up",title:"Загрузить json файл",size:"xl",variant:"ghost",onClick:o(H)},null,8,["onClick"])],2)])):D("",!0),r(I,{header:"КАНДИДАТЫ"}),g("div",Ce,[r(K,{modelValue:o(y),"onUpdate:modelValue":i[0]||(i[0]=t=>re(y)?y.value=t:null),placeholder:"поиск по фамилии, имени, отчеству"},null,8,["modelValue"])]),r(q,{loading:o(M)=="pending"||o(h),progress:{color:"red",animation:"swing"},"empty-state":{icon:"i-heroicons-circle-stack-20-solid",label:"Данные не найдены."},columns:[{key:"id",label:"#"},{key:"region",label:"Регион"},{key:"surname",label:"Фамилия Имя Отчество"},{key:"birthday",label:"Дата рождения"},{key:"inn",label:"ИНН"},{key:"snils",label:"СНИЛС"},{key:"created",label:"Обновлено"},{key:"username",label:"Сотрудник"},{key:"editable",label:"Статус"}],rows:o(u),onSelect:i[1]||(i[1]=t=>("navigateTo"in w?w.navigateTo:o(E))(`/profile/${t.id}`))},{"id-data":l(({row:t})=>[p(c(t.id),1)]),"region-data":l(({row:t})=>[p(c(t.region),1)]),"surname-data":l(({row:t})=>[p(c(`${t.surname} ${t.firstname} ${t.patronymic?t.patronymic:""}`),1)]),"birthday-data":l(({row:t})=>[p(c(new Date(t.birthday).toLocaleDateString()),1)]),"created-data":l(({row:t})=>[p(c(new Date(t.created).toLocaleDateString()),1)]),"username-data":l(({row:t})=>[p(c(t.username?t.username.toString().split(" ")[0]:""),1)]),"editable-data":l(({row:t})=>[g("div",{class:f(["text-start",t.editable?"text-red-600":"text-primary"]),title:t.editable?"Анкета редактируется":"Анкета обновлена"},[r(R,{name:t.editable?"i-heroicons-arrow-path":"i-heroicons-check-circle",class:f(["w-6 h-6",{" animate-spin":t.editable}])},null,8,["name","class"])],10,Te)]),caption:l(()=>[g("caption",$e,[r(v,{variant:"link",icon:"i-heroicons-arrow-path",label:`Обновлено: ${o($)}`,loading:o(M)=="pending",onClick:o(S)},null,8,["label","loading","onClick"])])]),_:1},8,["loading","rows"]),o(a)>1||o(s)?(d(),m("div",Se,[r(N,{text:"Предыдущая страница"},{default:l(()=>[r(v,{icon:"i-heroicons-arrow-small-left-20-solid",disabled:o(a)<2,ui:{rounded:"rounded-full"},class:"me-2",onClick:i[2]||(i[2]=t=>a.value--)},null,8,["disabled"])]),_:1}),r(N,{text:"Следующая страница"},{default:l(()=>[r(v,{icon:"i-heroicons-arrow-small-right-20-solid",disabled:!o(s),ui:{rounded:"rounded-full"},class:"ms-2",onClick:i[3]||(i[3]=t=>a.value++)},null,8,["disabled"])]),_:1})])):D("",!0)])}}});export{Oe as default};
