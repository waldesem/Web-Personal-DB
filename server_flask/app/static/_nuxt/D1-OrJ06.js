import{m as P,k as z,_ as T,g as I,l as N,n as E,q as S,s as H,v as L,x as J,y as O,z as R,o as r,c as f,a as V,A as h,i as $,B as g,C as m,D as _,d as M,t as q,F as D,E as F,G as A,r as C,b as o,j as l,w as y,H as K,I as Q}from"./IZgRZ49_.js";import{_ as W,b as X,a as Y}from"./Dx6l17WP.js";import{_ as Z}from"./BxiBspJ_.js";import{_ as x}from"./CsOuIby2.js";import{s as ee,b as te,c as oe}from"./BGhzAh6M.js";const le={wrapper:"w-full relative overflow-hidden",inner:"w-0 flex-1",title:"text-sm font-medium",description:"mt-1 text-sm leading-4 opacity-90",actions:"flex items-center gap-2 mt-3 flex-shrink-0",shadow:"",rounded:"rounded-lg",padding:"p-4",gap:"gap-3",icon:{base:"flex-shrink-0 w-5 h-5"},avatar:{base:"flex-shrink-0 self-center",size:"md"},color:{white:{solid:"text-gray-900 dark:text-white bg-white dark:bg-gray-900 ring-1 ring-gray-200 dark:ring-gray-800"}},variant:{solid:"bg-{color}-500 dark:bg-{color}-400 text-white dark:text-gray-900",outline:"text-{color}-500 dark:text-{color}-400 ring-1 ring-inset ring-{color}-500 dark:ring-{color}-400",soft:"bg-{color}-50 dark:bg-{color}-400 dark:bg-opacity-10 text-{color}-500 dark:text-{color}-400",subtle:"bg-{color}-50 dark:bg-{color}-400 dark:bg-opacity-10 text-{color}-500 dark:text-{color}-400 ring-1 ring-inset ring-{color}-500 dark:ring-{color}-400 ring-opacity-25 dark:ring-opacity-25"},default:{color:"white",variant:"solid",icon:null,closeButton:null,actionButton:{size:"xs",color:"primary",variant:"link"}}},v=P(z.ui.strategy,z.ui.alert,le),se=I({components:{UIcon:N,UAvatar:E,UButton:S},inheritAttrs:!1,props:{title:{type:String,default:null},description:{type:String,default:null},icon:{type:String,default:()=>v.default.icon},avatar:{type:Object,default:null},closeButton:{type:Object,default:()=>v.default.closeButton},actions:{type:Array,default:()=>[]},color:{type:String,default:()=>v.default.color,validator(e){return[...z.ui.colors,...Object.keys(v.color)].includes(e)}},variant:{type:String,default:()=>v.default.variant,validator(e){return[...Object.keys(v.variant),...Object.values(v.color).flatMap(n=>Object.keys(n))].includes(e)}},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["close"],setup(e){const{ui:n,attrs:u}=H("alert",L(e,"ui"),v),i=J(()=>{var k,d;const a=((d=(k=n.value.color)==null?void 0:k[e.color])==null?void 0:d[e.variant])||n.value.variant[e.variant];return O(R(n.value.wrapper,n.value.rounded,n.value.shadow,n.value.padding,a==null?void 0:a.replaceAll("{color}",e.color)),e.class)});function s(a){a.click&&a.click()}return{ui:n,attrs:u,alertClass:i,onAction:s,twMerge:O}}});function ae(e,n,u,i,s,a){const k=N,d=E,t=S;return r(),f("div",_({class:e.alertClass},e.attrs),[V("div",{class:g(["flex",[e.ui.gap,{"items-start":e.description||e.$slots.description,"items-center":!e.description&&!e.$slots.description}]])},[h(e.$slots,"icon",{icon:e.icon},()=>[e.icon?(r(),$(k,{key:0,name:e.icon,class:g(e.ui.icon.base)},null,8,["name","class"])):m("",!0)]),h(e.$slots,"avatar",{avatar:e.avatar},()=>[e.avatar?(r(),$(d,_({key:0},{size:e.ui.avatar.size,...e.avatar},{class:e.ui.avatar.base}),null,16,["class"])):m("",!0)]),V("div",{class:g(e.ui.inner)},[e.title||e.$slots.title?(r(),f("p",{key:0,class:g(e.ui.title)},[h(e.$slots,"title",{title:e.title},()=>[M(q(e.title),1)])],2)):m("",!0),e.description||e.$slots.description?(r(),f("div",{key:1,class:g(e.twMerge(e.ui.description,!e.title&&!e.$slots.title&&"mt-0 leading-5"))},[h(e.$slots,"description",{description:e.description},()=>[M(q(e.description),1)])],2)):m("",!0),(e.description||e.$slots.description)&&(e.actions.length||e.$slots.actions)?(r(),f("div",{key:2,class:g(e.ui.actions)},[h(e.$slots,"actions",{},()=>[(r(!0),f(D,null,F(e.actions,(c,b)=>(r(),$(t,_({key:b,ref_for:!0},{...e.ui.default.actionButton||{},...c},{onClick:A(w=>e.onAction(c),["stop"])}),null,16,["onClick"]))),128))])],2)):m("",!0)],2),e.closeButton||!e.description&&!e.$slots.description&&e.actions.length?(r(),f("div",{key:0,class:g(e.twMerge(e.ui.actions,"mt-0"))},[!e.description&&!e.$slots.description&&(e.actions.length||e.$slots.actions)?h(e.$slots,"actions",{key:0},()=>[(r(!0),f(D,null,F(e.actions,(c,b)=>(r(),$(t,_({key:b,ref_for:!0},{...e.ui.default.actionButton||{},...c},{onClick:A(w=>e.onAction(c),["stop"])}),null,16,["onClick"]))),128))]):m("",!0),e.closeButton?(r(),$(t,_({key:1,"aria-label":"Close"},{...e.ui.default.closeButton||{},...e.closeButton},{onClick:n[0]||(n[0]=A(c=>e.$emit("close"),["stop"]))}),null,16)):m("",!0)],2)):m("",!0)],2)],16)}const ne=T(se,[["render",ae]]),re={class:"flex justify-center"},ie={class:"py-8"},ue={class:"border border-red-600 rounded-md p-5"},de={key:0},ge=I({__name:"login",setup(e){const n=ee(),u=C(!1),i=C("create"),s=C({}),a={alert:C({color:"green",variant:"subtle",title:"Информация",description:"Введите логин и пароль"}),setAlert(d,t,c){this.alert.value.color=d,this.alert.value.title=t,this.alert.value.description=c}};async function k(){if(i.value==="update"){if(s.value.passhash===s.value.new_pswd){a.setAlert("purple","Предупреждение","Старый и новый пароли совпадают");return}if(s.value.conf_pswd!==s.value.new_pswd){a.setAlert("red","Предупреждение","Новый пароль и подтверждение не совпадают");return}}const{message:d,user_token:t}=await $fetch(`${te}/login/${i.value}`,{method:"POST",body:s.value});d==="Success"?(oe.value=t,n.getCurrentUser()):d==="Updated"?(i.value="create",a.setAlert("blue","Информация","Войдите с новым паролем.")):d==="Denied"?(i.value="update",a.setAlert("red","Предупреждение","Пароль просрочен.")):a.setAlert("red","Внимание","Неправильный логин или пароль."),u.value=!1}return(d,t)=>{const c=ne,b=W,w=X,U=Y,B=S,j=Z,G=x;return r(),f("div",re,[V("div",ie,[o(c,{variant:"subtle",color:a.alert.value.color,title:a.alert.value.title,description:a.alert.value.description},null,8,["color","title","description"]),o(b,{div:"py-5",cls:"text-2xl text-blue-800",header:"Кадровая безопасность"}),V("div",ue,[o(b,{div:"mb-1",cls:"text-xl text-red-800",header:l(i)==="create"?"Вход в систему":"Обновление пароля"},null,8,["header"]),o(G,{state:l(s),class:"mt-4",onSubmit:A(k,["prevent"])},{default:y(()=>[o(U,{class:"mb-3",size:"md",label:"Логин"},{default:y(()=>[o(w,{modelValue:l(s).username,"onUpdate:modelValue":t[0]||(t[0]=p=>l(s).username=p),placeholder:"username",icon:"i-heroicons-user",required:""},null,8,["modelValue"])]),_:1}),o(U,{class:"mb-3",size:"md",label:"Пароль"},{default:y(()=>[o(j,{size:"md",orientation:"horizontal"},{default:y(()=>[o(w,{modelValue:l(s).password,"onUpdate:modelValue":t[1]||(t[1]=p=>l(s).password=p),type:l(u)?"text":"password",placeholder:"password",icon:"i-heroicons-lock-closed",required:""},null,8,["modelValue","type"]),o(B,{title:l(u)?"Скрыть":"Показать",icon:l(u)?"i-heroicons-eye-slash":"i-heroicons-eye",color:"gray",onClick:t[2]||(t[2]=p=>u.value=!l(u))},null,8,["title","icon"])]),_:1})]),_:1}),l(i)==="update"?(r(),f("div",de,[o(U,{class:"mb-3",size:"md",label:"Новый пароль"},{default:y(()=>[o(w,{modelValue:l(s).new_pswd,"onUpdate:modelValue":t[3]||(t[3]=p=>l(s).new_pswd=p),type:l(u)?"text":"password",placeholder:"password",icon:"i-heroicons-lock-closed",required:""},null,8,["modelValue","type"])]),_:1}),o(U,{class:"mb-3",size:"md",label:"Повтор пароля"},{default:y(()=>[o(w,{modelValue:l(s).conf_pswd,"onUpdate:modelValue":t[4]||(t[4]=p=>l(s).conf_pswd=p),type:l(u)?"text":"password",placeholder:"password",icon:"i-heroicons-lock-closed",required:""},null,8,["modelValue","type"])]),_:1})])):m("",!0),o(j,{class:"mt-3",size:"md",orientation:"horizontal"},{default:y(()=>[o(B,{label:"Принять",color:"green",variant:"outline",type:"submit"}),K(o(B,{label:"Изменить",color:"blue",variant:"outline",onClick:t[5]||(t[5]=p=>i.value="update")},null,512),[[Q,l(i)==="create"]]),o(B,{label:"Отмена",color:"red",variant:"outline",onClick:t[6]||(t[6]=p=>i.value="create")})]),_:1})]),_:1},8,["state"])])])])}}});export{ge as default};
