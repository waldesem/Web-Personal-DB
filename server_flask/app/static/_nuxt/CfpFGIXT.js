import{ae as d,r as b,aB as f,am as u}from"./BrjdBAS6.js";const I=()=>async(n,o={})=>{if(m.value)o.headers={...o.headers,Authorization:`Basic ${m.value}`};else return d("/login");try{return await $fetch(n,o)}catch(a){return console.error(a),d("/login")}},i=I(),r="/api",m=b(""),k=()=>{const e=f("user",()=>({auth:!1,userId:"",username:"",role:"",region:""}));async function n(){const a=await i(`${r}/auth`);Object.assign(e.value,{auth:!0,userId:a.id,username:a.username,role:a.role,region:a.region}),await D().getClassify(),d("/persons")}return{user:e,getCurrentUser:n}},D=()=>{const e=f(`${r}/classes`,()=>({}));async function n(){e.value=await $fetch(`${r}/classes`)}return{classes:e,getClassify:n}},T=()=>{const e=f(`${r}/persons`,()=>({candidates:[],page:1,prev:!1,next:!0,search:"",updated:`${new Date().toLocaleDateString("ru-RU")} в ${new Date().toLocaleTimeString("ru-RU")}`}));async function n(o=1){if(e.value.page<1){e.value.page=1;return}else e.value.page=o;const a=await i(`${r}/index/${e.value.page}`,{params:{search:e.value.search}});[e.value.candidates,e.value.next,e.value.prev]=a,e.value.updated=`${new Date().toLocaleDateString("ru-RU")} в ${new Date().toLocaleTimeString("ru-RU")}`}return{persons:e,getCandidates:n}},R=()=>{const e=f("anketa",()=>({})),n=f("share",()=>({candId:"",imageUrl:""}));async function o(t,s="view",c=n.value.candId){s==="self"&&!confirm("Вы действительно хотите включить/выключить режим правки")||(e.value[t]=await i(`${r}/${t}/${c}`,{params:{action:s}}))}async function a(){const t=await $fetch(`${r}/image`,{params:{image:e.value.persons.destination},responseType:"blob"});n.value.imageUrl=window.URL.createObjectURL(new Blob([t]))}async function h(){if(!confirm("Вы действительно хотите изменить регион?"))return;const t=await i(`${r}/region/${n.value.candId}`,{params:{region:e.value.persons.region}});console.log(t),o("persons"),u().add({icon:"i-heroicons-check-circle",title:"Информация",description:"Изменение региона успешно",color:"green"})}async function $(t,s){const c=await i(`${r}/${t}/${n.value.candId}`,{method:"POST",body:s});console.log(c),o(t),u().add({icon:"i-heroicons-check-circle",title:"Успешно",description:"Информация обновлена",color:"green"})}async function v(t,s){if(!confirm("Вы действительно хотите удалить запись?"))return;const c=await i(`${r}/${s}/${t}`,{method:"DELETE"});console.log(c),s==="persons"?d("/persons"):o(s),u().add({icon:"i-heroicons-information-circle",title:"Информация",description:`Запись с ID ${t} удалена`,color:"primary"})}async function y(t,s,c){const l=u(),g=new FormData;if(t){for(const p of t){if(s==="image"&&p.size>1024*1024){l.add({icon:"i-heroicons-exclamation-triangle",title:"Внимание",description:"Файл слишком большой",color:"red"});return}g.append("file",p)}const S=await i(`${r}/file/${s}/${c}`,{method:"POST",body:g});console.log(S),s==="persons"?T().getCandidates(1):s==="image"?a():o(s==="anketa"?"persons":s),l.add({icon:"i-heroicons-check-circle",title:"Информация",description:"Файлы успешно загружены",color:"green"})}else l.add({icon:"i-heroicons-exclamation-triangle",title:"Внимание",description:"Ошибка при загрузке файла",color:"red"})}async function w(t,s){if(t=="create"){const l=await i(`${r}/resume`,{method:"POST",body:s});d(`/profile/${l}`),u().add({icon:"i-heroicons-check-circle",title:"Информация",description:"Данные успешно добавлены",color:"green"})}else $("persons",s)}return{anketa:e,share:n,getItem:o,changeRegion:h,updateItem:$,deleteItem:v,submitFile:y,submitResume:w,getImage:a}};export{D as a,r as b,m as c,R as d,T as e,k as s,I as u};
