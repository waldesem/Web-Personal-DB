import{_ as P,m as T,k as V,g as I,l as D,n as N,q as S,s as E,v as L,x as H,y as O,z as J,o as r,c as f,a as k,A as h,i as _,B as y,C as m,D as U,d as M,t as z,F as q,E as F,G as A,r as C,b as a,j as o,w as b,H as R,I as K}from"./BPBLQG6i.js";import{a as Q,_ as W}from"./B7F370T9.js";import{_ as X}from"./Bf0WHWn1.js";import{_ as Y}from"./DvBXWnc_.js";import{s as Z,b as x,c as ee}from"./C7PE2IGf.js";const te={wrapper:"w-full relative overflow-hidden",inner:"w-0 flex-1",title:"text-sm font-medium",description:"mt-1 text-sm leading-4 opacity-90",actions:"flex items-center gap-2 mt-3 flex-shrink-0",shadow:"",rounded:"rounded-lg",padding:"p-4",gap:"gap-3",icon:{base:"flex-shrink-0 w-5 h-5"},avatar:{base:"flex-shrink-0 self-center",size:"md"},color:{white:{solid:"text-gray-900 dark:text-white bg-white dark:bg-gray-900 ring-1 ring-gray-200 dark:ring-gray-800"}},variant:{solid:"bg-{color}-500 dark:bg-{color}-400 text-white dark:text-gray-900",outline:"text-{color}-500 dark:text-{color}-400 ring-1 ring-inset ring-{color}-500 dark:ring-{color}-400",soft:"bg-{color}-50 dark:bg-{color}-400 dark:bg-opacity-10 text-{color}-500 dark:text-{color}-400",subtle:"bg-{color}-50 dark:bg-{color}-400 dark:bg-opacity-10 text-{color}-500 dark:text-{color}-400 ring-1 ring-inset ring-{color}-500 dark:ring-{color}-400 ring-opacity-25 dark:ring-opacity-25"},default:{color:"white",variant:"solid",icon:null,closeButton:null,actionButton:{size:"xs",color:"primary",variant:"link"}}},g=T(V.ui.strategy,V.ui.alert,te),oe=I({components:{UIcon:D,UAvatar:N,UButton:S},inheritAttrs:!1,props:{title:{type:String,default:null},description:{type:String,default:null},icon:{type:String,default:()=>g.default.icon},avatar:{type:Object,default:null},closeButton:{type:Object,default:()=>g.default.closeButton},actions:{type:Array,default:()=>[]},color:{type:String,default:()=>g.default.color,validator(e){return[...V.ui.colors,...Object.keys(g.color)].includes(e)}},variant:{type:String,default:()=>g.default.variant,validator(e){return[...Object.keys(g.variant),...Object.values(g.color).flatMap(n=>Object.keys(n))].includes(e)}},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["close"],setup(e){const{ui:n,attrs:d}=E("alert",L(e,"ui"),g),i=H(()=>{var w,u;const l=((u=(w=n.value.color)==null?void 0:w[e.color])==null?void 0:u[e.variant])||n.value.variant[e.variant];return O(J(n.value.wrapper,n.value.rounded,n.value.shadow,n.value.padding,l==null?void 0:l.replaceAll("{color}",e.color)),e.class)});function s(l){l.click&&l.click()}return{ui:n,attrs:d,alertClass:i,onAction:s,twMerge:O}}});function se(e,n,d,i,s,l){const w=D,u=N,t=S;return r(),f("div",U({class:e.alertClass},e.attrs),[k("div",{class:y(["flex",[e.ui.gap,{"items-start":e.description||e.$slots.description,"items-center":!e.description&&!e.$slots.description}]])},[h(e.$slots,"icon",{icon:e.icon},()=>[e.icon?(r(),_(w,{key:0,name:e.icon,class:y(e.ui.icon.base)},null,8,["name","class"])):m("",!0)]),h(e.$slots,"avatar",{avatar:e.avatar},()=>[e.avatar?(r(),_(u,U({key:0},{size:e.ui.avatar.size,...e.avatar},{class:e.ui.avatar.base}),null,16,["class"])):m("",!0)]),k("div",{class:y(e.ui.inner)},[e.title||e.$slots.title?(r(),f("p",{key:0,class:y(e.ui.title)},[h(e.$slots,"title",{title:e.title},()=>[M(z(e.title),1)])],2)):m("",!0),e.description||e.$slots.description?(r(),f("div",{key:1,class:y(e.twMerge(e.ui.description,!e.title&&!e.$slots.title&&"mt-0 leading-5"))},[h(e.$slots,"description",{description:e.description},()=>[M(z(e.description),1)])],2)):m("",!0),(e.description||e.$slots.description)&&(e.actions.length||e.$slots.actions)?(r(),f("div",{key:2,class:y(e.ui.actions)},[h(e.$slots,"actions",{},()=>[(r(!0),f(q,null,F(e.actions,(c,v)=>(r(),_(t,U({key:v,ref_for:!0},{...e.ui.default.actionButton||{},...c},{onClick:A($=>e.onAction(c),["stop"])}),null,16,["onClick"]))),128))])],2)):m("",!0)],2),e.closeButton||!e.description&&!e.$slots.description&&e.actions.length?(r(),f("div",{key:0,class:y(e.twMerge(e.ui.actions,"mt-0"))},[!e.description&&!e.$slots.description&&(e.actions.length||e.$slots.actions)?h(e.$slots,"actions",{key:0},()=>[(r(!0),f(q,null,F(e.actions,(c,v)=>(r(),_(t,U({key:v,ref_for:!0},{...e.ui.default.actionButton||{},...c},{onClick:A($=>e.onAction(c),["stop"])}),null,16,["onClick"]))),128))]):m("",!0),e.closeButton?(r(),_(t,U({key:1,"aria-label":"Close"},{...e.ui.default.closeButton||{},...e.closeButton},{onClick:n[0]||(n[0]=A(c=>e.$emit("close"),["stop"]))}),null,16)):m("",!0)],2)):m("",!0)],2)],16)}const le=P(oe,[["render",se]]),ae={class:"flex justify-center"},ne={class:"py-8"},re=k("div",{class:"py-5"},[k("h3",{class:"text-2xl text-primary font-bold"},"Кадровая безопасность")],-1),ie={class:"border border-red-600 rounded-md p-5"},ue={class:"text-xl text-opacity-75 text-red-800 font-bold"},de={key:0},ge=I({__name:"login",setup(e){const n=Z(),d=C(!1),i=C("create"),s=C({}),l={alert:C({color:"green",variant:"subtle",title:"Информация",description:"Введите логин и пароль"}),setAlert(u,t,c){this.alert.value.color=u,this.alert.value.title=t,this.alert.value.description=c}};async function w(){if(i.value==="update"){if(s.value.passhash===s.value.new_pswd){l.setAlert("purple","Предупреждение","Старый и новый пароли совпадают");return}if(s.value.conf_pswd!==s.value.new_pswd){l.setAlert("red","Предупреждение","Новый пароль и подтверждение не совпадают");return}}const{message:u,user_token:t}=await $fetch(`${x}/login/${i.value}`,{method:"POST",body:s.value});console.log(u),u==="Success"?(ee.value=t,n.getCurrentUser()):u==="Updated"?(i.value="create",l.setAlert("blue","Информация","Войдите с новым паролем.")):u==="Denied"?(i.value="update",l.setAlert("red","Предупреждение","Пароль просрочен.")):l.setAlert("red","Внимание","Неправильный логин или пароль."),d.value=!1}return(u,t)=>{const c=le,v=Q,$=W,B=S,j=X,G=Y;return r(),f("div",ae,[k("div",ne,[a(c,{variant:"subtle",color:l.alert.value.color,title:l.alert.value.title,description:l.alert.value.description},null,8,["color","title","description"]),re,k("div",ie,[k("h3",ue,z(o(i)==="create"?"Вход в систему":"Изменить пароль"),1),a(G,{state:o(s),class:"mt-4",onSubmit:A(w,["prevent"])},{default:b(()=>[a($,{class:"mb-3",size:"md",label:"Логин"},{default:b(()=>[a(v,{modelValue:o(s).username,"onUpdate:modelValue":t[0]||(t[0]=p=>o(s).username=p),placeholder:"username",icon:"i-heroicons-user",required:""},null,8,["modelValue"])]),_:1}),a($,{class:"mb-3",size:"md",label:"Пароль"},{default:b(()=>[a(j,{size:"md",orientation:"horizontal"},{default:b(()=>[a(v,{modelValue:o(s).password,"onUpdate:modelValue":t[1]||(t[1]=p=>o(s).password=p),type:o(d)?"text":"password",placeholder:"password",icon:"i-heroicons-lock-closed",required:""},null,8,["modelValue","type"]),a(B,{title:o(d)?"Скрыть":"Показать",icon:o(d)?"i-bi-eye-slash":"i-bi-eye",color:"gray",onClick:t[2]||(t[2]=p=>d.value=!o(d))},null,8,["title","icon"])]),_:1})]),_:1}),o(i)==="update"?(r(),f("div",de,[a($,{class:"mb-3",size:"md",label:"Новый пароль"},{default:b(()=>[a(v,{modelValue:o(s).new_pswd,"onUpdate:modelValue":t[3]||(t[3]=p=>o(s).new_pswd=p),type:o(d)?"text":"password",placeholder:"password",required:""},null,8,["modelValue","type"])]),_:1}),a($,{class:"mb-3",size:"md",label:"Повтор пароля"},{default:b(()=>[a(v,{modelValue:o(s).conf_pswd,"onUpdate:modelValue":t[4]||(t[4]=p=>o(s).conf_pswd=p),type:o(d)?"text":"password",placeholder:"password",required:""},null,8,["modelValue","type"])]),_:1})])):m("",!0),a(j,{class:"mt-3",size:"md",orientation:"horizontal"},{default:b(()=>[a(B,{label:"Принять",color:"green",variant:"outline",type:"submit"}),R(a(B,{label:"Изменить",color:"blue",variant:"outline",onClick:t[5]||(t[5]=p=>i.value="update")},null,512),[[K,o(i)==="create"]]),a(B,{label:"Отмена",color:"red",variant:"outline",onClick:t[6]||(t[6]=p=>i.value="create")})]),_:1})]),_:1},8,["state"])])])])}}});export{ge as default};
