import{m as P,k as z,_ as T,g as I,l as N,n as E,q as S,s as H,v as L,x as J,y as O,z as R,o as r,c as f,a as V,A as w,i as h,B as g,C as m,D as _,d as M,t as q,F as D,E as F,G as A,r as C,b as s,w as y,j as l,H as K,I as Q}from"./-i46ahqV.js";import{_ as W,b as X,a as Y}from"./CX3kPmFP.js";import{_ as Z}from"./OoTJBAmz.js";import{_ as x}from"./Dwy2aisJ.js";import{s as ee,b as te,c as oe}from"./DwuX9ns-.js";const se={wrapper:"w-full relative overflow-hidden",inner:"w-0 flex-1",title:"text-sm font-medium",description:"mt-1 text-sm leading-4 opacity-90",actions:"flex items-center gap-2 mt-3 flex-shrink-0",shadow:"",rounded:"rounded-lg",padding:"p-4",gap:"gap-3",icon:{base:"flex-shrink-0 w-5 h-5"},avatar:{base:"flex-shrink-0 self-center",size:"md"},color:{white:{solid:"text-gray-900 dark:text-white bg-white dark:bg-gray-900 ring-1 ring-gray-200 dark:ring-gray-800"}},variant:{solid:"bg-{color}-500 dark:bg-{color}-400 text-white dark:text-gray-900",outline:"text-{color}-500 dark:text-{color}-400 ring-1 ring-inset ring-{color}-500 dark:ring-{color}-400",soft:"bg-{color}-50 dark:bg-{color}-400 dark:bg-opacity-10 text-{color}-500 dark:text-{color}-400",subtle:"bg-{color}-50 dark:bg-{color}-400 dark:bg-opacity-10 text-{color}-500 dark:text-{color}-400 ring-1 ring-inset ring-{color}-500 dark:ring-{color}-400 ring-opacity-25 dark:ring-opacity-25"},default:{color:"white",variant:"solid",icon:null,closeButton:null,actionButton:{size:"xs",color:"primary",variant:"link"}}},v=P(z.ui.strategy,z.ui.alert,se),le=I({components:{UIcon:N,UAvatar:E,UButton:S},inheritAttrs:!1,props:{title:{type:String,default:null},description:{type:String,default:null},icon:{type:String,default:()=>v.default.icon},avatar:{type:Object,default:null},closeButton:{type:Object,default:()=>v.default.closeButton},actions:{type:Array,default:()=>[]},color:{type:String,default:()=>v.default.color,validator(e){return[...z.ui.colors,...Object.keys(v.color)].includes(e)}},variant:{type:String,default:()=>v.default.variant,validator(e){return[...Object.keys(v.variant),...Object.values(v.color).flatMap(n=>Object.keys(n))].includes(e)}},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["close"],setup(e){const{ui:n,attrs:u}=H("alert",L(e,"ui"),v),d=J(()=>{var k,i;const a=((i=(k=n.value.color)==null?void 0:k[e.color])==null?void 0:i[e.variant])||n.value.variant[e.variant];return O(R(n.value.wrapper,n.value.rounded,n.value.shadow,n.value.padding,a==null?void 0:a.replaceAll("{color}",e.color)),e.class)});function o(a){a.click&&a.click()}return{ui:n,attrs:u,alertClass:d,onAction:o,twMerge:O}}});function ae(e,n,u,d,o,a){const k=N,i=E,t=S;return r(),f("div",_({class:e.alertClass},e.attrs),[V("div",{class:g(["flex",[e.ui.gap,{"items-start":e.description||e.$slots.description,"items-center":!e.description&&!e.$slots.description}]])},[w(e.$slots,"icon",{icon:e.icon},()=>[e.icon?(r(),h(k,{key:0,name:e.icon,class:g(e.ui.icon.base)},null,8,["name","class"])):m("",!0)]),w(e.$slots,"avatar",{avatar:e.avatar},()=>[e.avatar?(r(),h(i,_({key:0},{size:e.ui.avatar.size,...e.avatar},{class:e.ui.avatar.base}),null,16,["class"])):m("",!0)]),V("div",{class:g(e.ui.inner)},[e.title||e.$slots.title?(r(),f("p",{key:0,class:g(e.ui.title)},[w(e.$slots,"title",{title:e.title},()=>[M(q(e.title),1)])],2)):m("",!0),e.description||e.$slots.description?(r(),f("div",{key:1,class:g(e.twMerge(e.ui.description,!e.title&&!e.$slots.title&&"mt-0 leading-5"))},[w(e.$slots,"description",{description:e.description},()=>[M(q(e.description),1)])],2)):m("",!0),(e.description||e.$slots.description)&&(e.actions.length||e.$slots.actions)?(r(),f("div",{key:2,class:g(e.ui.actions)},[w(e.$slots,"actions",{},()=>[(r(!0),f(D,null,F(e.actions,(c,$)=>(r(),h(t,_({key:$,ref_for:!0},{...e.ui.default.actionButton||{},...c},{onClick:A(b=>e.onAction(c),["stop"])}),null,16,["onClick"]))),128))])],2)):m("",!0)],2),e.closeButton||!e.description&&!e.$slots.description&&e.actions.length?(r(),f("div",{key:0,class:g(e.twMerge(e.ui.actions,"mt-0"))},[!e.description&&!e.$slots.description&&(e.actions.length||e.$slots.actions)?w(e.$slots,"actions",{key:0},()=>[(r(!0),f(D,null,F(e.actions,(c,$)=>(r(),h(t,_({key:$,ref_for:!0},{...e.ui.default.actionButton||{},...c},{onClick:A(b=>e.onAction(c),["stop"])}),null,16,["onClick"]))),128))]):m("",!0),e.closeButton?(r(),h(t,_({key:1,"aria-label":"Close"},{...e.ui.default.closeButton||{},...e.closeButton},{onClick:n[0]||(n[0]=A(c=>e.$emit("close"),["stop"]))}),null,16)):m("",!0)],2)):m("",!0)],2)],16)}const ne=T(le,[["render",ae]]),re={class:"flex justify-center"},ie={class:"py-8"},ue={class:"border border-red-600 rounded-md p-5"},de={key:0},ge=I({__name:"login",setup(e){const n=ee(),u=C(!1),d=C("create"),o=C({}),a={alert:C({color:"green",variant:"subtle",title:"Информация",description:"Введите логин и пароль"}),setAlert(i,t,c){this.alert.value.color=i,this.alert.value.title=t,this.alert.value.description=c}};async function k(){if(d.value==="update"){if(o.value.passhash===o.value.new_pswd){a.setAlert("purple","Предупреждение","Старый и новый пароли совпадают");return}if(o.value.conf_pswd!==o.value.new_pswd){a.setAlert("red","Предупреждение","Новый пароль и подтверждение не совпадают");return}}const{message:i,user_token:t}=await $fetch(`${te}/login/${d.value}`,{method:"POST",body:o.value});console.log(i),i==="Success"?(oe.value=t,n.getCurrentUser()):i==="Updated"?(d.value="create",a.setAlert("blue","Информация","Войдите с новым паролем.")):i==="Denied"?(d.value="update",a.setAlert("red","Предупреждение","Пароль просрочен.")):a.setAlert("red","Внимание","Неправильный логин или пароль."),u.value=!1}return(i,t)=>{const c=ne,$=W,b=X,U=Y,B=S,j=Z,G=x;return r(),f("div",re,[V("div",ie,[s(c,{variant:"subtle",color:a.alert.value.color,title:a.alert.value.title,description:a.alert.value.description},null,8,["color","title","description"]),s($,{div:"py-5",cls:"text-2xl text-blue-800",header:"Кадровая безопасность"}),V("div",ue,[s(G,{state:l(o),class:"mt-4",onSubmit:A(k,["prevent"])},{default:y(()=>[s(U,{class:"mb-3",size:"md",label:"Логин"},{default:y(()=>[s(b,{modelValue:l(o).username,"onUpdate:modelValue":t[0]||(t[0]=p=>l(o).username=p),placeholder:"username",icon:"i-heroicons-user",required:""},null,8,["modelValue"])]),_:1}),s(U,{class:"mb-3",size:"md",label:"Пароль"},{default:y(()=>[s(j,{size:"md",orientation:"horizontal"},{default:y(()=>[s(b,{modelValue:l(o).password,"onUpdate:modelValue":t[1]||(t[1]=p=>l(o).password=p),type:l(u)?"text":"password",placeholder:"password",icon:"i-heroicons-lock-closed",required:""},null,8,["modelValue","type"]),s(B,{title:l(u)?"Скрыть":"Показать",icon:l(u)?"i-heroicons-eye-slash":"i-heroicons-eye",color:"gray",onClick:t[2]||(t[2]=p=>u.value=!l(u))},null,8,["title","icon"])]),_:1})]),_:1}),l(d)==="update"?(r(),f("div",de,[s(U,{class:"mb-3",size:"md",label:"Новый пароль"},{default:y(()=>[s(b,{modelValue:l(o).new_pswd,"onUpdate:modelValue":t[3]||(t[3]=p=>l(o).new_pswd=p),type:l(u)?"text":"password",placeholder:"password",icon:"i-heroicons-lock-closed",required:""},null,8,["modelValue","type"])]),_:1}),s(U,{class:"mb-3",size:"md",label:"Повтор пароля"},{default:y(()=>[s(b,{modelValue:l(o).conf_pswd,"onUpdate:modelValue":t[4]||(t[4]=p=>l(o).conf_pswd=p),type:l(u)?"text":"password",placeholder:"password",icon:"i-heroicons-lock-closed",required:""},null,8,["modelValue","type"])]),_:1})])):m("",!0),s(j,{class:"mt-3",size:"md",orientation:"horizontal"},{default:y(()=>[s(B,{label:"Принять",color:"green",variant:"outline",type:"submit"}),K(s(B,{label:"Изменить",color:"blue",variant:"outline",onClick:t[5]||(t[5]=p=>d.value="update")},null,512),[[Q,l(d)==="create"]]),s(B,{label:"Отмена",color:"red",variant:"outline",onClick:t[6]||(t[6]=p=>d.value="create")})]),_:1})]),_:1},8,["state"])])])])}}});export{ge as default};
