import{ag as u,r as v,aI as d,J as h}from"./IZgRZ49_.js";const w=()=>async(a,c={})=>{if(m.value)c.headers={...c.headers,Authorization:`Basic ${m.value}`};else return u("/login");try{return await $fetch(a,c)}catch(e){return console.error(e),u("/login")}},i=w(),r="/api",m=v(""),T=()=>{const s=d("user",()=>({auth:!1,userId:"",username:"",role:"",region:""}));async function a(){const e=await i(`${r}/auth`);if(!e)return u("/login");Object.assign(s.value,{auth:!0,userId:e.id,username:e.username,role:e.role,region:e.region}),await I().getClassify(),u("/persons")}return{user:s,getCurrentUser:a}},I=()=>{const s=d(`${r}/classes`,()=>({}));async function a(){s.value=await $fetch(`${r}/classes`)}return{classes:s,getClassify:a}},b=()=>{const s=d("anketa",()=>({})),a=d("share",()=>({candId:"",imageUrl:""}));async function c(t,o="view",n=a.value.candId){o==="self"&&!confirm("Вы действительно хотите включить/выключить режим правки")||(s.value[t]=await i(`${r}/${t}/${n}`,{params:{action:o}}))}async function e(t,o){const n=await i(`${r}/${t}/${a.value.candId}`,{method:"POST",body:o});console.log(n),h().add({icon:"i-heroicons-check-circle",title:"Успешно",description:"Информация обновлена",color:"green"})}async function g(t,o){if(!confirm("Вы действительно хотите удалить запись?"))return;const n=await i(`${r}/${o}/${t}`,{method:"DELETE"});console.log(n),h().add({icon:"i-heroicons-information-circle",title:"Информация",description:`Запись с ID ${t} удалена`,color:"primary"})}async function $(t,o,n){const l=h(),f=new FormData;if(t){for(const y of t)f.append("file",y);const p=await i(`${r}/file/${o}/${n}`,{method:"POST",body:f});console.log(p),l.add({icon:"i-heroicons-check-circle",title:"Информация",description:"Файлы успешно загружены",color:"green"})}else l.add({icon:"i-heroicons-exclamation-triangle",title:"Внимание",description:"Ошибка при загрузке файла",color:"red"});f.delete("file")}return{anketa:s,share:a,getItem:c,updateItem:e,deleteItem:g,submitFile:$}};export{I as a,r as b,m as c,b as d,T as s,w as u};
