import{m as J,J as W,h as A,_ as G,d as O,l as Q,t as B,q as X,K as Z,r as p,o as d,c as f,x as F,C as c,z as y,b as r,g as l,f as b,A as T,D as m,F as x,E as ee,y as ae,B as V,T as te,L as oe,w as ne,M as se,N as le,O as ie,n as E,p as re,e as o,P as ue,k as de,u as ce,a as pe,i as me}from"./lDZheyb0.js";import{a as fe,_ as ye}from"./BCzKcTdV.js";import{_ as ve}from"./DL_9RaDu.js";import{_ as z}from"./C0416f8s.js";import{u as ge}from"./DAvUwKLE.js";import{u as be}from"./Dp_KVRGT.js";import{u as he}from"./BRI9USbw.js";import{a as _e}from"./DkI-Ci4Z.js";import"./u3ZSRJSR.js";import"./CsR9_4BF.js";const U=J(A.ui.strategy,A.ui.tooltip,W),ke=O({components:{UKbd:z},inheritAttrs:!1,props:{text:{type:String,default:null},prevent:{type:Boolean,default:!1},shortcuts:{type:Array,default:()=>[]},openDelay:{type:Number,default:()=>U.default.openDelay},closeDelay:{type:Number,default:()=>U.default.closeDelay},popper:{type:Object,default:()=>({})},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},setup(e){const{ui:n,attrs:k}=Q("tooltip",B(e,"ui"),U,B(e,"class")),h=X(()=>Z({},e.popper,n.value.popper)),[$,w]=ge(h.value),u=p(!1);let t=null,s=null;function D(){s&&(clearTimeout(s),s=null),!u.value&&(t=t||setTimeout(()=>{u.value=!0,t=null},e.openDelay))}function _(){t&&(clearTimeout(t),t=null),u.value&&(s=s||setTimeout(()=>{u.value=!1,s=null},e.closeDelay))}return{ui:n,attrs:k,popper:h,trigger:$,container:w,open:u,onMouseEnter:D,onMouseLeave:_}}});function we(e,n,k,h,$,w){const u=z;return d(),f("div",V({ref:"trigger",class:e.ui.wrapper},e.attrs,{onMouseenter:n[0]||(n[0]=(...t)=>e.onMouseEnter&&e.onMouseEnter(...t)),onMouseleave:n[1]||(n[1]=(...t)=>e.onMouseLeave&&e.onMouseLeave(...t))}),[F(e.$slots,"default",{open:e.open},()=>[n[2]||(n[2]=c(" Hover "))]),e.open&&!e.prevent?(d(),f("div",{key:0,ref:"container",class:y([e.ui.container,e.ui.width])},[r(te,V({appear:""},e.ui.transition),{default:l(()=>{var t;return[b("div",null,[e.popper.arrow?(d(),f("div",{key:0,"data-popper-arrow":"",class:y(Object.values(e.ui.arrow))},null,2)):T("",!0),b("div",{class:y([e.ui.base,e.ui.background,e.ui.color,e.ui.rounded,e.ui.shadow,e.ui.ring])},[F(e.$slots,"text",{},()=>[c(m(e.text),1)]),(t=e.shortcuts)!=null&&t.length?(d(),f("span",{key:0,class:y(e.ui.shortcuts)},[b("span",{class:y(e.ui.middot)},"·",2),(d(!0),f(x,null,ee(e.shortcuts,s=>(d(),ae(u,{key:s,size:"xs"},{default:l(()=>[c(m(s),1)]),_:2},1024))),128))],2)):T("",!0)],2)])]}),_:3},16)],2)):T("",!0)],16)}const De=G(ke,[["render",we]]),Ce={key:0,class:"relative"},Te={class:"my-6"},$e={class:"caption-bottom text-left mt-2"},Me={key:1,class:"justify-center flex pt-6"},Oe=O({__name:"persons",async setup(e){let n,k;const h=be(),$=he(),w=oe(),u=p([]),t=p(1),s=p(!1),D=p(!1),_=p(!1),C=p(""),j=p("Данные обновляются..."),{refresh:M,status:S}=([n,k]=ne(async()=>_e("candidates",async()=>{const v=await h("/api/index/"+t.value,{params:{search:C.value}});[u.value,D.value,s.value]=v,j.value=ce(pe(),"DD.MM.YYYY в HH:mm").value})),n=await n,k(),n);se(()=>C.value,()=>{M()},{debounce:500,maxWait:1e3}),le(()=>t.value,()=>{M()});const{open:H,reset:L,onCancel:P,onChange:Y}=ie({accept:"*.json",multiple:!1});return Y(async v=>{if(!v)return;_.value=!0;const i=new FormData;i.append("file",v[0]);const{person_id:g}=await h("/api/json",{method:"POST",body:i});if(L(),!g){w.add({icon:"i-heroiconsi-heroicons-information-circle",title:"Внимание",description:"Файл не был загружен",color:"red"});return}return w.add({icon:"i-heroicons-check-circle",title:"Информация",description:"Файл успешно загружен",color:"green"}),_.value=!1,await M(),E("/profile/"+g)}),P(()=>{L()}),re("/profile/[id]"),(v,i)=>{const g=de,I=ye,K=fe,R=me,q=ve,N=De;return d(),f("div",null,[o($).role=="user"?(d(),f("div",Ce,[b("div",{class:y(["absolute inset-y-0 right-0",{"animate-pulse":o(S)=="pending"||o(_)}])},[r(g,{icon:"i-heroicons-cloud-arrow-up",title:"Загрузить json файл",variant:"ghost",onClick:o(H)},null,8,["onClick"])],2)])):T("",!0),r(I,{header:"КАНДИДАТЫ"}),b("div",Te,[r(K,{modelValue:o(C),"onUpdate:modelValue":i[0]||(i[0]=a=>ue(C)?C.value=a:null),placeholder:"поиск по фамилии, имени, отчеству",size:"lg"},null,8,["modelValue"])]),r(q,{loading:o(S)=="pending"||o(_),progress:{color:"red",animation:"swing"},"empty-state":{icon:"i-heroicons-circle-stack-20-solid",label:"Данные не найдены."},columns:[{key:"id",label:"#"},{key:"region",label:"Регион"},{key:"surname",label:"Фамилия Имя Отчество"},{key:"birthday",label:"Дата рождения"},{key:"inn",label:"ИНН"},{key:"snils",label:"СНИЛС"},{key:"created",label:"Обновлено"},{key:"username",label:"Сотрудник"},{key:"editable",label:"Статус"}],rows:o(u),onSelect:i[1]||(i[1]=a=>("navigateTo"in v?v.navigateTo:o(E))(`/profile/${a.id}`))},{"id-data":l(({row:a})=>[c(m(a.id),1)]),"region-data":l(({row:a})=>[c(m(a.region),1)]),"surname-data":l(({row:a})=>[c(m(`${a.surname} ${a.firstname} ${a.patronymic?a.patronymic:""}`),1)]),"birthday-data":l(({row:a})=>[c(m(new Date(a.birthday).toLocaleDateString()),1)]),"created-data":l(({row:a})=>[c(m(new Date(a.created).toLocaleDateString()),1)]),"username-data":l(({row:a})=>[c(m(a.username?a.username.toString().split(" ")[0]:""),1)]),"editable-data":l(({row:a})=>[b("div",{class:y(["text-start",a.editable?"text-red-600":"text-primary"])},[r(R,{name:a.editable?"i-heroicons-arrow-path":"i-heroicons-check-circle",class:y(["w-6 h-6",{" animate-spin":a.editable}])},null,8,["name","class"])],2)]),caption:l(()=>[b("caption",$e,[r(g,{variant:"link",icon:"i-heroicons-arrow-path",label:`Обновлено: ${o(j)}`,loading:o(S)=="pending",onClick:o(M)},null,8,["label","loading","onClick"])])]),_:1},8,["loading","rows"]),o(s)||o(D)?(d(),f("div",Me,[r(N,{text:"Предыдущая страница"},{default:l(()=>[r(g,{icon:"i-heroicons-arrow-small-left-20-solid",disabled:!o(s),ui:{rounded:"rounded-full"},class:"me-2",onClick:i[2]||(i[2]=a=>t.value--)},null,8,["disabled"])]),_:1}),r(N,{text:"Следующая страница"},{default:l(()=>[r(g,{icon:"i-heroicons-arrow-small-right-20-solid",disabled:!o(D),ui:{rounded:"rounded-full"},class:"ms-2",onClick:i[3]||(i[3]=a=>t.value++)},null,8,["disabled"])]),_:1})])):T("",!0)])}}});export{Oe as default};
