import{m as E,j as V,_ as G,g as D,B as F,C as I,D as S,k as P,l as H,q as J,r as z,s as L,o as a,c as f,a as C,E as w,i as h,G as k,H as m,v as _,d as j,t as O,F as M,y as q,I as B,z as U,b as s,A as r,w as $,J as K,K as R,n as Q}from"./B_4c7bjE.js";import{_ as W,b as X,a as Y}from"./B8ZzhQbn.js";import{_ as Z}from"./Ckh4YSd5.js";import{_ as x}from"./2VsBTAQu.js";import{s as ee,b as te,u as oe}from"./DupJrylg.js";const se={wrapper:"w-full relative overflow-hidden",inner:"w-0 flex-1",title:"text-sm font-medium",description:"mt-1 text-sm leading-4 opacity-90",actions:"flex items-center gap-2 mt-3 flex-shrink-0",shadow:"",rounded:"rounded-lg",padding:"p-4",gap:"gap-3",icon:{base:"flex-shrink-0 w-5 h-5"},avatar:{base:"flex-shrink-0 self-center",size:"md"},color:{white:{solid:"text-gray-900 dark:text-white bg-white dark:bg-gray-900 ring-1 ring-gray-200 dark:ring-gray-800"}},variant:{solid:"bg-{color}-500 dark:bg-{color}-400 text-white dark:text-gray-900",outline:"text-{color}-500 dark:text-{color}-400 ring-1 ring-inset ring-{color}-500 dark:ring-{color}-400",soft:"bg-{color}-50 dark:bg-{color}-400 dark:bg-opacity-10 text-{color}-500 dark:text-{color}-400",subtle:"bg-{color}-50 dark:bg-{color}-400 dark:bg-opacity-10 text-{color}-500 dark:text-{color}-400 ring-1 ring-inset ring-{color}-500 dark:ring-{color}-400 ring-opacity-25 dark:ring-opacity-25"},default:{color:"white",variant:"solid",icon:null,closeButton:null,actionButton:{size:"xs",color:"primary",variant:"link"}}},g=E(V.ui.strategy,V.ui.alert,se),le=D({components:{UIcon:F,UAvatar:I,UButton:S},inheritAttrs:!1,props:{title:{type:String,default:null},description:{type:String,default:null},icon:{type:String,default:()=>g.default.icon},avatar:{type:Object,default:null},closeButton:{type:Object,default:()=>g.default.closeButton},actions:{type:Array,default:()=>[]},color:{type:String,default:()=>g.default.color,validator(e){return[...V.ui.colors,...Object.keys(g.color)].includes(e)}},variant:{type:String,default:()=>g.default.variant,validator(e){return[...Object.keys(g.variant),...Object.values(g.color).flatMap(l=>Object.keys(l))].includes(e)}},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["close"],setup(e){const{ui:l,attrs:n}=P("alert",H(e,"ui"),g),o=J(()=>{var u,t;const d=((t=(u=l.value.color)==null?void 0:u[e.color])==null?void 0:t[e.variant])||l.value.variant[e.variant];return z(L(l.value.wrapper,l.value.rounded,l.value.shadow,l.value.padding,d==null?void 0:d.replaceAll("{color}",e.color)),e.class)});function i(d){d.click&&d.click()}return{ui:l,attrs:n,alertClass:o,onAction:i,twMerge:z}}});function ae(e,l,n,o,i,d){const u=F,t=I,y=S;return a(),f("div",_({class:e.alertClass},e.attrs),[C("div",{class:k(["flex",[e.ui.gap,{"items-start":e.description||e.$slots.description,"items-center":!e.description&&!e.$slots.description}]])},[w(e.$slots,"icon",{icon:e.icon},()=>[e.icon?(a(),h(u,{key:0,name:e.icon,class:k(e.ui.icon.base)},null,8,["name","class"])):m("",!0)]),w(e.$slots,"avatar",{avatar:e.avatar},()=>[e.avatar?(a(),h(t,_({key:0},{size:e.ui.avatar.size,...e.avatar},{class:e.ui.avatar.base}),null,16,["class"])):m("",!0)]),C("div",{class:k(e.ui.inner)},[e.title||e.$slots.title?(a(),f("p",{key:0,class:k(e.ui.title)},[w(e.$slots,"title",{title:e.title},()=>[j(O(e.title),1)])],2)):m("",!0),e.description||e.$slots.description?(a(),f("div",{key:1,class:k(e.twMerge(e.ui.description,!e.title&&!e.$slots.title&&"mt-0 leading-5"))},[w(e.$slots,"description",{description:e.description},()=>[j(O(e.description),1)])],2)):m("",!0),(e.description||e.$slots.description)&&(e.actions.length||e.$slots.actions)?(a(),f("div",{key:2,class:k(e.ui.actions)},[w(e.$slots,"actions",{},()=>[(a(!0),f(M,null,q(e.actions,(c,v)=>(a(),h(y,_({key:v,ref_for:!0},{...e.ui.default.actionButton||{},...c},{onClick:B(b=>e.onAction(c),["stop"])}),null,16,["onClick"]))),128))])],2)):m("",!0)],2),e.closeButton||!e.description&&!e.$slots.description&&e.actions.length?(a(),f("div",{key:0,class:k(e.twMerge(e.ui.actions,"mt-0"))},[!e.description&&!e.$slots.description&&(e.actions.length||e.$slots.actions)?w(e.$slots,"actions",{key:0},()=>[(a(!0),f(M,null,q(e.actions,(c,v)=>(a(),h(y,_({key:v,ref_for:!0},{...e.ui.default.actionButton||{},...c},{onClick:B(b=>e.onAction(c),["stop"])}),null,16,["onClick"]))),128))]):m("",!0),e.closeButton?(a(),h(y,_({key:1,"aria-label":"Close"},{...e.ui.default.closeButton||{},...e.closeButton},{onClick:l[0]||(l[0]=B(c=>e.$emit("close"),["stop"]))}),null,16)):m("",!0)],2)):m("",!0)],2)],16)}const ne=G(le,[["render",ae]]),re={class:"flex justify-center"},ie={class:"py-8"},ue={class:"border border-red-600 rounded-md p-5"},de={key:0},ge=D({__name:"login",setup(e){const l=ee(),n=U("create"),o=U({}),i={alert:U({color:"green",variant:"subtle",title:"Информация",description:"Введите логин и пароль"}),setAlert(u,t,y){this.alert.value.color=u,this.alert.value.title=t,this.alert.value.description=y}};async function d(){if(n.value==="update"){if(o.value.passhash===o.value.new_pswd){i.setAlert("purple","Предупреждение","Старый и новый пароли совпадают");return}if(o.value.conf_pswd!==o.value.new_pswd){i.setAlert("red","Предупреждение","Новый пароль и подтверждение не совпадают");return}}const{message:u,user_token:t}=await $fetch(`${te}/login/${n.value}`,{method:"POST",body:o.value});u==="Success"?(oe.value=t,Promise.all([l.getClassify(),Q("/persons")])):u==="Updated"?(n.value="create",i.setAlert("blue","Информация","Войдите с новым паролем.")):u==="Denied"?(n.value="update",i.setAlert("red","Предупреждение","Пароль просрочен.")):i.setAlert("red","Внимание","Неправильный логин или пароль.")}return(u,t)=>{const y=ne,c=W,v=X,b=Y,A=S,N=Z,T=x;return a(),f("div",re,[C("div",ie,[s(y,{variant:"subtle",color:i.alert.value.color,title:i.alert.value.title,description:i.alert.value.description},null,8,["color","title","description"]),s(c,{div:"py-5",cls:"text-2xl text-blue-800",header:"Кадровая безопасность"}),C("div",ue,[s(c,{div:"mb-1",cls:"text-xl text-red-800",header:r(n)==="create"?"Вход в систему":"Обновление пароля"},null,8,["header"]),s(T,{state:r(o),class:"mt-4",onSubmit:B(d,["prevent"])},{default:$(()=>[s(b,{class:"mb-3",size:"md",label:"Логин"},{default:$(()=>[s(v,{modelValue:r(o).username,"onUpdate:modelValue":t[0]||(t[0]=p=>r(o).username=p),placeholder:"username",icon:"i-heroicons-user",required:""},null,8,["modelValue"])]),_:1}),s(b,{class:"mb-3",size:"md",label:"Пароль"},{default:$(()=>[s(v,{modelValue:r(o).password,"onUpdate:modelValue":t[1]||(t[1]=p=>r(o).password=p),type:"password",placeholder:"password",icon:"i-heroicons-lock-closed",required:""},null,8,["modelValue"])]),_:1}),r(n)==="update"?(a(),f("div",de,[s(b,{class:"mb-3",size:"md",label:"Новый пароль"},{default:$(()=>[s(v,{modelValue:r(o).new_pswd,"onUpdate:modelValue":t[2]||(t[2]=p=>r(o).new_pswd=p),type:"password",placeholder:"password",icon:"i-heroicons-lock-closed",required:""},null,8,["modelValue"])]),_:1}),s(b,{class:"mb-3",size:"md",label:"Повтор пароля"},{default:$(()=>[s(v,{modelValue:r(o).conf_pswd,"onUpdate:modelValue":t[3]||(t[3]=p=>r(o).conf_pswd=p),type:"password",placeholder:"password",icon:"i-heroicons-lock-closed",required:""},null,8,["modelValue"])]),_:1})])):m("",!0),s(N,{class:"mt-3",size:"md",orientation:"horizontal"},{default:$(()=>[s(A,{label:"Принять",color:"green",variant:"outline",type:"submit"}),K(s(A,{label:"Изменить",color:"blue",variant:"outline",onClick:t[4]||(t[4]=p=>n.value="update")},null,512),[[R,r(n)==="create"]]),s(A,{label:"Отмена",color:"red",variant:"outline",onClick:t[5]||(t[5]=p=>n.value="create")})]),_:1})]),_:1},8,["state"])])])])}}});export{ge as default};
