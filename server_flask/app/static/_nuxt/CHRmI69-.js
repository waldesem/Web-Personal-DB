import{m as I,J as K,h as M,_ as P,d as A,l as R,t as S,q,K as J,r as B,o as d,c as m,x as U,C as p,z as f,b as u,g as r,f as g,A as _,D as c,F as W,E as G,y as Q,B as j,T as X,p as Z,L as ee,u as L,a as N,w as ae,M as te,N as oe,O as ne,n as Y,e as n,k as se,i as le}from"./lgINOUnl.js";import{a as re,_ as ie}from"./B0poOYeU.js";import{_ as ue}from"./B67Mu-OL.js";import{_ as F}from"./CeWA6jVp.js";import{u as de}from"./Cl7nKP5_.js";import{u as pe}from"./Cx_alqFP.js";import{u as ce}from"./CDg8Vv1Q.js";import{a as me}from"./C4qOVT1x.js";import"./DibbOkmJ.js";import"./BbT3jp1P.js";const T=I(M.ui.strategy,M.ui.tooltip,K),fe=A({components:{UKbd:F},inheritAttrs:!1,props:{text:{type:String,default:null},prevent:{type:Boolean,default:!1},shortcuts:{type:Array,default:()=>[]},openDelay:{type:Number,default:()=>T.default.openDelay},closeDelay:{type:Number,default:()=>T.default.closeDelay},popper:{type:Object,default:()=>({})},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},setup(e){const{ui:s,attrs:h}=R("tooltip",S(e,"ui"),T,S(e,"class")),b=q(()=>J({},e.popper,s.value.popper)),[k,w]=de(b.value),a=B(!1);let o=null,l=null;function D(){l&&(clearTimeout(l),l=null),!a.value&&(o=o||setTimeout(()=>{a.value=!0,o=null},e.openDelay))}function C(){o&&(clearTimeout(o),o=null),a.value&&(l=l||setTimeout(()=>{a.value=!1,l=null},e.closeDelay))}return{ui:s,attrs:h,popper:b,trigger:k,container:w,open:a,onMouseEnter:D,onMouseLeave:C}}});function ye(e,s,h,b,k,w){const a=F;return d(),m("div",j({ref:"trigger",class:e.ui.wrapper},e.attrs,{onMouseenter:s[0]||(s[0]=(...o)=>e.onMouseEnter&&e.onMouseEnter(...o)),onMouseleave:s[1]||(s[1]=(...o)=>e.onMouseLeave&&e.onMouseLeave(...o))}),[U(e.$slots,"default",{open:e.open},()=>[s[2]||(s[2]=p(" Hover "))]),e.open&&!e.prevent?(d(),m("div",{key:0,ref:"container",class:f([e.ui.container,e.ui.width])},[u(X,j({appear:""},e.ui.transition),{default:r(()=>{var o;return[g("div",null,[e.popper.arrow?(d(),m("div",{key:0,"data-popper-arrow":"",class:f(Object.values(e.ui.arrow))},null,2)):_("",!0),g("div",{class:f([e.ui.base,e.ui.background,e.ui.color,e.ui.rounded,e.ui.shadow,e.ui.ring])},[U(e.$slots,"text",{},()=>[p(c(e.text),1)]),(o=e.shortcuts)!=null&&o.length?(d(),m("span",{key:0,class:f(e.ui.shortcuts)},[g("span",{class:f(e.ui.middot)},"·",2),(d(!0),m(W,null,G(e.shortcuts,l=>(d(),Q(a,{key:l,size:"xs"},{default:r(()=>[p(c(l),1)]),_:2},1024))),128))],2)):_("",!0)],2)])]}),_:3},16)],2)):_("",!0)],16)}const ve=P(fe,[["render",ye]]),ge={key:0,class:"relative"},be={class:"my-6"},he={class:"caption-bottom text-left"},_e={key:1,class:"justify-center flex py-8"},Le=A({__name:"persons",async setup(e){let s,h;Z("/profile/[id]");const b=pe(),k=ce(),w=ee(),a=B({candidates:[],page:1,prev:!1,next:!1,search:"",upload:!1,updated:L(N(),"DD.MM.YYYY в HH:mm").value}),{refresh:o,status:l}=([s,h]=ae(async()=>me("candidates",async()=>{const y=await b("/api/index/"+a.value.page,{params:{search:a.value.search}});[a.value.candidates,a.value.next,a.value.prev]=y,a.value.updated=L(N(),"DD.MM.YYYY в HH:mm").value})),s=await s,h(),s);te(()=>a.value.search,()=>{o()},{debounce:500,maxWait:1e3}),oe(()=>a.value.page,()=>{o()});const{open:D,reset:C,onCancel:V,onChange:z}=ne({accept:"*.json",multiple:!1});return z(async y=>{if(!y)return;const i=new FormData;i.append("file",y[0]);const{person_id:v}=await b("/api/json",{method:"POST",body:i});if(v)return w.add({icon:"i-heroicons-check-circle",title:"Информация",description:"Файл успешно загружен",color:"green"}),a.value.upload=!1,await o(),Y("/profile/"+v)}),V(()=>{C()}),(y,i)=>{const v=se,E=ie,H=re,O=le,x=ue,$=ve;return d(),m("div",null,[n(k).role=="user"?(d(),m("div",ge,[g("div",{class:f(["absolute inset-y-0 right-0",{"animate-pulse":n(l)=="pending"||n(a).upload}])},[u(v,{icon:"i-heroicons-cloud-arrow-up",size:"xl",title:"Загрузить json файл",variant:"ghost",class:"w-8 h-8",onClick:n(D)},null,8,["onClick"])],2)])):_("",!0),u(E,{header:"КАНДИДАТЫ"}),g("div",be,[u(H,{modelValue:n(a).search,"onUpdate:modelValue":i[0]||(i[0]=t=>n(a).search=t),placeholder:"поиск по фамилии, имени, отчеству",size:"lg"},null,8,["modelValue"])]),u(x,{loading:n(l)=="pending"||n(a).upload,progress:{color:"red",animation:"swing"},"empty-state":{icon:"i-heroicons-circle-stack-20-solid",label:"Данные не найдены."},columns:[{key:"id",label:"#"},{key:"region",label:"Регион"},{key:"surname",label:"Фамилия Имя Отчество"},{key:"birthday",label:"Дата рождения"},{key:"inn",label:"ИНН"},{key:"snils",label:"СНИЛС"},{key:"created",label:"Обновлено"},{key:"username",label:"Сотрудник"},{key:"editable",label:"Статус"}],rows:n(a).candidates,onSelect:i[1]||(i[1]=t=>("navigateTo"in y?y.navigateTo:n(Y))(`/profile/${t.id}`))},{"id-data":r(({row:t})=>[p(c(t.id),1)]),"region-data":r(({row:t})=>[p(c(t.region),1)]),"surname-data":r(({row:t})=>[p(c(`${t.surname} ${t.firstname} ${t.patronymic?t.patronymic:""}`),1)]),"birthday-data":r(({row:t})=>[p(c(new Date(t.birthday).toLocaleDateString()),1)]),"created-data":r(({row:t})=>[p(c(new Date(t.created).toLocaleDateString()),1)]),"username-data":r(({row:t})=>[p(c(t.username?t.username.toString().split(" ")[0]:""),1)]),"editable-data":r(({row:t})=>[g("div",{class:f(["text-start",t.editable?"text-red-600":"text-primary"])},[u(O,{name:t.editable?"i-heroicons-arrow-path":"i-heroicons-check-circle",class:f(["w-6 h-6",{" animate-spin":t.editable}])},null,8,["name","class"])],2)]),caption:r(()=>[g("caption",he,[u(v,{variant:"link",icon:"i-heroicons-arrow-path",label:`Обновлено: ${n(a).updated}`,onClick:n(o)},null,8,["label","onClick"])])]),_:1},8,["loading","rows"]),n(a).prev||n(a).next?(d(),m("div",_e,[u($,{text:"Предыдущая страница"},{default:r(()=>[u(v,{icon:"i-heroicons-arrow-small-left-20-solid",disabled:!n(a).prev,ui:{rounded:"rounded-full"},class:"me-2",onClick:i[2]||(i[2]=t=>n(a).page--)},null,8,["disabled"])]),_:1}),u($,{text:"Следующая страница"},{default:r(()=>[u(v,{icon:"i-heroicons-arrow-small-right-20-solid",disabled:!n(a).next,ui:{rounded:"rounded-full"},class:"ms-2",onClick:i[3]||(i[3]=t=>n(a).page++)},null,8,["disabled"])]),_:1})])):_("",!0)])}}});export{Le as default};
