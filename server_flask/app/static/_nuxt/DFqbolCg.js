import{g as I,r as N,h as F,i as R,w as n,o as h,j as a,c as y,a as m,b as s,H as j,B as k,C as x,G as A,d as i,t as l,J as G,l as P,e as E,q as H,I as J}from"./IZgRZ49_.js";import{b as M,a as q,_ as O}from"./Dx6l17WP.js";import{d as K,_ as Q}from"./6BqLBFxH.js";import{_ as W}from"./BVM_-rs5.js";import{_ as X}from"./BxiBspJ_.js";import{_ as Y}from"./Da6doWRo.js";import{u as Z}from"./C6CawbKM.js";import{a as ee,s as te,b as w,u as ae}from"./BGhzAh6M.js";import"./DVceF92E.js";import"./vkzTFN2Z.js";import"./CNnCnols.js";const ne={key:0,class:"relative"},oe={class:"my-6"},se={class:"caption-bottom text-left"},re={key:1,class:"grid place-items-center py-8"},ge=I({__name:"persons",async setup(ie){let c,b;const v=ae(),$=ee(),D=te(),t=N({candidates:[],spinner:!1,page:1,prev:!1,next:!0,search:"",updated:`${new Date().toLocaleDateString("ru-RU")} в ${new Date().toLocaleTimeString("ru-RU")}`}),{refresh:p}=([c,b]=F(async()=>Z("candidates",async()=>{if(t.value.page<1){t.value.page=1;return}t.value.spinner=!0;const r=await v(`${w}/index/${t.value.page}`,{params:{search:t.value.search}});[t.value.candidates,t.value.next,t.value.prev]=r,t.value.updated=`${new Date().toLocaleDateString("ru-RU")} в ${new Date().toLocaleTimeString("ru-RU")}`,t.value.spinner=!1})),c=await c,b(),c),U=K(async()=>{await p()},500),g=async(r=1)=>{t.value.page=r,await p()};async function C(r){const o=G();if(!r.length){o.add({icon:"i-heroicons-exclamation-triangle",title:"Внимание",description:"Файлы не выбраны",color:"red"});return}const d=new FormData;t.value.spinner=!0;for(const _ of r)d.append("file",_);const u=await v(`${w}/file/persons/0`,{method:"POST",body:d});console.log(u),o.add({icon:"i-heroicons-check-circle",title:"Информация",description:"Файлы успешно загружены",color:"green"}),t.value.spinner=!1,await p()}return(r,o)=>{const d=P,u=M,_=q,S=O,B=E,L=Q,f=H,V=W,T=X,z=Y;return h(),R(z,null,{default:n(()=>[a(D).user.value.role==a($).classes.value.roles.user?(h(),y("div",ne,[m("div",{class:k(["absolute inset-y-0 right-0",{"animate-pulse":a(t).spinner}]),title:"Загрузить json"},[s(_,{class:"mb-3",size:"md"},{label:n(()=>[s(d,{name:"i-heroicons-cloud-arrow-up",class:"w-8 h-8",style:{cursor:"pointer",color:"dodgerblue"}})]),default:n(()=>[j(s(u,{type:"file",accept:".json",multiple:"",onChange:o[0]||(o[0]=e=>C(e))},null,512),[[J,!1]])]),_:1})],2)])):x("",!0),s(S,{header:"КАНДИДАТЫ"}),m("div",oe,[s(u,{modelValue:a(t).search,"onUpdate:modelValue":o[1]||(o[1]=e=>a(t).search=e),placeholder:"поиск по фамилии, имени, отчеству, дате рождения или инн",size:"lg",onInput:A(a(U),["prevent"])},null,8,["modelValue","onInput"])]),s(V,{loading:a(t).spinner,progress:{color:"red",animation:"swing"},"empty-state":{icon:"i-heroicons-circle-stack-20-solid",label:"Ничего не найдено."},columns:[{key:"id",label:"#"},{key:"region",label:"Регион"},{key:"surname",label:"Фамилия Имя Отчество"},{key:"birthday",label:"Дата рождения"},{key:"inn",label:"ИНН"},{key:"snils",label:"СНИЛС"},{key:"created",label:"Обновлено"},{key:"username",label:"Сотрудник"},{key:"editable",label:"Статус"}],rows:a(t).candidates},{"id-data":n(({row:e})=>[i(l(e.id),1)]),"region-data":n(({row:e})=>[i(l(e.region),1)]),"surname-data":n(({row:e})=>[s(B,{to:`/profile/${e.id}`},{default:n(()=>[i(l(`${e.surname} ${e.firstname} ${e.patronymic?e.patronymic:""}`),1)]),_:2},1032,["to"])]),"birthday-data":n(({row:e})=>[i(l(new Date(e.birthday).toLocaleDateString()),1)]),"birthplace-data":n(({row:e})=>[i(l(e.birthplace?e.birthplace:""),1)]),"created-data":n(({row:e})=>[i(l(new Date(e.created).toLocaleDateString()),1)]),"username-data":n(({row:e})=>[i(l(e.username?e.username.toString().split(" ")[0]:""),1)]),"editable-data":n(({row:e})=>[m("div",{class:k(["text-center me-12",e.editable?"animate-pulse":""])},[s(L,{size:"2xl",color:e.editable?"red":"green"},null,8,["color"])],2)]),caption:n(()=>[m("caption",se,[s(f,{variant:"link",icon:"i-heroicons-arrow-path",label:`Обновлено: ${a(t).updated}`,onClick:o[2]||(o[2]=e=>a(p)())},null,8,["label"])])]),_:1},8,["loading","rows"]),a(t).prev||a(t).next?(h(),y("div",re,[s(T,{orientation:"horizontal"},{default:n(()=>[s(f,{disabled:!a(t).prev,variant:"link",icon:"i-heroicons-chevron-double-left",onClick:o[3]||(o[3]=e=>g(a(t).page-1))},null,8,["disabled"]),s(f,{disabled:!a(t).next,variant:"link",icon:"i-heroicons-chevron-double-right",onClick:o[4]||(o[4]=e=>g(a(t).page+1))},null,8,["disabled"])]),_:1})])):x("",!0)]),_:1})}}});export{ge as default};
