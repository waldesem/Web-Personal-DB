import{m as E,f as V,_ as G,d as D,g as F,h as I,i as z,j as L,t as P,k as R,l as S,q as H,o as n,c as m,b as C,s as b,v as h,x as w,y as p,z as $,A as j,B as O,F as M,C as q,D as B,p as J,r as A,a,u as r,e as y,E as Z,G as K,n as Q}from"./B8dkklNN.js";import{_ as W,b as X,a as Y}from"./DvJ7HPBa.js";import{_ as x}from"./CxDeDL45.js";import{_ as ee}from"./CaecZw4b.js";import{u as te}from"./DceBsjlI.js";const oe={wrapper:"w-full relative overflow-hidden",inner:"w-0 flex-1",title:"text-sm font-medium",description:"mt-1 text-sm leading-4 opacity-90",actions:"flex items-center gap-2 mt-3 flex-shrink-0",shadow:"",rounded:"rounded-lg",padding:"p-4",gap:"gap-3",icon:{base:"flex-shrink-0 w-5 h-5"},avatar:{base:"flex-shrink-0 self-center",size:"md"},color:{white:{solid:"text-gray-900 dark:text-white bg-white dark:bg-gray-900 ring-1 ring-gray-200 dark:ring-gray-800"}},variant:{solid:"bg-{color}-500 dark:bg-{color}-400 text-white dark:text-gray-900",outline:"text-{color}-500 dark:text-{color}-400 ring-1 ring-inset ring-{color}-500 dark:ring-{color}-400",soft:"bg-{color}-50 dark:bg-{color}-400 dark:bg-opacity-10 text-{color}-500 dark:text-{color}-400",subtle:"bg-{color}-50 dark:bg-{color}-400 dark:bg-opacity-10 text-{color}-500 dark:text-{color}-400 ring-1 ring-inset ring-{color}-500 dark:ring-{color}-400 ring-opacity-25 dark:ring-opacity-25"},default:{color:"white",variant:"solid",icon:null,closeButton:null,actionButton:{size:"xs",color:"primary",variant:"link"}}},v=E(V.ui.strategy,V.ui.alert,oe),se=D({components:{UIcon:F,UAvatar:I,UButton:z},inheritAttrs:!1,props:{title:{type:String,default:null},description:{type:String,default:null},icon:{type:String,default:()=>v.default.icon},avatar:{type:Object,default:null},closeButton:{type:Object,default:()=>v.default.closeButton},actions:{type:Array,default:()=>[]},color:{type:String,default:()=>v.default.color,validator(e){return[...V.ui.colors,...Object.keys(v.color)].includes(e)}},variant:{type:String,default:()=>v.default.variant,validator(e){return[...Object.keys(v.variant),...Object.values(v.color).flatMap(o=>Object.keys(o))].includes(e)}},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["close"],setup(e){const{ui:o,attrs:l}=L("alert",P(e,"ui"),v),i=R(()=>{var s,t;const d=((t=(s=o.value.color)==null?void 0:s[e.color])==null?void 0:t[e.variant])||o.value.variant[e.variant];return S(H(o.value.wrapper,o.value.rounded,o.value.shadow,o.value.padding,d==null?void 0:d.replaceAll("{color}",e.color)),e.class)});function _(d){d.click&&d.click()}return{ui:o,attrs:l,alertClass:i,onAction:_,twMerge:S}}});function ae(e,o,l,i,_,d){const s=F,t=I,g=z;return n(),m("div",$({class:e.alertClass},e.attrs),[C("div",{class:w(["flex",[e.ui.gap,{"items-start":e.description||e.$slots.description,"items-center":!e.description&&!e.$slots.description}]])},[b(e.$slots,"icon",{icon:e.icon},()=>[e.icon?(n(),h(s,{key:0,name:e.icon,class:w(e.ui.icon.base)},null,8,["name","class"])):p("",!0)]),b(e.$slots,"avatar",{avatar:e.avatar},()=>[e.avatar?(n(),h(t,$({key:0},{size:e.ui.avatar.size,...e.avatar},{class:e.ui.avatar.base}),null,16,["class"])):p("",!0)]),C("div",{class:w(e.ui.inner)},[e.title||e.$slots.title?(n(),m("p",{key:0,class:w(e.ui.title)},[b(e.$slots,"title",{title:e.title},()=>[j(O(e.title),1)])],2)):p("",!0),e.description||e.$slots.description?(n(),m("div",{key:1,class:w(e.twMerge(e.ui.description,!e.title&&!e.$slots.title&&"mt-0 leading-5"))},[b(e.$slots,"description",{description:e.description},()=>[j(O(e.description),1)])],2)):p("",!0),(e.description||e.$slots.description)&&(e.actions.length||e.$slots.actions)?(n(),m("div",{key:2,class:w(e.ui.actions)},[b(e.$slots,"actions",{},()=>[(n(!0),m(M,null,q(e.actions,(u,f)=>(n(),h(g,$({key:f,ref_for:!0},{...e.ui.default.actionButton||{},...u},{onClick:B(k=>e.onAction(u),["stop"])}),null,16,["onClick"]))),128))])],2)):p("",!0)],2),e.closeButton||!e.description&&!e.$slots.description&&e.actions.length?(n(),m("div",{key:0,class:w(e.twMerge(e.ui.actions,"mt-0"))},[!e.description&&!e.$slots.description&&(e.actions.length||e.$slots.actions)?b(e.$slots,"actions",{key:0},()=>[(n(!0),m(M,null,q(e.actions,(u,f)=>(n(),h(g,$({key:f,ref_for:!0},{...e.ui.default.actionButton||{},...u},{onClick:B(k=>e.onAction(u),["stop"])}),null,16,["onClick"]))),128))]):p("",!0),e.closeButton?(n(),h(g,$({key:1,"aria-label":"Close"},{...e.ui.default.closeButton||{},...e.closeButton},{onClick:o[0]||(o[0]=B(u=>e.$emit("close"),["stop"]))}),null,16)):p("",!0)],2)):p("",!0)],2)],16)}const ne=G(se,[["render",ae]]),le={class:"flex justify-center"},re={class:"py-8"},ie={class:"border border-red-600 rounded-md p-5"},de={key:0},ve=D({__name:"login",setup(e){J("/persons");const o=A("create"),l=A({}),i={alert:A({color:"green",variant:"subtle",title:"Информация",description:"Введите логин и пароль"}),setAlert(s,t,g){this.alert.value.color=s,this.alert.value.title=t,this.alert.value.description=g}},_=s=>{const t=[];return o.value==="update"&&(s.password===s.new_pswd&&t.push({path:"new_pswd",message:"Старый и новый пароли совпадают"}),s.new_pswd&&!s.new_pswd.match(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,16}$/)&&t.push({path:"new_pswd",message:"Пароль должен быть от 8 до 16 цифр и латинских букв в нижнем и верхнем регистре"}),s.conf_pswd!==s.new_pswd&&t.push({path:"conf_pswd",message:"Новый пароль и подтверждение не совпадают"})),t};async function d(){const{message:s,user_token:t}=await $fetch("/api/login/"+o.value,{method:"POST",body:l.value});s==="Success"?(te.value=t,await Q("/persons")):s==="Updated"?(o.value="create",i.setAlert("blue","Информация","Войдите с новым паролем.")):s==="Denied"?(o.value="update",i.setAlert("red","Предупреждение","Пароль просрочен.")):i.setAlert("red","Внимание","Неправильный логин или пароль.")}return(s,t)=>{const g=ne,u=W,f=X,k=Y,U=z,N=x,T=ee;return n(),m("div",le,[C("div",re,[a(g,{variant:"subtle",color:i.alert.value.color,title:i.alert.value.title,description:i.alert.value.description},null,8,["color","title","description"]),a(u,{div:"py-5",cls:"text-2xl text-blue-800",header:"Кадровая безопасность"}),C("div",ie,[a(u,{div:"mb-1",cls:"text-xl text-red-800",header:r(o)==="create"?"Вход в систему":"Обновление пароля"},null,8,["header"]),a(T,{state:r(l),validate:_,class:"mt-4",onSubmit:B(d,["prevent"])},{default:y(()=>[a(k,{class:"mb-3",size:"md",label:"Логин",name:"username"},{default:y(()=>[a(f,{modelValue:r(l).username,"onUpdate:modelValue":t[0]||(t[0]=c=>r(l).username=c),placeholder:"username",icon:"i-heroicons-user",required:""},null,8,["modelValue"])]),_:1}),a(k,{class:"mb-3",size:"md",label:"Пароль",name:"password"},{default:y(()=>[a(f,{modelValue:r(l).password,"onUpdate:modelValue":t[1]||(t[1]=c=>r(l).password=c),type:"password",placeholder:"password",icon:"i-heroicons-lock-closed",required:""},null,8,["modelValue"])]),_:1}),r(o)==="update"?(n(),m("div",de,[a(k,{class:"mb-3",size:"md",label:"Новый пароль",name:"new_pswd"},{default:y(()=>[a(f,{modelValue:r(l).new_pswd,"onUpdate:modelValue":t[2]||(t[2]=c=>r(l).new_pswd=c),type:"password",placeholder:"password",icon:"i-heroicons-lock-closed",required:""},null,8,["modelValue"])]),_:1}),a(k,{class:"mb-3",size:"md",label:"Повтор пароля",name:"conf_pswd"},{default:y(()=>[a(f,{modelValue:r(l).conf_pswd,"onUpdate:modelValue":t[3]||(t[3]=c=>r(l).conf_pswd=c),type:"password",placeholder:"password",icon:"i-heroicons-lock-closed",required:""},null,8,["modelValue"])]),_:1})])):p("",!0),a(N,{class:"mt-3",size:"md",orientation:"horizontal"},{default:y(()=>[a(U,{label:"Принять",color:"green",variant:"outline",type:"submit"}),Z(a(U,{label:"Изменить",color:"blue",variant:"outline",onClick:t[4]||(t[4]=c=>o.value="update")},null,512),[[K,r(o)==="create"]]),a(U,{label:"Отмена",color:"red",variant:"outline",onClick:t[5]||(t[5]=c=>o.value="create")})]),_:1})]),_:1},8,["state"])])])])}}});export{ve as default};
