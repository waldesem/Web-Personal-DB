import{af as d,r as b,aC as f,an as u}from"./DqpPj892.js";const I=()=>async(n,a={})=>{if(m.value)a.headers={...a.headers,Authorization:`Basic ${m.value}`};else return d("/login");try{return await $fetch(n,a)}catch(o){return console.error(o),d("/login")}},i=I(),r="/api",m=b(""),k=()=>{const e=f("user",()=>({auth:!1,userId:"",username:"",role:"",region:""}));async function n(){const o=await i(`${r}/auth`);if(!o)return d("/login");Object.assign(e.value,{auth:!0,userId:o.id,username:o.username,role:o.role,region:o.region}),await D().getClassify(),d("/persons")}return{user:e,getCurrentUser:n}},D=()=>{const e=f(`${r}/classes`,()=>({}));async function n(){e.value=await $fetch(`${r}/classes`)}return{classes:e,getClassify:n}},T=()=>{const e=f(`${r}/persons`,()=>({candidates:[],page:1,prev:!1,next:!0,search:"",updated:`${new Date().toLocaleDateString("ru-RU")} в ${new Date().toLocaleTimeString("ru-RU")}`}));async function n(a=1){if(e.value.page<1){e.value.page=1;return}else e.value.page=a;const o=await i(`${r}/index/${e.value.page}`,{params:{search:e.value.search}});[e.value.candidates,e.value.next,e.value.prev]=o,e.value.updated=`${new Date().toLocaleDateString("ru-RU")} в ${new Date().toLocaleTimeString("ru-RU")}`}return{persons:e,getCandidates:n}},R=()=>{const e=f("anketa",()=>({})),n=f("share",()=>({candId:"",imageUrl:""}));async function a(t,s="view",c=n.value.candId){s==="self"&&!confirm("Вы действительно хотите включить/выключить режим правки")||(e.value[t]=await i(`${r}/${t}/${c}`,{params:{action:s}}))}async function o(){const t=await $fetch(`${r}/image`,{params:{image:e.value.persons.destination},responseType:"blob"});n.value.imageUrl=window.URL.createObjectURL(new Blob([t]))}async function g(){if(!confirm("Вы действительно хотите изменить регион?"))return;const t=await i(`${r}/region/${n.value.candId}`,{params:{region:e.value.persons.region}});console.log(t),a("persons"),u().add({icon:"i-heroicons-check-circle",title:"Информация",description:"Изменение региона успешно",color:"green"})}async function p(t,s){const c=await i(`${r}/${t}/${n.value.candId}`,{method:"POST",body:s});console.log(c),a(t),u().add({icon:"i-heroicons-check-circle",title:"Успешно",description:"Информация обновлена",color:"green"})}async function v(t,s){if(!confirm("Вы действительно хотите удалить запись?"))return;const c=await i(`${r}/${s}/${t}`,{method:"DELETE"});console.log(c),s==="persons"?d("/persons"):a(s),u().add({icon:"i-heroicons-information-circle",title:"Информация",description:`Запись с ID ${t} удалена`,color:"primary"})}async function y(t,s,c){const l=u(),h=new FormData;if(t){for(const $ of t)h.append("file",$);const S=await i(`${r}/file/${s}/${c}`,{method:"POST",body:h});console.log(S),s==="persons"?T().getCandidates(1):s==="image"?o():a(s==="anketa"?"persons":s),l.add({icon:"i-heroicons-check-circle",title:"Информация",description:"Файлы успешно загружены",color:"green"})}else l.add({icon:"i-heroicons-exclamation-triangle",title:"Внимание",description:"Ошибка при загрузке файла",color:"red"})}async function w(t,s){if(t=="create"){const c=await i(`${r}/resume`,{method:"POST",body:s});console.log(c),u().add({icon:"i-heroicons-check-circle",title:"Информация",description:"Данные успешно добавлены",color:"green"})}else p("persons",s)}return{anketa:e,share:n,getItem:a,changeRegion:g,updateItem:p,deleteItem:v,submitFile:y,submitResume:w,getImage:o}};export{D as a,r as b,m as c,R as d,T as e,k as s,I as u};
