import{f as I,I as z,r as A,g as F,h as N,w as o,o as _,i as t,c as k,a as p,b as s,G as R,A as h,B as w,E as j,d as r,t as l,n as x,k as E,p as G,H as P}from"./BL57t9pv.js";import{b as H,a as M,_ as J}from"./D0Q5Al_0.js";import{_ as O}from"./COsqmAdu.js";import{_ as q}from"./A1NmxWM6.js";import{_ as K}from"./Bf7Arzfu.js";import{d as Q}from"./Dot1e486.js";import{s as W,a as X}from"./Cthp-bJU.js";import{u as Y}from"./Bv7hFFh9.js";import"./HY00hp42.js";import"./BNoJJA1K.js";const Z={key:0,class:"relative"},ee={class:"my-6"},ae={class:"caption-bottom text-left"},te={key:1,class:"grid place-items-center py-8"},_e=I({__name:"persons",async setup(ne){let c,b;const g=X(),D=W(),$=z(),a=A({candidates:[],page:1,prev:!1,next:!0,search:"",upload:!1,updated:`${new Date().toLocaleDateString("ru-RU")} в ${new Date().toLocaleTimeString("ru-RU")}`}),{refresh:u,status:f}=([c,b]=F(async()=>Y("candidates",async()=>{if(a.value.page<1){a.value.page=1;return}const i=await g("/api/index/"+a.value.page,{params:{search:a.value.search}});[a.value.candidates,a.value.next,a.value.prev]=i,a.value.updated=`${new Date().toLocaleDateString("ru-RU")} в ${new Date().toLocaleTimeString("ru-RU")}`})),c=await c,b(),c),S=Q(async()=>{await u()},500),v=async(i=1)=>{a.value.page=i,await u()};async function U(i){if(!i)return;a.value.upload=!0;const n=new FormData;n.append("file",i[0]);const{person_id:d}=await g("/api/json",{method:"POST",body:n});return $.add({icon:"i-heroicons-check-circle",title:"Информация",description:"Файл успешно загружен",color:"green"}),a.value.upload=!1,x("/profile/"+d)}return(i,n)=>{const d=E,y=H,C=M,T=J,m=G,B=O,L=q,V=K;return _(),N(V,null,{default:o(()=>[t(D).role=="user"?(_(),k("div",Z,[p("div",{class:h(["absolute inset-y-0 right-0",{"animate-pulse":t(f)=="pending"||t(a).upload}]),title:"Загрузить json"},[s(C,{class:"mb-3",size:"md"},{label:o(()=>[s(d,{name:"i-heroicons-cloud-arrow-up",class:"w-8 h-8",style:{cursor:"pointer",color:"dodgerblue"}})]),default:o(()=>[R(s(y,{type:"file",accept:".json",onChange:n[0]||(n[0]=e=>U(e))},null,512),[[P,!1]])]),_:1})],2)])):w("",!0),s(T,{header:"КАНДИДАТЫ"}),p("div",ee,[s(y,{modelValue:t(a).search,"onUpdate:modelValue":n[1]||(n[1]=e=>t(a).search=e),placeholder:"поиск по фамилии, имени, отчеству",size:"lg",onInput:j(t(S),["prevent"])},null,8,["modelValue","onInput"])]),s(B,{loading:t(f)=="pending"||t(a).upload,"loading-state":{icon:"i-heroicons-arrow-path-20-solid",label:"Загрузка..."},progress:{color:"red",animation:"swing"},"empty-state":{icon:"i-heroicons-circle-stack-20-solid",label:"Ничего не найдено."},columns:[{key:"id",label:"#"},{key:"region",label:"Регион"},{key:"surname",label:"Фамилия Имя Отчество"},{key:"birthday",label:"Дата рождения"},{key:"inn",label:"ИНН"},{key:"snils",label:"СНИЛС"},{key:"created",label:"Обновлено"},{key:"username",label:"Сотрудник"},{key:"editable",label:"Статус"}],rows:t(a).candidates,onSelect:n[2]||(n[2]=e=>("navigateTo"in i?i.navigateTo:t(x))(`/profile/${e.id}`))},{"id-data":o(({row:e})=>[r(l(e.id),1)]),"region-data":o(({row:e})=>[r(l(e.region),1)]),"surname-data":o(({row:e})=>[r(l(`${e.surname} ${e.firstname} ${e.patronymic?e.patronymic:""}`),1)]),"birthday-data":o(({row:e})=>[r(l(new Date(e.birthday).toLocaleDateString()),1)]),"birthplace-data":o(({row:e})=>[r(l(e.birthplace?e.birthplace:""),1)]),"created-data":o(({row:e})=>[r(l(new Date(e.created).toLocaleDateString()),1)]),"username-data":o(({row:e})=>[r(l(e.username?e.username.toString().split(" ")[0]:""),1)]),"editable-data":o(({row:e})=>[p("div",{class:h(["text-start",e.editable?"text-red-600":"text-primary"])},[s(d,{name:e.editable?"i-heroicons-arrow-path":"i-heroicons-check-circle",class:h(["w-6 h-6",{" animate-spin":e.editable}])},null,8,["name","class"])],2)]),caption:o(()=>[p("caption",ae,[s(m,{variant:"link",icon:"i-heroicons-arrow-path",label:`Обновлено: ${t(a).updated}`,onClick:t(u)},null,8,["label","onClick"])])]),_:1},8,["loading","rows"]),t(a).prev||t(a).next?(_(),k("div",te,[s(L,{orientation:"horizontal"},{default:o(()=>[s(m,{disabled:!t(a).prev,label:"Назад",variant:"link",icon:"i-heroicons-chevron-double-left",onClick:n[3]||(n[3]=e=>v(t(a).page-1))},null,8,["disabled"]),s(m,{disabled:!t(a).next,label:"Вперед",variant:"link",trailing:"",icon:"i-heroicons-chevron-double-right",onClick:n[4]||(n[4]=e=>v(t(a).page+1))},null,8,["disabled"])]),_:1})])):w("",!0)]),_:1})}}});export{_e as default};
