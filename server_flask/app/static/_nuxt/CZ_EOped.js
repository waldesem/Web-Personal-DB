import{d as B,p as z,H as R,r as A,w as F,c as _,u as t,b as p,a as s,e as o,x as b,y as w,D as I,o as h,E as N,A as r,B as l,n as x,g as j,i as E,G}from"./C4_eX3-n.js";import{b as P,a as H,_ as J}from"./3LUgmtMX.js";import{_ as M}from"./BY7nR318.js";import{_ as O}from"./MjmhKUiO.js";import{u as q}from"./lDHJ1TUT.js";import{s as K}from"./B5F0X6Ps.js";import{a as Q}from"./Cz8Yms9K.js";import{d as W}from"./qGH1BmY5.js";import"./B4-F_tj2.js";const X={key:0,class:"relative"},Y={class:"my-6"},Z={class:"caption-bottom text-left"},ee={key:1,class:"grid place-items-center py-8"},pe=B({__name:"persons",async setup(ae){let c,g;z("/profile/[id]");const y=q(),D=K(),$=R(),a=A({candidates:[],page:1,prev:!1,next:!0,search:"",upload:!1,updated:`${new Date().toLocaleDateString("ru-RU")} в ${new Date().toLocaleTimeString("ru-RU")}`}),{refresh:u,status:v}=([c,g]=F(async()=>Q("candidates",async()=>{const i=await y("/api/index/"+a.value.page,{params:{search:a.value.search}});[a.value.candidates,a.value.next,a.value.prev]=i,a.value.updated=`${new Date().toLocaleDateString("ru-RU")} в ${new Date().toLocaleTimeString("ru-RU")}`})),c=await c,g(),c),S=W(async()=>{await u()},500),f=async(i=1)=>{a.value.page=i,await u()};async function U(i){if(!i)return;a.value.upload=!0;const n=new FormData;n.append("file",i[0]);const{person_id:d}=await y("/api/json",{method:"POST",body:n});return $.add({icon:"i-heroicons-check-circle",title:"Информация",description:"Файл успешно загружен",color:"green"}),a.value.upload=!1,x("/profile/"+d)}return(i,n)=>{const d=j,k=P,C=H,T=J,m=E,L=M,V=O;return h(),_("div",null,[t(D).role=="user"?(h(),_("div",X,[p("div",{class:b(["absolute inset-y-0 right-0",{"animate-pulse":t(v)=="pending"||t(a).upload}]),title:"Загрузить json"},[s(C,{class:"mb-3",size:"md"},{label:o(()=>[s(d,{name:"i-heroicons-cloud-arrow-up",class:"w-8 h-8",style:{cursor:"pointer",color:"dodgerblue"}})]),default:o(()=>[N(s(k,{type:"file",accept:".json",onChange:n[0]||(n[0]=e=>U(e))},null,512),[[G,!1]])]),_:1})],2)])):w("",!0),s(T,{header:"КАНДИДАТЫ"}),p("div",Y,[s(k,{modelValue:t(a).search,"onUpdate:modelValue":n[1]||(n[1]=e=>t(a).search=e),placeholder:"поиск по фамилии, имени, отчеству",size:"lg",onInput:I(t(S),["prevent"])},null,8,["modelValue","onInput"])]),s(L,{loading:t(v)=="pending"||t(a).upload,progress:{color:"red",animation:"swing"},"empty-state":{icon:"i-heroicons-circle-stack-20-solid",label:"Данные не найдены."},columns:[{key:"id",label:"#"},{key:"region",label:"Регион"},{key:"surname",label:"Фамилия Имя Отчество"},{key:"birthday",label:"Дата рождения"},{key:"inn",label:"ИНН"},{key:"snils",label:"СНИЛС"},{key:"created",label:"Обновлено"},{key:"username",label:"Сотрудник"},{key:"editable",label:"Статус"}],rows:t(a).candidates,onSelect:n[2]||(n[2]=e=>("navigateTo"in i?i.navigateTo:t(x))(`/profile/${e.id}`))},{"id-data":o(({row:e})=>[r(l(e.id),1)]),"region-data":o(({row:e})=>[r(l(e.region),1)]),"surname-data":o(({row:e})=>[r(l(`${e.surname} ${e.firstname} ${e.patronymic?e.patronymic:""}`),1)]),"birthday-data":o(({row:e})=>[r(l(new Date(e.birthday).toLocaleDateString()),1)]),"birthplace-data":o(({row:e})=>[r(l(e.birthplace?e.birthplace:""),1)]),"created-data":o(({row:e})=>[r(l(new Date(e.created).toLocaleDateString()),1)]),"username-data":o(({row:e})=>[r(l(e.username?e.username.toString().split(" ")[0]:""),1)]),"editable-data":o(({row:e})=>[p("div",{class:b(["text-start",e.editable?"text-red-600":"text-primary"])},[s(d,{name:e.editable?"i-heroicons-arrow-path":"i-heroicons-check-circle",class:b(["w-6 h-6",{" animate-spin":e.editable}])},null,8,["name","class"])],2)]),caption:o(()=>[p("caption",Z,[s(m,{variant:"link",icon:"i-heroicons-arrow-path",label:`Обновлено: ${t(a).updated}`,onClick:t(u)},null,8,["label","onClick"])])]),_:1},8,["loading","rows"]),t(a).prev||t(a).next?(h(),_("div",ee,[s(V,{orientation:"horizontal"},{default:o(()=>[s(m,{disabled:!t(a).prev,label:"Назад",variant:"link",icon:"i-heroicons-chevron-double-left",onClick:n[3]||(n[3]=e=>f(t(a).page-1))},null,8,["disabled"]),s(m,{disabled:!t(a).next,label:"Вперед",variant:"link",trailing:"",icon:"i-heroicons-chevron-double-right",onClick:n[4]||(n[4]=e=>f(t(a).page+1))},null,8,["disabled"])]),_:1})])):w("",!0)])}}});export{pe as default};
