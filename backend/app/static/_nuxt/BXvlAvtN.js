import{_ as M}from"./DmUv_Nof.js";import{_ as T}from"./D1l-KubI.js";import{_ as N}from"./Cay9Qj57.js";import{_ as O}from"./BpByd896.js";import{_ as j}from"./DHCsx2iL.js";import{_ as z}from"./R30G0gbg.js";import{_ as F}from"./CxuAO0fP.js";import{n as k,o as _,c as w,a as t,N as G,q as H,O as R,r as W,s as q,w as n,b as s,z as J,H as K,y as S,G as p,D as P,F as Q,d as i,t as a,p as X,e as Y,_ as Z}from"./Dinf_0xm.js";import{_ as ee}from"./CGFYxdEI.js";import{d as b,c as v,e as D,a as h}from"./DyhWwMfy.js";import{d as te}from"./Dot1e486.js";import"./86FpULSn.js";const le=["id"],oe={class:"modal-dialog"},se={class:"modal-content"},ae={class:"modal-body"},ne=k({__name:"ModalWin",props:{elemId:String},setup(c){const f=c;return(e,u)=>(_(),w("div",{class:"modal modal fade",id:f.elemId,tabindex:"-1"},[t("div",oe,[t("div",se,[t("div",ae,[G(e.$slots,"default")])])])],8,le))}}),g=c=>(X("data-v-8e05e648"),c=c(),Y(),c),re={class:"row mb-3"},de={class:"d-flex justify-content-between"},ie={class:"dropdown"},ce=g(()=>t("button",{class:"btn btn-link text-secondary dropdown-toogle",type:"button","data-bs-toggle":"dropdown"}," Добавить пользователя ",-1)),ue={class:"dropdown-menu"},me={class:"p-3"},pe={class:"mb-3"},_e={class:"mb-3"},fe=g(()=>t("tr",null,[t("th",{width:"5%"},"#"),t("th",null,"Имя пользователя"),t("th",{width:"15%"},"Логин"),t("th",{width:"10%"},"Блокировка"),t("th",{width:"15%"},"Создан"),t("th",{width:"15%"},"Роль"),t("th",{width:"20%"},"Регион")],-1)),be={colspan:"7"},ve={width:"5%"},he={width:"15%"},we=["onClick"],ge={width:"10%"},ye={width:"15%"},$e={width:"15%"},Ve={width:"20%"},xe={class:"p-3"},Se={class:"btn-group p-3",role:"group"},De=g(()=>t("button",{type:"button",class:"btn btn-outline-primary","data-bs-dismiss":"modal"}," Закрыть ",-1)),ke=k({__name:"users",setup(c){H(()=>{u()});const f=R(()=>e.value.users.filter(r=>r.deleted==e.value.viewDeleted)),e=W({search:"",users:[],profile:{},form:{},viewDeleted:!1});async function u(){try{const r=await b.get(`${v}/users`,{params:{search:e.value.search}});e.value.users=r.data}catch(r){console.error(r)}}const y=te(()=>{u()},500);async function m(r){if(!(r==="delete"&&!confirm("Вы действительно хотите удалить/восстановить пользователя?")))try{(await b.get(`${v}/users/${e.value.profile.id}`,{params:{item:r}})).status===205?h.setAlert("alert-warning","Невозможно выполнить операцию"):u()}catch(o){console.error(o)}}async function U(){try{(await b.post(`${v}/users`,e.value.form)).status===205?h.setAlert("alert-warning","Пользователь уже существует"):h.setAlert("alert-success","Пользователь успешно создан"),E(),u()}catch(r){console.error(r)}}function E(){Object.keys(e.value.profile).forEach(r=>delete e.value[r])}return(r,o)=>{const C=M,I=T,$=N,B=O,V=j,d=z,x=F,A=ne,L=ee;return _(),q(L,null,{default:n(()=>[s(C,{"page-header":"Список пользователей",cls:"text-secondary py-5"}),t("div",re,[J(t("input",{onInput:o[0]||(o[0]=S((...l)=>p(y)&&p(y)(...l),["prevent"])),class:"form-control mb-3",name:"search",id:"search",type:"text",placeholder:"Поиск по имени пользователя","onUpdate:modelValue":o[1]||(o[1]=l=>e.value.search=l)},null,544),[[K,e.value.search]])]),t("div",de,[s(I,{name:"viewDeleted",label:"Показать удаленные",modelValue:e.value.viewDeleted,"onUpdate:modelValue":o[2]||(o[2]=l=>e.value.viewDeleted=l)},null,8,["modelValue"]),t("div",ie,[ce,t("div",ue,[t("form",{onSubmit:S(U,["prevent"]),class:"form form-check",role:"form"},[t("div",me,[t("div",pe,[s($,{name:"fullname",place:"Имя пользователя",need:!0,modelValue:e.value.form.fullname,"onUpdate:modelValue":o[3]||(o[3]=l=>e.value.form.fullname=l)},null,8,["modelValue"])]),t("div",_e,[s($,{name:"username",place:"Учетная запись",pattern:"[a-z_]+",need:!0,modelValue:e.value.form.username,"onUpdate:modelValue":o[4]||(o[4]=l=>e.value.form.username=l)},null,8,["modelValue"])]),s(B,{offset:!1})])],32)])])]),s(V,{"tbl-class":"table align-middle"},{thead:n(()=>[fe]),tbody:n(()=>[t("tr",null,[t("td",be,[s(V,{id:"overflow","tbl-class":"table table-hover align-middle no-bottom-border"},{tbody:n(()=>[(_(!0),w(Q,null,P(f.value,l=>(_(),w("tr",{height:"50px",key:l.id},[t("td",ve,a(l.id),1),t("td",null,a(l.fullname),1),t("td",he,[t("button",{class:"btn btn-link text-secondary",type:"button","data-bs-toggle":"modal","data-bs-target":"#user-modal",onClick:Ue=>e.value.profile=l},a(l.username),9,we)]),t("td",ge,a(l.blocked?"Да":"Нет"),1),t("td",ye,a(new Date(l.pswd_create).toLocaleString()),1),t("td",$e,a(l.role),1),t("td",Ve,a(l.region),1)]))),128))]),_:1})])])]),_:1}),s(A,{"elem-id":"user-modal"},{default:n(()=>[t("div",xe,[s(d,{"label-class":"col-5","input-class":"col-7",label:"ID"},{default:n(()=>[i(a(e.value.profile.id),1)]),_:1}),s(d,{label:"Регион","label-class":"col-5","input-class":"col-7"},{default:n(()=>[s(x,{name:"region",select:p(D).classes.regions,modelValue:e.value.profile.region,"onUpdate:modelValue":o[5]||(o[5]=l=>e.value.profile.region=l),onSubmitData:o[6]||(o[6]=l=>m(e.value.profile.region))},null,8,["select","modelValue"])]),_:1}),s(d,{label:"Роль","label-class":"col-5","input-class":"col-7"},{default:n(()=>[s(x,{name:"role",select:p(D).classes.roles,modelValue:e.value.profile.role,"onUpdate:modelValue":o[7]||(o[7]=l=>e.value.profile.role=l),onSubmitData:o[8]||(o[8]=l=>m(e.value.profile.role))},null,8,["select","modelValue"])]),_:1}),s(d,{"label-class":"col-5","input-class":"col-7",label:"Имя пользователя"},{default:n(()=>[i(a(e.value.profile.fullname),1)]),_:1}),s(d,{"label-class":"col-5","input-class":"col-7",label:"Логин"},{default:n(()=>[i(a(e.value.profile.username),1)]),_:1}),s(d,{"label-class":"col-5","input-class":"col-7",label:"Дата создания пароля"},{default:n(()=>[i(a(new Date(e.value.profile.pswd_create+" UTC").toLocaleString("ru-RU")),1)]),_:1}),s(d,{"label-class":"col-5","input-class":"col-7",label:"Требует смены пароля"},{default:n(()=>[i(a(e.value.profile.change_pswd?"Да":"Нет"),1)]),_:1}),s(d,{"label-class":"col-5","input-class":"col-7",label:"Попытки входа"},{default:n(()=>[i(a(e.value.profile.attempt),1)]),_:1}),s(d,{"label-class":"col-5","input-class":"col-7",label:"Заблокирован"},{default:n(()=>[i(a(e.value.profile.blocked?"Заблокирован":"Разблокирован"),1)]),_:1}),s(d,{"label-class":"col-5","input-class":"col-7",label:"Активность"},{default:n(()=>[i(a(e.value.profile.deleted?"Удален":"Активен"),1)]),_:1}),s(d,{"label-class":"col-5","input-class":"col-7",label:"Роль"},{default:n(()=>[i(a(e.value.profile.role),1)]),_:1}),s(d,{"label-class":"col-5","input-class":"col-7",label:"Дата создания профиля"},{default:n(()=>[i(a(new Date(e.value.profile.created+" UTC").toLocaleString("ru-RU")),1)]),_:1})]),t("div",Se,[t("button",{onClick:o[9]||(o[9]=l=>m("drop")),type:"button",class:"btn btn-outline-secondary"}," Сбросить пароль "),t("button",{onClick:o[10]||(o[10]=l=>m("delete")),type:"button",class:"btn btn-outline-danger"},a(e.value.profile.deleted?"Восстановить":"Отметить к удалению"),1),De])]),_:1})]),_:1})}}}),Fe=Z(ke,[["__scopeId","data-v-8e05e648"]]);export{Fe as default};
