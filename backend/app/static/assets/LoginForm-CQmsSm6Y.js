const __vite__fileDeps=["./HeaderDiv-BD6m3_aV.js","./index-BG71lsAl.js","./index-6fGrG267.css","./LabelSlot-CCfTmxKV.js","./_plugin-vue_export-helper-DlAUqK2U.js","./LabelSlot-BKRWK_aH.css","./GroupInput-DiCVafXt.js","./BtnGroup-3KtPO9kS.js","./GroupContent-RWhhLl0t.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{d as V,m as g,o as c,c as v,a as t,u as o,h as l,q as y,w as s,y as A,n as h,B as x,C as k,b as i,e as d,r as E}from"./index-BG71lsAl.js";import{a as C,s as D}from"./utilities-UvCb7CcC.js";import{d as n}from"./state-Dg7n-Ma2.js";const L={class:"border border-primary rounded p-5"},I={class:"mb-3"},P={class:"input-group-text"},$={class:"row mb-3 col-lg-9 offset-lg-2"},B={key:0},U=V({__name:"LoginForm",setup(O){const _=i(()=>d(()=>import("./HeaderDiv-BD6m3_aV.js"),__vite__mapDeps([0,1,2]),import.meta.url)),m=i(()=>d(()=>import("./LabelSlot-CCfTmxKV.js"),__vite__mapDeps([3,1,2,4,5]),import.meta.url)),p=i(()=>d(()=>import("./GroupInput-DiCVafXt.js"),__vite__mapDeps([6,1,2]),import.meta.url)),f=i(()=>d(()=>import("./BtnGroup-3KtPO9kS.js"),__vite__mapDeps([7,1,2]),import.meta.url)),w=i(()=>d(()=>import("./GroupContent-RWhhLl0t.js"),__vite__mapDeps([8,1,2]),import.meta.url)),e=g({action:"create",hidden:!0,form:{}});async function b(){if(e.value.hidden=!0,e.value.action==="update"){if(e.value.form.password===e.value.form.new_pswd){n.setAlert("alert-warning","Старый и новый пароли совпадают");return}if(e.value.form.conf_pswd!==e.value.form.new_pswd){n.setAlert("alert-warning","Новый пароль и подтверждение не совпадают");return}if(e.value.form.new_pswd.match(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,16}$/)){n.setAlert("alert-warning","Пароль должен содержать от 8 до 16 латинских символов в верхнем и нижнем регистре, а также цифры");return}}try{const u=await C.post(`${D}/login/${e.value.action}`,e.value.form);switch(u.status){case 201:e.value.action="create",n.setAlert("alert-success","Войдите с новым паролем");break;case 200:const{user_token:a}=u.data;localStorage.setItem("user_token",a),E.push({name:"persons"});break;case 205:e.value.action="update",n.setAlert("alert-warning","Пароль просрочен. Измените пароль");break;case 204:e.value.action="create",n.setAlert("alert-danger","Неверный логин или пароль");break}}catch(u){n.setAlert("alert-warning",u)}}return(u,a)=>(c(),v("div",L,[t(o(_),{cls:"text-primary mb-3 text-center","page-header":e.value.action==="create"?"Вход в систему":"Изменить пароль"},null,8,["page-header"]),l("div",I,[l("form",{class:"form form-check",role:"form",onSubmit:y(b,["prevent"])},[t(o(m),{label:"Логин"},{default:s(()=>[t(o(p),{name:"username",place:"Логин",min:3,max:16,modelValue:e.value.form.username,"onUpdate:modelValue":a[0]||(a[0]=r=>e.value.form.username=r)},null,8,["modelValue"])]),_:1}),t(o(m),{label:"Пароль"},{default:s(()=>[t(o(p),{name:"password",place:"Пароль",min:8,max:16,type:e.value.hidden?"password":"text",modelValue:e.value.form.password,"onUpdate:modelValue":a[2]||(a[2]=r=>e.value.form.password=r)},{default:s(()=>[l("span",P,[l("a",{role:"button",onClick:a[1]||(a[1]=r=>e.value.hidden=!e.value.hidden)},[l("i",{class:A(e.value.hidden?"bi bi-eye":"bi bi-eye-slash")},null,2)])])]),_:1},8,["type","modelValue"])]),_:1}),h(l("div",$,[l("a",{class:"link-primary",href:"#",onClick:a[3]||(a[3]=r=>e.value.action="update")}," Изменить пароль ")],512),[[x,e.value.action==="create"]]),e.value.action==="update"?(c(),v("div",B,[t(o(m),{label:"Новый пароль"},{default:s(()=>[t(o(p),{name:"new_pswd",place:"Новый",min:8,max:16,type:e.value.hidden?"password":"text",modelValue:e.value.form.new_pswd,"onUpdate:modelValue":a[4]||(a[4]=r=>e.value.form.new_pswd=r)},null,8,["type","modelValue"])]),_:1}),t(o(m),{label:"Повтор пароля"},{default:s(()=>[t(o(p),{name:"conf_pswd",place:"Повтор",min:8,max:16,type:e.value.hidden?"password":"text",modelValue:e.value.form.conf_pswd,"onUpdate:modelValue":a[5]||(a[5]=r=>e.value.form.conf_pswd=r)},null,8,["type","modelValue"])]),_:1})])):k("",!0),t(o(f),null,{default:s(()=>[t(o(w),{"submit-btn":e.value.action==="create"?"Войти":"Изменить",onCancel:a[6]||(a[6]=r=>e.value.action="create")},null,8,["submit-btn"])]),_:1})],32)])]))}});export{U as default};
