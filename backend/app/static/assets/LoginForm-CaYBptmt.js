const __vite__fileDeps=["./HeaderDiv-CPHSjRiY.js","./index-a1q1DOXp.js","./index-6fGrG267.css","./LabelSlot-COZEDAF1.js","./_plugin-vue_export-helper-DlAUqK2U.js","./LabelSlot-BKRWK_aH.css","./GroupInput-CyV56IUk.js","./BtnGroup-BMh2ZB5X.js","./GroupContent-Dn83fNRW.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{d as A,n as y,o as v,c as f,b as t,u as o,a as l,s as x,w as n,y as h,q as k,z as E,B as C,e as u,f as d,j as D}from"./index-a1q1DOXp.js";import{e as s,b as _}from"./state-8kq10HP3.js";import{s as c}from"./utilities-DuY9392d.js";const L={class:"border border-primary rounded p-5"},I={class:"mb-3"},z={class:"input-group-text"},P={class:"row mb-3 col-lg-9 offset-lg-2"},B={key:0},S=A({__name:"LoginForm",setup(O){const w=u(()=>d(()=>import("./HeaderDiv-CPHSjRiY.js"),__vite__mapDeps([0,1,2]),import.meta.url)),m=u(()=>d(()=>import("./LabelSlot-COZEDAF1.js"),__vite__mapDeps([3,1,2,4,5]),import.meta.url)),p=u(()=>d(()=>import("./GroupInput-CyV56IUk.js"),__vite__mapDeps([6,1,2]),import.meta.url)),b=u(()=>d(()=>import("./BtnGroup-BMh2ZB5X.js"),__vite__mapDeps([7,1,2]),import.meta.url)),g=u(()=>d(()=>import("./GroupContent-Dn83fNRW.js"),__vite__mapDeps([8,1,2]),import.meta.url)),e=y({action:"login",hidden:!0,form:{}});async function V(){if(e.value.hidden=!0,e.value.action==="password"){if(e.value.form.password===e.value.form.new_pswd){s.setAlert("alert-warning","Старый и новый пароли совпадают");return}if(e.value.form.conf_pswd!==e.value.form.new_pswd){s.setAlert("alert-warning","Новый пароль и подтверждение не совпадают");return}delete e.value.form.conf_pswd}try{const i=e.value.action==="password"?await _.patch(`${c}/login`,e.value.form):await _.post(`${c}/login`,e.value.form);switch(i.status){case 201:e.value.action="login",s.setAlert("alert-success","Войдите с новым паролем");break;case 200:const{user_token:a}=i.data;localStorage.setItem("user_token",a),D.push({name:"persons"});break;case 205:e.value.action="password",s.setAlert("alert-warning","Пароль просрочен. Измените пароль");break;case 204:e.value.action="login",s.setAlert("alert-danger","Неверный логин или пароль");break}}catch(i){s.setAlert("alert-warning",i)}}return(i,a)=>(v(),f("div",L,[t(o(w),{cls:"text-primary mb-3 text-center","page-header":e.value.action==="login"?"Вход в систему":"Изменить пароль"},null,8,["page-header"]),l("div",I,[l("form",{class:"form form-check",role:"form",onSubmit:x(V,["prevent"])},[t(o(m),{label:"Логин"},{default:n(()=>[t(o(p),{name:"username",place:"Логин",min:3,max:16,pattern:"[a-zA-Z]+",modelValue:e.value.form.username,"onUpdate:modelValue":a[0]||(a[0]=r=>e.value.form.username=r)},null,8,["modelValue"])]),_:1}),t(o(m),{label:"Пароль"},{default:n(()=>[t(o(p),{name:"password",place:"Пароль",min:8,max:16,pattern:"[0-9a-zA-Z]+",type:e.value.hidden?"password":"text",modelValue:e.value.form.password,"onUpdate:modelValue":a[2]||(a[2]=r=>e.value.form.password=r)},{default:n(()=>[l("span",z,[l("a",{role:"button",onClick:a[1]||(a[1]=r=>e.value.hidden=!e.value.hidden)},[l("i",{class:h(e.value.hidden?"bi bi-eye":"bi bi-eye-slash")},null,2)])])]),_:1},8,["type","modelValue"])]),_:1}),k(l("div",P,[l("a",{class:"link-primary",href:"#",onClick:a[3]||(a[3]=r=>e.value.action="password")}," Изменить пароль ")],512),[[E,e.value.action==="login"]]),e.value.action==="password"?(v(),f("div",B,[t(o(m),{label:"Новый пароль"},{default:n(()=>[t(o(p),{name:"new_pswd",place:"Новый",min:8,max:16,pattern:"[0-9a-zA-Z]+",type:e.value.hidden?"password":"text",modelValue:e.value.form.new_pswd,"onUpdate:modelValue":a[4]||(a[4]=r=>e.value.form.new_pswd=r)},null,8,["type","modelValue"])]),_:1}),t(o(m),{label:"Повтор пароля"},{default:n(()=>[t(o(p),{name:"conf_pswd",place:"Повтор",min:8,max:16,pattern:"[0-9a-zA-Z]+",type:e.value.hidden?"password":"text",modelValue:e.value.form.conf_pswd,"onUpdate:modelValue":a[5]||(a[5]=r=>e.value.form.conf_pswd=r)},null,8,["type","modelValue"])]),_:1})])):C("",!0),t(o(b),null,{default:n(()=>[t(o(g),{"submit-btn":e.value.action==="login"?"Войти":"Изменить",onCancel:a[6]||(a[6]=r=>e.value.action="login")},null,8,["submit-btn"])]),_:1})],32)])]))}});export{S as default};
