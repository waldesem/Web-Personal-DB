const __vite__fileDeps=["./HeaderDiv-BGsjcrVS.js","./index-8uvu1PmF.js","./index-BqKjTnG4.css","./InputElement-C4ralCAM.js","./BtnGroup-EtpbKM5p.js","./GroupContent-DDUo5R5b.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{d as w,l as b,o as m,c as p,a as r,u as s,g as o,y as V,m as y,B as g,t as h,w as k,n as A,b as d,e as i,r as x}from"./index-8uvu1PmF.js";import{c as E,s as C}from"./utilities-Dq58mqGZ.js";import{d as n}from"./state-BEsVv8Mv.js";const D={class:"border border-primary rounded p-5"},I={class:"mb-3"},L={class:"mb-3"},B={key:0},P={class:"mb-3"},$={class:"mb-3"},O={class:"row mb-3 col-lg-9"},N=w({__name:"LoginForm",setup(R){const c=d(()=>i(()=>import("./HeaderDiv-BGsjcrVS.js"),__vite__mapDeps([0,1,2]),import.meta.url)),u=d(()=>i(()=>import("./InputElement-C4ralCAM.js"),__vite__mapDeps([3,1,2]),import.meta.url)),v=d(()=>i(()=>import("./BtnGroup-EtpbKM5p.js"),__vite__mapDeps([4,1,2]),import.meta.url)),f=d(()=>i(()=>import("./GroupContent-DDUo5R5b.js"),__vite__mapDeps([5,1,2]),import.meta.url)),e=b({action:"create",hidden:!0,form:{}});async function _(){if(e.value.hidden=!0,e.value.action==="update"){if(e.value.form.password===e.value.form.new_pswd){n.setAlert("alert-warning","Старый и новый пароли совпадают");return}if(e.value.form.conf_pswd!==e.value.form.new_pswd){n.setAlert("alert-warning","Новый пароль и подтверждение не совпадают");return}}try{const l=await E.post(`${C}/login/${e.value.action}`,e.value.form);switch(l.status){case 201:e.value.action="create",n.setAlert("alert-success","Войдите с новым паролем");break;case 200:const{user_token:t}=l.data;localStorage.setItem("user_token",t),x.push({name:"persons"});break;case 205:e.value.action="update",n.setAlert("alert-warning","Пароль просрочен. Измените пароль");break;case 204:e.value.action="create",n.setAlert("alert-danger","Неверный логин или пароль");break}}catch(l){n.setAlert("alert-warning",l)}}return(l,t)=>(m(),p("div",D,[r(s(c),{cls:"text-primary mb-3 text-center","page-header":e.value.action==="create"?"Вход в систему":"Изменить пароль"},null,8,["page-header"]),o("form",{class:"form form-check",role:"form",onSubmit:A(_,["prevent"])},[o("div",I,[r(s(u),{need:!0,name:"username",place:"Логин",modelValue:e.value.form.username,"onUpdate:modelValue":t[0]||(t[0]=a=>e.value.form.username=a)},null,8,["modelValue"])]),o("div",L,[r(s(u),{need:!0,name:"password",place:"Пароль",typeof:e.value.hidden?"password":"text",modelValue:e.value.form.password,"onUpdate:modelValue":t[1]||(t[1]=a=>e.value.form.password=a)},null,8,["typeof","modelValue"])]),e.value.action==="update"?(m(),p("div",B,[o("div",P,[r(s(u),{need:!0,name:"new_pswd",place:"Новый",min:8,max:16,typeof:e.value.hidden?"password":"text",modelValue:e.value.form.new_pswd,"onUpdate:modelValue":t[2]||(t[2]=a=>e.value.form.new_pswd=a)},null,8,["typeof","modelValue"])]),o("div",$,[r(s(u),{need:!0,name:"conf_pswd",place:"Повтор",typeof:e.value.hidden?"password":"text",modelValue:e.value.form.conf_pswd,"onUpdate:modelValue":t[3]||(t[3]=a=>e.value.form.conf_pswd=a)},null,8,["typeof","modelValue"])])])):V("",!0),o("div",O,[y(o("a",{class:"link-primary mb-2",href:"#",onClick:t[4]||(t[4]=a=>e.value.action="update")}," Изменить пароль ",512),[[g,e.value.action==="create"]]),o("a",{class:"link-primary",href:"#",onClick:t[5]||(t[5]=a=>e.value.hidden=!e.value.hidden)},h(e.value.hidden?"Показать":"Скрыть")+" пароль ",1)]),r(s(v),{offset:!1},{default:k(()=>[r(s(f),{"submit-btn":e.value.action==="create"?"Войти":"Изменить",onCancel:t[6]||(t[6]=a=>e.value.action="create")},null,8,["submit-btn"])]),_:1})],32)]))}});export{N as default};
