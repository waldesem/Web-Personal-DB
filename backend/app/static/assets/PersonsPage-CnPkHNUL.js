const __vite__fileDeps=["./HeaderDiv-DB0skjjr.js","./index-BhwzwnLH.js","./index-6fGrG267.css","./FileForm-46XpmVq8.js","./_plugin-vue_export-helper-DlAUqK2U.js","./FileForm-DJXAWPLZ.css","./TableSlots-DuKEsUef.js","./AscDesc-DrjFBtmM.js","./AscDesc-BQH9JYAH.css","./PageSwitcher-CBOxobA_.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{d as N,i as F,n as D,j as I,c,b as d,u as o,a as r,q as U,s as B,v as O,x as q,g as M,w as _,F as h,l as j,o as i,y as f,t as a,r as x,z,e as p,f as m}from"./index-BhwzwnLH.js";import{s as $,t as H,d as G}from"./utilities-DuY9392d.js";import{d as S,e as C}from"./state-BY_Xl-td.js";const J={class:"position-relative"},K={key:0,class:"spinner-border"},Q={class:"position-absolute bottom-100 end-0"},W=r("label",{for:"file",class:"text-primary"},[r("i",{class:"bi bi-cloud-arrow-down fs-1",title:"Загрузить анкету",style:{cursor:"pointer"}})],-1),X={class:"row mb-3"},Y={class:"form form-check",role:"form"},Z=r("i",{class:"bi bi-arrow-clockwise"},null,-1),ee=[Z],te={height:"50px"},se=["width"],re={key:1},ie=N({__name:"PersonsPage",setup(oe){const E=p(()=>m(()=>import("./HeaderDiv-DB0skjjr.js"),__vite__mapDeps([0,1,2]),import.meta.url)),P=p(()=>m(()=>import("./FileForm-46XpmVq8.js"),__vite__mapDeps([3,1,2,4,5]),import.meta.url)),k=p(()=>m(()=>import("./TableSlots-DuKEsUef.js"),__vite__mapDeps([6,1,2]),import.meta.url)),g=p(()=>m(()=>import("./AscDesc-DrjFBtmM.js"),__vite__mapDeps([7,1,2,4,8]),import.meta.url)),A=p(()=>m(()=>import("./PageSwitcher-CBOxobA_.js"),__vite__mapDeps([9,1,2]),import.meta.url));F(async()=>{await u()});const L={Проверка:"primary",ПФО:"info",Отменено:"secondary",Окончено:"secondary"},R={id:["#","5%"],region_id:["Регион","15%"],surname:["Фамилия Имя Отчество","25%"],birthday:["Дата рождения","15%"],status:["Статус","10%"],created:["Создан","15%"],user:["Сотрудник","15%"]},e=D({candidates:[],page:1,prev:!1,next:!1,search:"",sort:"status",order:"desc",spinner:!1,updated:`${new Date().toLocaleDateString("ru-RU")} в ${new Date().toLocaleTimeString("ru-RU")}`});async function u(n=1){e.value.page=n;try{const s=await S.get(`${$}/index/${e.value.page}`,{params:{search:e.value.search,sort:e.value.sort,order:e.value.order}});[e.value.candidates,e.value.next,e.value.prev]=s.data,e.value.updated=`${new Date().toLocaleDateString("ru-RU")} в ${new Date().toLocaleTimeString("ru-RU")}`}catch(s){s.request.status==401||s.request.status==403?I.push({name:"login"}):console.error(s)}}function w(n,s){e.value.sort=n,e.value.order=s,u()}const y=G(()=>{u()},500),b=D(new FormData);async function T(n){e.value.spinner=!0;const s=n.target;if(s.files){b.value.append("file",s.files[0]);try{const l=await S.post(`${$}/file/anketa/0`,b.value);console.log(l.status),u(),C.setAlert("alert-success","Файл успешно загружен")}catch(l){console.error(l)}}else C.setAlert("alert-warning","Ошибка при загрузке файла");e.value.spinner=!1}const V=n=>{const[s,l]=n.split(" ");return`${s} ${l}}`};return(n,s)=>{const l=j("router-link");return i(),c(h,null,[d(o(E),{"page-header":"Кандидаты"}),r("div",J,[e.value.spinner?(i(),c("span",K)):U("",!0),r("div",Q,[W,d(o(P),{accept:".json",onSubmit:T},null,8,["accept"])])]),r("div",X,[r("form",Y,[B(r("input",{onInput:s[0]||(s[0]=q((...t)=>o(y)&&o(y)(...t),["prevent"])),class:"form-control",name:"search",id:"search",type:"text",placeholder:"поиск по фамилии, имени, отчеству, инн","onUpdate:modelValue":s[1]||(s[1]=t=>e.value.search=t)},null,544),[[O,e.value.search]])])]),e.value.candidates.length?(i(),M(o(k),{key:0,"div-class":"table align-middle py-3"},{caption:_(()=>[f(a(`Обновлено: ${e.value.updated}`)+" ",1),r("a",{href:"#",title:"Обновить",onClick:s[2]||(s[2]=t=>u())},ee)]),thead:_(()=>[r("tr",te,[(i(),c(h,null,x(R,(t,v)=>r("th",{key:v,width:t[1]},[f(a(t[0])+" ",1),d(o(g),{order:"desc",sort:v,onSortCandidates:w},null,8,["sort"]),d(o(g),{order:"asc",sort:v,onSortCandidates:w},null,8,["sort"])],8,se)),64))])]),tbody:_(()=>[(i(!0),c(h,null,x(e.value.candidates,t=>(i(),c("tr",{key:t.id,height:"50px"},[r("td",null,a(t.id),1),r("td",null,a(t.region),1),r("td",null,[d(l,{to:{name:"profile",params:{id:t.id}}},{default:_(()=>[f(a(`${t.surname} ${t.firstname} ${t.patronymic?t.patronymic:""}`),1)]),_:2},1032,["to"])]),r("td",null,a(new Date(t.birthday).toLocaleDateString("ru-RU")),1),r("td",null,[r("label",{class:z(`fs-6 badge bg-${L[t.status]}`)},a(t.status),3)]),r("td",null,a(o(H)(t.created)),1),r("td",null,a(t.username?V(t.username.toString()):""),1)]))),128))]),_:1})):(i(),c("p",re,"Ничего не найдено")),d(o(A),{has_prev:e.value.prev,has_next:e.value.next,switchPrev:e.value.page-1,switchNext:e.value.page+1,onSwitch:u},null,8,["has_prev","has_next","switchPrev","switchNext"])],64)}}});export{ie as default};
