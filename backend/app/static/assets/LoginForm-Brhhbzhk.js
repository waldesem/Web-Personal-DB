const __vite__fileDeps=["assets/HeaderDiv-DM__yhnK.js","assets/index-BhT_3F5B.js","assets/index-D3owuatg.css","assets/LabelSlot-C8Y-0GKw.js","assets/GroupInput-2chAF9LH.js","assets/BtnGroup-CManQ3k2.js","assets/GroupContent-CBkEmxXT.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{d as h,q as k,o as c,c as v,b as o,u as n,a as s,z as y,w as l,E as x,t as E,v as C,K as D,e as i,f as d,j as r,N as _,s as f,O as I,I as L}from"./index-BhT_3F5B.js";const O={class:"border border-primary rounded p-5"},T={class:"mb-3"},z={class:"input-group-text"},P={class:"row mb-3 col-lg-9 offset-lg-2"},R={key:0},N=h({__name:"LoginForm",setup($){const w=i(()=>d(()=>import("./HeaderDiv-DM__yhnK.js"),__vite__mapDeps([0,1,2]))),u=i(()=>d(()=>import("./LabelSlot-C8Y-0GKw.js"),__vite__mapDeps([3,1,2]))),m=i(()=>d(()=>import("./GroupInput-2chAF9LH.js"),__vite__mapDeps([4,1,2]))),b=i(()=>d(()=>import("./BtnGroup-CManQ3k2.js"),__vite__mapDeps([5,1,2]))),g=i(()=>d(()=>import("./GroupContent-CBkEmxXT.js"),__vite__mapDeps([6,1,2]))),e=k({action:"login",hidden:!0,form:{}});async function V(){if(e.value.hidden=!0,e.value.action==="password"){if(e.value.form.password===e.value.form.new_pswd){r.setAlert("alert-warning","Старый и новый пароли совпадают");return}if(e.value.form.conf_pswd!==e.value.form.new_pswd){r.setAlert("alert-warning","Новый пароль и подтверждение не совпадают");return}delete e.value.form.conf_pswd}try{const p=e.value.action==="password"?await _.patch(`${f}/login`,e.value.form):await _.post(`${f}/login`,e.value.form),{message:a,access_token:t,refresh_token:A}=p.data;switch(a){case"Changed":e.value.action="login",r.setAlert("alert-success","Войдите с новым паролем");break;case"Authenticated":I.accessToken=t,localStorage.setItem("refresh_token",A),L.push({name:"persons"});break;case"Overdue":e.value.action="password",r.setAlert("alert-warning","Пароль просрочен. Измените пароль");break;case"Denied":e.value.action="login",r.setAlert("alert-danger","Неверный логин или пароль");break}}catch(p){r.setAlert("alert-warning",p)}}return(p,a)=>(c(),v("div",O,[o(n(w),{cls:"text-primary mb-3 text-center","page-header":e.value.action==="login"?"Вход в систему":"Изменить пароль"},null,8,["page-header"]),s("div",T,[s("form",{class:"form form-check",role:"form",onSubmit:y(V,["prevent"])},[o(n(u),{label:"Логин"},{default:l(()=>[o(n(m),{name:"username",place:"Логин",min:3,max:16,pattern:"[a-zA-Z]+",modelValue:e.value.form.username,"onUpdate:modelValue":a[0]||(a[0]=t=>e.value.form.username=t)},null,8,["modelValue"])]),_:1}),o(n(u),{label:"Пароль"},{default:l(()=>[o(n(m),{name:"password",place:"Пароль",min:8,max:16,pattern:"[0-9a-zA-Z]+",type:e.value.hidden?"password":"text",modelValue:e.value.form.password,"onUpdate:modelValue":a[2]||(a[2]=t=>e.value.form.password=t)},{default:l(()=>[s("span",z,[s("a",{role:"button",onClick:a[1]||(a[1]=t=>e.value.hidden=!e.value.hidden)},[s("i",{class:x(e.value.hidden?"bi bi-eye":"bi bi-eye-slash")},null,2)])])]),_:1},8,["type","modelValue"])]),_:1}),E(s("div",P,[s("a",{class:"link-primary",href:"#",onClick:a[3]||(a[3]=t=>e.value.action="password")}," Изменить пароль ")],512),[[C,e.value.action==="login"]]),e.value.action==="password"?(c(),v("div",R,[o(n(u),{label:"Новый пароль"},{default:l(()=>[o(n(m),{name:"new_pswd",place:"Новый",min:8,max:16,pattern:"[0-9a-zA-Z]+",type:e.value.hidden?"password":"text",modelValue:e.value.form.new_pswd,"onUpdate:modelValue":a[4]||(a[4]=t=>e.value.form.new_pswd=t)},null,8,["type","modelValue"])]),_:1}),o(n(u),{label:"Повтор пароля"},{default:l(()=>[o(n(m),{name:"conf_pswd",place:"Повтор",min:8,max:16,pattern:"[0-9a-zA-Z]+",type:e.value.hidden?"password":"text",modelValue:e.value.form.conf_pswd,"onUpdate:modelValue":a[5]||(a[5]=t=>e.value.form.conf_pswd=t)},null,8,["type","modelValue"])]),_:1})])):D("",!0),o(n(b),null,{default:l(()=>[o(n(g),{"submit-btn":e.value.action==="login"?"Войти":"Изменить",onCancel:a[6]||(a[6]=t=>e.value.action="login")},null,8,["submit-btn"])]),_:1})],32)])]))}});export{N as default};
