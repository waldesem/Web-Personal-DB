import{b as i,s as l}from"./utilities-B52xYZ_9.js";import{K as c,m as d,r as n}from"./index-cloJKXpO.js";const p=c({userId:"",username:"",hasAdmin:!1});d(localStorage.getItem("user_token"));const $=c({regions:{},status:{},conclusions:{},relations:{},affilations:{},educations:{},addresses:{},contacts:{},documents:{},poligrafs:{}}),a={alertMessage:c({attr:"",text:""}),setAlert(s="",e=""){this.alertMessage.attr=s,this.alertMessage.text=e,setTimeout(()=>{this.setAlert()},1e4)}},u={anketa:c({resume:{},previous:[],educations:[],staffs:[],documents:[],addresses:[],contacts:[],relations:[],workplaces:[],affilations:[],checks:[],poligrafs:[],investigations:[],inquiries:[]}),share:c({candId:"",imageUrl:""}),async getResume(s="view"){if(!(s==="self"&&!confirm("Вы действительно назначить проверку кандидата на себя?")))try{const e=await i.get(`${l}/persons/${this.share.candId}`,{params:{action:s}});this.anketa.resume=e.data,s==="self"&&a.setAlert("alert-info","Анкета назначена на себя")}catch(e){e.request.status==401||e.request.status==403?n.push({name:"login"}):(console.error(e),a.setAlert("alert-danger",`Ошибка: ${e}`))}},async getItem(s){try{const e=s==="image"?await i.get(`${l}/image/${this.share.candId}`,{responseType:"blob"}):await i.get(`${l}/${s}/${this.share.candId}`);s==="image"?this.share.imageUrl=window.URL.createObjectURL(new Blob([e.data])):this.anketa[s]=e.data}catch(e){e.request.status==401||e.request.status==403?n.push({name:"login"}):(console.error(e),a.setAlert("alert-danger",`Ошибка: ${e}`))}},async updateItem(s,e){try{const t=await i.post(`${l}/${s}/${u.share.candId}`,e);console.log(t.status),["checks","poligrafs"].includes(s)&&this.getResume(),this.getItem(s),a.setAlert("alert-success","Запись успешно добавлена")}catch(t){t.request.status==401||t.request.status==403?n.push({name:"login"}):(console.error(t),a.setAlert("alert-danger",`Ошибка: ${t}`))}},async deleteItem(s,e){if(confirm("Вы действительно хотите удалить запись?"))try{const t=await i.delete(`${l}/${e}/${s}`);console.log(t.status),e==="persons"?n.push({name:"persons"}):this.getItem(e),a.setAlert("alert-info",`Запись с ID ${s} удалена`)}catch(t){t.request.status==401||t.request.status==403?n.push({name:"login"}):(console.error(t),a.setAlert("alert-danger",`Ошибка: ${t}`))}}};async function A(s,e,t=u.share.candId){const f=new FormData,o=s.target;if(o&&o.files){for(let r=0;r<o.files.length;r++)if(o.files[r].size>10*1024*1024){a.setAlert("alert-warning","Превышен максимальный размер файла"),o.value="";return}else f.append("file",o.files[r]);try{const r=await i.post(`${l}/file/${e}/${t}`,f);if(console.log(r.status),e==="image"&&u.getItem(e),e==="persons"){const{person_id:g}=r.data;n.push({name:"profile",params:{id:g}})}a.setAlert("alert-success","Файл или файлы успешно загружен/добавлены")}catch(r){r.request.status==401||r.request.status==403?n.push({name:"login"}):console.error(r)}}else a.setAlert("alert-warning","Ошибка при загрузке файла")}export{$ as a,A as b,u as c,a as d,p as s};
