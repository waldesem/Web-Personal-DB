const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./HeaderDiv-D-i2ZNvd.js","./index-CuxALIEa.js","./index-QNw51pzy.css","./LabelSlot-D4bqwlze.js","./_plugin-vue_export-helper-DlAUqK2U.js","./LabelSlot-BMshfUVW.css","./InputElement-CEc8OtiF.js","./SelectDiv-2v3HxJoy.js","./SwitchBox-D12ymft0.js","./TableSlots-C4WwO4zj.js"])))=>i.map(i=>d[i]);
import{d as P,k as $,C as O,r as R,c as f,b as a,u as s,e,g as B,y as j,w as U,l as i,t as n,F as k,o as v,z as M,p as u,s as N,x as z,h as c,j as p}from"./index-CuxALIEa.js";import{f as h,b as g,g as I,s as A}from"./state-Dl_2yBjS.js";import{d as F}from"./utilities-Dot1e486.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";const w=m=>(N("data-v-615b6dc9"),m=m(),z(),m),q={class:"row mb-3"},G={class:"d-flex justify-content-between mb-3"},J=w(()=>e("button",{class:"btn btn-link text-secondary",type:"button","data-bs-toggle":"collapse",href:"#user-form"}," Добавить пользователя ",-1)),K={class:"collapse card card-body",id:"user-form"},Q={class:"row"},W={class:"col-4"},X={class:"col-3"},Y={class:"col-3"},Z={class:"col-1"},ee=w(()=>e("div",{class:"col-1"},[e("button",{class:"btn btn-outline-secondary",name:"submit",type:"submit"}," Сохранить ")],-1)),le=w(()=>e("tr",null,[e("th",{width:"5%"},"#"),e("th",null,"Имя пользователя"),e("th",{width:"15%"},"Логин"),e("th",{width:"10%"},"Блокировка"),e("th",{width:"15%"},"Создан"),e("th",{width:"15%"},"Администратор"),e("th",{width:"20%"},"Регион")],-1)),te={colspan:"7"},oe={width:"5%"},se={width:"15%"},ae=["onClick"],ne={width:"10%"},re={width:"15%"},ie={width:"15%"},de={width:"20%"},ue={class:"modal modal fade",id:"user-modal",tabindex:"-1"},ce={class:"modal-dialog"},pe={class:"modal-content"},me={class:"modal-body"},_e={class:"p-3"},be={class:"btn-group p-3",role:"group"},fe=P({__name:"UsersPage",setup(m){const S=c(()=>p(()=>import("./HeaderDiv-D-i2ZNvd.js"),__vite__mapDeps([0,1,2]),import.meta.url)),d=c(()=>p(()=>import("./LabelSlot-D4bqwlze.js"),__vite__mapDeps([3,1,2,4,5]),import.meta.url)),y=c(()=>p(()=>import("./InputElement-CEc8OtiF.js"),__vite__mapDeps([6,1,2]),import.meta.url)),V=c(()=>p(()=>import("./SelectDiv-2v3HxJoy.js"),__vite__mapDeps([7,1,2]),import.meta.url)),D=c(()=>p(()=>import("./SwitchBox-D12ymft0.js"),__vite__mapDeps([8,1,2]),import.meta.url)),x=c(()=>p(()=>import("./TableSlots-C4WwO4zj.js"),__vite__mapDeps([9,1,2]),import.meta.url));$(()=>{_()});const C=O(()=>l.value.users.filter(r=>r.deleted==l.value.viewDeleted)),l=R({search:"",users:[],profile:{},viewDeleted:!1});async function _(){try{const r=await h.get(`${g}/users`,{params:{search:l.value.search}});l.value.users=r.data}catch(r){console.error(r)}}const E=F(()=>{_()},500);async function b(r){if(!(r==="delete"&&!confirm("Вы действительно хотите удалить/восстановить пользователя?")))try{const t=await h.get(`${g}/users/${l.value.profile.id}`,{params:{item:r}});console.log(t.status),_()}catch(t){console.error(t)}}async function L(){try{(await h.post(`${g}/users`,l.value.profile)).status===205?A.setAlert("alert-warning","Пользователь уже существует"):A.setAlert("alert-success","Запись успешно добавлена"),T(),_()}catch(r){console.error(r)}}function T(){Object.keys(l.value.profile).forEach(t=>delete l.value[t]);const r=document.getElementById("user-form");r==null||r.setAttribute("class","collapse card card-body mb-3")}return(r,t)=>(v(),f(k,null,[a(s(S),{"page-header":"Список пользователей",cls:"text-secondary py-5"}),e("div",q,[B(e("input",{onInput:t[0]||(t[0]=U((...o)=>s(E)&&s(E)(...o),["prevent"])),class:"form-control mb-3",name:"search",id:"search",type:"text",placeholder:"Поиск по имени пользователя","onUpdate:modelValue":t[1]||(t[1]=o=>l.value.search=o)},null,544),[[j,l.value.search]])]),e("div",G,[a(s(D),{name:"viewDeleted",label:"Показать удаленные",modelValue:l.value.viewDeleted,"onUpdate:modelValue":t[2]||(t[2]=o=>l.value.viewDeleted=o)},null,8,["modelValue"]),J]),e("div",K,[e("form",{onSubmit:U(L,["prevent"]),class:"form form-check",role:"form"},[e("div",Q,[e("div",W,[a(s(y),{name:"fullname",place:"Имя пользователя",need:!0,modelValue:l.value.profile.fullname,"onUpdate:modelValue":t[3]||(t[3]=o=>l.value.profile.fullname=o)},null,8,["modelValue"])]),e("div",X,[a(s(y),{name:"username",place:"Учетная запись",pattern:"[a-z_]+",need:!0,modelValue:l.value.profile.username,"onUpdate:modelValue":t[4]||(t[4]=o=>l.value.profile.username=o)},null,8,["modelValue"])]),e("div",Y,[a(s(V),{name:"region",place:"Регион",need:!0,select:s(I).classes.regions,modelValue:l.value.profile.region,"onUpdate:modelValue":t[5]||(t[5]=o=>l.value.profile.region=o)},null,8,["select","modelValue"])]),e("div",Z,[a(s(D),{name:"admin",title:"Администратор",modelValue:l.value.profile.has_admin,"onUpdate:modelValue":t[6]||(t[6]=o=>l.value.profile.has_admin=o)},null,8,["modelValue"])]),ee])],32)]),a(s(x),{"tbl-class":"table align-middle"},{thead:i(()=>[le]),tbody:i(()=>[e("tr",null,[e("td",te,[a(s(x),{id:"overflow","tbl-class":"table table-hover align-middle no-bottom-border"},{tbody:i(()=>[(v(!0),f(k,null,M(C.value,o=>(v(),f("tr",{height:"50px",key:o.id},[e("td",oe,n(o.id),1),e("td",null,n(o.fullname),1),e("td",se,[e("button",{class:"btn btn-link text-secondary",type:"button","data-bs-toggle":"modal","data-bs-target":"#user-modal",onClick:ve=>l.value.profile=o},n(o.username),9,ae)]),e("td",ne,n(o.blocked?"Да":"Нет"),1),e("td",re,n(new Date(o.pswd_create).toLocaleString()),1),e("td",ie,n(o.has_admin?"Да":"Нет"),1),e("td",de,n(o.region),1)]))),128))]),_:1})])])]),_:1}),e("div",ue,[e("div",ce,[e("div",pe,[e("div",me,[e("div",_e,[a(s(d),{"label-class":"col-5","input-class":"col-7",label:"ID"},{default:i(()=>[u(n(l.value.profile.id),1)]),_:1}),a(s(d),{label:"Регион","label-class":"col-5","input-class":"col-7"},{default:i(()=>[a(s(V),{name:"region",select:s(I).classes.regions,modelValue:l.value.profile.region,"onUpdate:modelValue":t[7]||(t[7]=o=>l.value.profile.region=o),onSubmitData:t[8]||(t[8]=o=>b(l.value.profile.region))},null,8,["select","modelValue"])]),_:1}),a(s(d),{"label-class":"col-5","input-class":"col-7",label:"Имя пользователя"},{default:i(()=>[u(n(l.value.profile.fullname),1)]),_:1}),a(s(d),{"label-class":"col-5","input-class":"col-7",label:"Логин"},{default:i(()=>[u(n(l.value.profile.username),1)]),_:1}),a(s(d),{"label-class":"col-5","input-class":"col-7",label:"Дата создания пароля"},{default:i(()=>[u(n(new Date(l.value.profile.pswd_create+" UTC").toLocaleString("ru-RU")),1)]),_:1}),a(s(d),{"label-class":"col-5","input-class":"col-7",label:"Требует смены пароля"},{default:i(()=>[u(n(l.value.profile.change_pswd?"Да":"Нет"),1)]),_:1}),a(s(d),{"label-class":"col-5","input-class":"col-7",label:"Попытки входа"},{default:i(()=>[u(n(l.value.profile.attempt),1)]),_:1}),a(s(d),{"label-class":"col-5","input-class":"col-7",label:"Заблокирован"},{default:i(()=>[u(n(l.value.profile.blocked?"Заблокирован":"Разблокирован"),1)]),_:1}),a(s(d),{"label-class":"col-5","input-class":"col-7",label:"Активность"},{default:i(()=>[u(n(l.value.profile.deleted?"Удален":"Активен"),1)]),_:1}),a(s(d),{"label-class":"col-5","input-class":"col-7",label:"Администратор"},{default:i(()=>[u(n(l.value.profile.has_admin?"Да":"Нет"),1)]),_:1}),a(s(d),{"label-class":"col-5","input-class":"col-7",label:"Дата создания профиля"},{default:i(()=>[u(n(new Date(l.value.profile.created+" UTC").toLocaleString("ru-RU")),1)]),_:1})]),e("div",be,[e("button",{class:"btn btn-outline-primary",type:"button",onClick:t[9]||(t[9]=o=>b("admin"))},n(l.value.profile.has_admin?"Отобрать админа":"Сделать админом"),1),e("button",{onClick:t[10]||(t[10]=o=>b("drop")),type:"button",class:"btn btn-outline-secondary"}," Сбросить пароль "),e("button",{onClick:t[11]||(t[11]=o=>b("delete")),type:"button",class:"btn btn-outline-danger"},n(l.value.profile.deleted?"Восстановить":"Удалить"),1)])])])])])],64))}}),Ve=H(fe,[["__scopeId","data-v-615b6dc9"]]);export{Ve as default};
