import{a as i,s as l}from"./utilities-DksN3XFX.js";import{K as c,m as d,r as n}from"./index-DCiFGIcJ.js";const p=c({userId:"",username:"",hasAdmin:!1});d(localStorage.getItem("user_token"));const $=c({regions:{},status:{},conclusions:{},relations:{},affilations:{},educations:{},addresses:{},contacts:{},documents:{},poligrafs:{}}),a={alertMessage:c({attr:"",text:""}),setAlert(t="",s=""){this.alertMessage.attr=t,this.alertMessage.text=s,setTimeout(()=>{this.setAlert()},1e4)}},u={anketa:c({persons:{},previous:[],educations:[],staffs:[],documents:[],addresses:[],contacts:[],relations:[],workplaces:[],affilations:[],checks:[],poligrafs:[],investigations:[],inquiries:[]}),share:c({candId:"",imageUrl:""}),async getItem(t,s="view"){if(!(s==="self"&&!confirm("Вы действительно назначить проверку кандидата на себя?")))try{const e=t==="image"?await i.get(`${l}/image/${this.share.candId}`,{responseType:"blob"}):await i.get(`${l}/${t}/${this.share.candId}`,{params:{action:s}});t==="image"?this.share.imageUrl=window.URL.createObjectURL(new Blob([e.data])):this.anketa[t]=e.data,s==="self"&&a.setAlert("alert-info","Анкета назначена пользователю")}catch(e){e.request.status==401||e.request.status==403?n.push({name:"login"}):(console.error(e),a.setAlert("alert-danger",`Ошибка: ${e}`))}},async updateItem(t,s){try{const e=await i.post(`${l}/${t}/${u.share.candId}`,s);console.log(e.status),["checks","poligrafs"].includes(t)&&this.getItem("persons"),this.getItem(t),a.setAlert("alert-success","Запись успешно добавлена")}catch(e){e.request.status==401||e.request.status==403?n.push({name:"login"}):(console.error(e),a.setAlert("alert-danger",`Ошибка: ${e}`))}},async deleteItem(t,s){if(confirm("Вы действительно хотите удалить запись?"))try{const e=await i.delete(`${l}/${s}/${t}`);console.log(e.status),s==="persons"?n.push({name:"persons"}):this.getItem(s),a.setAlert("alert-info",`Запись с ID ${t} удалена`)}catch(e){e.request.status==401||e.request.status==403?n.push({name:"login"}):(console.error(e),a.setAlert("alert-danger",`Ошибка: ${e}`))}}};async function A(t,s,e=u.share.candId){const f=new FormData,o=t.target;if(o&&o.files){for(let r=0;r<o.files.length;r++)if(o.files[r].size>10*1024*1024){a.setAlert("alert-warning","Превышен максимальный размер файла"),o.value="";return}else f.append("file",o.files[r]);try{const r=await i.post(`${l}/file/${s}/${e}`,f);if(console.log(r.status),s==="image"&&u.getItem(s),s==="persons"){const{person_id:g}=r.data;n.push({name:"profile",params:{id:g}})}a.setAlert("alert-success","Файл или файлы успешно загружен/добавлены")}catch(r){r.request.status==401||r.request.status==403?n.push({name:"login"}):console.error(r)}}else a.setAlert("alert-warning","Ошибка при загрузке файла")}export{$ as a,A as b,u as c,a as d,p as s};
