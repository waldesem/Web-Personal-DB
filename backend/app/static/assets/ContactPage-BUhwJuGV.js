const __vite__fileDeps=["./HeaderDiv-BrJu6fvd.js","./index-BYAJzIZ5.js","./index-6fGrG267.css","./TableSlots-B6c2wwRK.js","./ModalWin-CNjviR8r.js","./ConnectDiv-BuloB19P.js","./PageSwitcher-DEBFnXDB.js","./ConnectForm-CfQmt7u4.js","./state-p7j6PBAe.js","./utilities-DuY9392d.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{d as V,i as I,n as O,c as _,b as u,u as s,g as T,B as L,q as g,z as B,a as t,s as R,v as S,w as m,C as N,y as M,F as w,o as v,r as z,t as d,e as l,f as r}from"./index-BYAJzIZ5.js";import{b as F,d as b,e as f}from"./state-p7j6PBAe.js";import{s as p,d as j}from"./utilities-DuY9392d.js";const q={class:"mb-3"},G=t("tr",null,[t("th",{width:"18%"},"Название"),t("th",{width:"18%"},"Имя"),t("th",{width:"18%"},"Телефон"),t("th",{width:"18%"},"Добавочный"),t("th",{width:"18%"},"Мобильный"),t("th",{width:"5%"}),t("th",{width:"5%"})],-1),H=["onClick"],U=["onClick"],W=t("i",{class:"bi bi-pencil-square"},null,-1),J=[W],K={width:"5%"},Q=["onClick"],X=t("i",{class:"bi bi-trash"},null,-1),Y=[X],ne=V({__name:"ContactPage",setup(Z){const C=l(()=>r(()=>import("./HeaderDiv-BrJu6fvd.js"),__vite__mapDeps([0,1,2]),import.meta.url)),y=l(()=>r(()=>import("./TableSlots-B6c2wwRK.js"),__vite__mapDeps([3,1,2]),import.meta.url)),k=l(()=>r(()=>import("./ModalWin-CNjviR8r.js"),__vite__mapDeps([4,1,2]),import.meta.url)),x=l(()=>r(()=>import("./ConnectDiv-BuloB19P.js"),__vite__mapDeps([5,1,2]),import.meta.url)),E=l(()=>r(()=>import("./PageSwitcher-DEBFnXDB.js"),__vite__mapDeps([6,1,2]),import.meta.url)),D=l(()=>r(()=>import("./ConnectForm-CfQmt7u4.js"),__vite__mapDeps([7,1,2,8,9]),import.meta.url));I(async()=>{await $(),await c(1)});const e=O({view:[],companies:[],cities:[],contacts:[],page:1,prev:!1,next:!1,action:"",search:"",item:{}});async function $(){try{const o=await F.get(`${p}/connects`),{view:n,companies:a,cities:i}=o.data;Object.assign(e.value,{view:n,companies:a,cities:i})}catch(o){console.error(o)}}async function c(o){e.value.action="";try{const n=await b.get(`${p}/connect/${o}`,{params:{search:e.value.search}}),{contacts:a,has_prev:i,has_next:P}=n.data;Object.assign(e.value,{contacts:a,prev:i,next:P})}catch(n){console.error(n)}}async function A(o){if(confirm("Вы действительно хотите удалить контакт?"))try{const n=await b.delete(`${p}/connect/${o}`);console.log(n.status),f.setAlert("alert-success",`Контакт с ID ${o} удален`),c(e.value.page)}catch(n){console.log(n),f.setAlert("alert-danger",`Ошибка при удалении контакта с ID ${o}`)}}const h=j(()=>{c(1)},500);return(o,n)=>(v(),_(w,null,[u(s(C),{"page-header":e.value.action?"Изменить/добавить контакт":"Контакты"},null,8,["page-header"]),e.value.action?(v(),T(s(D),{key:0,page:e.value.page,action:e.value.action,names:e.value.view,companies:e.value.companies,cities:e.value.cities,item:e.value.item,onGetContacts:c,onCancelEdit:n[0]||(n[0]=a=>e.value.action="")},null,8,["page","action","names","companies","cities","item"])):L("",!0),g(t("div",q,[g(t("input",{onInput:n[1]||(n[1]=R((...a)=>s(h)&&s(h)(...a),["prevent"])),class:"form-control mb-5",name:"search",id:"search",type:"text",placeholder:"Поиск по организации","onUpdate:modelValue":n[2]||(n[2]=a=>e.value.search=a)},null,544),[[S,e.value.search]]),u(s(k),{id:"modalConnect",title:e.value.item.fullname,size:"modal-md"},{default:m(()=>[u(s(x),{item:e.value.item},null,8,["item"])]),_:1},8,["title"]),u(s(y),{class:M({"table-hover":e.value.contacts.length>0})},N({caption:m(()=>[t("button",{class:"btn btn-link btn-sm",role:"button",onClick:n[3]||(n[3]=a=>e.value.action="create")}," Добавить контакт ")]),thead:m(()=>[G]),_:2},[e.value.contacts.length>0?{name:"tbody",fn:m(()=>[(v(!0),_(w,null,z(e.value.contacts,a=>(v(),_("tr",{key:a.id},[t("td",null,d(a.company),1),t("td",null,[t("a",{href:"#",title:"Посмотреть контакт","data-bs-target":"#modalConnect","data-bs-toggle":"modal",onClick:i=>e.value.item=a},d(a.fullname),9,H)]),t("td",null,d(a.phone),1),t("td",null,d(a.adding),1),t("td",null,d(a.mobile),1),t("td",null,[t("button",{class:"btn btn-link",type:"button",title:"Изменить контакт",onClick:i=>{e.value.action="edit",e.value.item=a}},J,8,U)]),t("td",K,[t("a",{href:"#",title:"Удалить",onClick:i=>A(a.id)},Y,8,Q)])]))),128))]),key:"0"}:void 0]),1032,["class"]),u(s(E),{has_prev:e.value.next,has_next:e.value.prev,switchPrev:e.value.page-1,switchNext:e.value.page+1,onSwitch:c},null,8,["has_prev","has_next","switchPrev","switchNext"])],512),[[B,!e.value.action]])],64))}});export{ne as default};
