const __vite__fileDeps=["assets/HeaderDiv-Bjks6c5q.js","assets/index-C5gLaoji.js","assets/index-D3owuatg.css","assets/SelectObject-DfHMJpEA.js","assets/LabelSlot-BBAP09GH.js","assets/UserForm-DJS8z7Pq.js","assets/BtnGroup-BNMpN1dP.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{d as I,n as S,I as L,q as R,h as b,s as m,j as c,o as y,c as g,b as a,u as l,a as d,w as s,k as x,K as P,F as $,B as u,C as r,x as U,D as B,e as f,p as h,m as O,f as _}from"./index-C5gLaoji.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";const N=v=>(h("data-v-4d36f6e7"),v=v(),O(),v),F={class:"mb-3"},j=["onClick"],q=N(()=>d("i",{class:"bi bi-dash-circle"},null,-1)),G=[q],H=["disabled"],K=I({__name:"UserProfile",setup(v){const w=f(()=>_(()=>import("./HeaderDiv-Bjks6c5q.js"),__vite__mapDeps([0,1,2]))),A=f(()=>_(()=>import("./SelectObject-DfHMJpEA.js"),__vite__mapDeps([3,1,2]))),n=f(()=>_(()=>import("./LabelSlot-BBAP09GH.js"),__vite__mapDeps([4,1,2]))),D=f(()=>_(()=>import("./UserForm-DJS8z7Pq.js"),__vite__mapDeps([5,1,2]))),C=f(()=>_(()=>import("./BtnGroup-BNMpN1dP.js"),__vite__mapDeps([6,1,2])));S(async()=>{e.value.id=L.currentRoute.value.params.id.toString(),await p("view")});const e=R({id:"",action:"",role:"",profile:{}});async function p(i){try{const t=await b.get(`${m}/user/${e.value.id}`,{params:{action:i}});e.value.profile=t.data,i==="drop"?c.setAlert("alert-success","Пароль сброшен"):i==="block"&&c.setAlert("alert-success",`Пользователь ${e.value.profile.blocked?"заблокирован":"разблокирован"}`)}catch(t){c.setAlert("alert-danger",t)}}async function E(){if(confirm("Вы действительно хотите удалить пользователя?"))try{const i=await b.delete(`${m}/user/${e.value.id}`);console.log(i.status),c.setAlert("alert-success","Пользователь отмечен к удалению"),p("view")}catch(i){c.setAlert("alert-danger",i)}}async function k(i,t){if(t){try{const o=i==="add"?await b.get(`${m}/role/${t}/${e.value.id}`):await b.delete(`${m}/role/${t}/${e.value.id}`);console.log(o.status),p("view"),c.setAlert("alert-success",`Роль ${i==="add"?"добавлена":"удалена"}`)}catch(o){c.setAlert("alert-danger",o)}e.value.role=""}}return(i,t)=>(y(),g($,null,[a(l(w),{"page-header":e.value.profile.fullname,cls:"text-secondary py-3"},null,8,["page-header"]),d("div",F,[a(l(n),{label:"ID"},{default:s(()=>[u(r(e.value.profile.id),1)]),_:1}),a(l(n),{label:"Имя пользователя"},{default:s(()=>[u(r(e.value.profile.fullname),1)]),_:1}),a(l(n),{label:"Логин"},{default:s(()=>[u(r(e.value.profile.username),1)]),_:1}),a(l(n),{label:"E-mail"},{default:s(()=>[u(r(e.value.profile.email),1)]),_:1}),a(l(n),{label:"Дата создания"},{default:s(()=>[u(r(new Date(e.value.profile.pswd_create).toLocaleString("ru-RU")),1)]),_:1}),a(l(n),{label:"Дата изменения"},{default:s(()=>[u(r(new Date(e.value.profile.pswd_change).toLocaleString("ru-RU")),1)]),_:1}),a(l(n),{label:"Дата последнего входа"},{default:s(()=>[u(r(new Date(e.value.profile.last_login).toLocaleString("ru-RU")),1)]),_:1}),a(l(n),{label:"Попытки входа"},{default:s(()=>[u(r(e.value.profile.attempt),1)]),_:1}),a(l(n),{label:"Заблокирован"},{default:s(()=>[u(r(e.value.profile.blocked?"Заблокирован":"Разблокирован"),1)]),_:1}),a(l(n),{label:"Активность"},{default:s(()=>[u(r(e.value.profile.deleted?"Удален":"Активен"),1)]),_:1}),a(l(n),{label:"Роли"},{default:s(()=>[(y(!0),g($,null,U(e.value.profile.roles,(o,V)=>(y(),g("ul",{key:V},[d("li",null,[u(r(o.role)+" ",1),d("button",{type:"button",class:"btn btn-link",onClick:M=>k("delete",o.id)},G,8,j)])]))),128)),a(l(A),{name:"role",select:l(B).roles,modelValue:e.value.role,"onUpdate:modelValue":t[0]||(t[0]=o=>e.value.role=o),onSubmitData:t[1]||(t[1]=o=>k("add",e.value.role))},null,8,["select","modelValue"])]),_:1}),e.value.action?(y(),x(l(D),{key:0,action:e.value.action,item:e.value.profile,onUpdate:t[2]||(t[2]=o=>{e.value.action="",p("view")})},null,8,["action","item"])):P("",!0),a(l(C),{offset:!1},{default:s(()=>[d("button",{class:"btn btn-outline-primary",type:"button",onClick:t[3]||(t[3]=o=>e.value.action===""?e.value.action="edit":e.value.action="")},r(e.value.action===""?"Редактировать":"Отменить"),1),d("button",{onClick:t[4]||(t[4]=o=>p("block")),class:"btn btn-outline-info"},r(e.value.profile.blocked?"Разблокировать":"Заблокировать"),1),d("button",{onClick:t[5]||(t[5]=o=>p("drop")),type:"button",class:"btn btn-outline-secondary"}," Сбросить пароль "),d("button",{onClick:E,type:"button",class:"btn btn-outline-danger",disabled:e.value.profile.deleted}," Удалить ",8,H)]),_:1})])],64))}}),Q=T(K,[["__scopeId","data-v-4d36f6e7"]]);export{Q as default};
