{% extends 'base.html' %}
{% block title %}Профиль кандидата{% endblock %}
{% block app_content %}
<div class="container">
    <h3>{{ candidate.full_name }}</h3>
    <ul class="nav nav-tabs" id="myTabEvents">
        <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" type="button" data-bs-target="#profile">Профиль</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" type="button" data-bs-target="#check">Проверки</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" type="button" data-bs-target="#registry">Согласование</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" type="button" data-bs-target="#poligraf">Полиграф</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" type="button" data-bs-target="#investigate">Расследования</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" type="button" data-bs-target="#inquiry">Запросы</button></li>
    </ul>
    <div class="tab-content">
        <div class="tab-pane fade show active" id="profile">
            <table class="table table-hover">
                {% if last_names %}
                <tr><td>Изменение имени</td><td>{{ candidate.last_name }}</td></tr>
                {% endif %}
                <tr><td>Дата рождения</td><td>{{ candidate.birthday }}</td></tr>
                <tr><td>Место рождения</td><td>{{ candidate.birth_place }}</td></tr>
                <tr><td>Гражданство</td><td>{{ candidate.country }}</td></tr>
                <tr><td colspan="2">Паспорт</td></tr>
                {% for pas in passports %}
                <tr><td>Серия</td><td>{{ pas.series_passport }}</td></tr>
                <tr><td>Номер</td><td>{{ pas.number_passport }}</td></tr>
                <tr><td>Кем выдан</td><td>{{ pas.agency }}</td></tr>
                <tr><td>Дата</td><td>{{ pas.date_given }}</td></tr>
                {% endfor %}
                <tr><td>СНИЛС</td><td>{{ candidate.snils }}</td></tr>
                <tr><td>ИНН</td><td>{{ candidate.inn }}</td></tr>
                <tr><td colspan="2">Адреса</td></tr>
                {% if addresses %}
                {% for addr in addresses %}
                <tr><td>Тип</td><td>{{ addr.type }}</td></tr>
                <tr><td>Регион</td><td>{{ addr.region }}</td></tr>
                <tr><td>Город</td><td>{{ addr.city }}</td></tr>
                <tr><td>Адрес</td><td>{{ addr.address }}</td></tr>
                {% endfor %}
                {% else %}
                <tr><td colspan="2">адреса не найдены</td></tr>
                {% endif %}
                <tr><td colspan="2">Контакты</td></tr>
                {% if contact %}
                {% for cont in contact %}
                <tr><td>Контакт</td><td>{{ cont.contact }}</td></tr>
                {% endfor %}
                {% else %}
                <tr><td colspan="2">контакты не найдены</td></tr>
                {% endif %}
                <tr><td>Образование</td><td>{{ candidate.education }}</td></tr>
                <tr><td colspan="2">Работа</td></tr>
                {% if workplaces %}
                {% for work in workplaces %}
                <tr><td>Период</td><td>{{ work.period }}</td></tr>
                <tr><td>Организация</td><td>{{ work.work_place }}</td></tr>
                <tr><td>Адрес</td><td>{{ work.address }}</td></tr>
                <tr><td>Должность</td><td>{{ work.staff }}</td></tr>
                {% endfor %}
                {% else %}
                <tr><td colspan="2">места работы не найдены</td></tr>
                {% endif %}
                <tr><td colspan="2">Связи</td></tr>
                {% if relations %}
                {% for rel in relations %}
                <tr><td>Связь</td><td>{{ rel.relation }}</td></tr>
                <tr><td>Имя</td><td>{{ rel.full_name }}</td></tr>
                <tr><td>Дата рождения</td><td>{{ rel.birthday }}</td></tr>
                <tr><td>Адрес</td><td>{{ rel.address }}</td></tr>
                <tr><td>Место работы</td><td>{{ rel.workplace }}</td></tr>
                <tr><td>Контакты</td><td>{{ rel.contact }}</td></tr>
                {% endfor %}
                {% else %}
                <tr><td colspan="2">связи не найдены</td></tr>
                {% endif %}
                <tr><td>Дополнительная информация</td><td>{{ candidate.addition }}</td></tr>
                <tr><td colspan="2">Должности</td></tr>
                {% if staffs %}
                {% for st in staffs%}
                <tr><td>Должность</td><td>{{ st.staff }}</td></tr>
                <tr><td>Департамент</td><td>{{ st.department }}</td></tr>
                {% endfor %}
                {% else %}
                <tr><td colspan="2">должности не найдены</td></tr>
                {% endif %}
                <tr><td>Статус</td><td>{{ candidate.status }}</td></tr>
                <tr><td>Дата обновления</td><td>{{ candidate.update_date }}</td></tr>
            </table>
            <form>
                <a class="btn btn-primary" href="{{ url_for('route.resume', cand_id=candidate.id) }}">Редактировать анкету</a>
                <a class="btn btn-info" href="{{ url_for('api.send_resume', cand_id=candidate.id) }}">Отправить на проверку</a>
            </form>
        </div>
        <div class="tab-pane fade" id="check">
            <a class="btn btn-primary" href="{{ url_for('route.check', cand_id=candidate.id, check_id=0) }}" target="_blank">Добавить проверку</a>
            {% if checks|length != 0 %} {# если ранее проверялся открываем последнюю проверку #}
            {% for check in checks.last %} {# загружаем последнюю проверку #}
            <table class="table table-hover">
                <tr><th>ID #{{ check.id }}</th><th><a href="{{ check.url }}">Материалы проверки</a></th></tr>
                <tr><td>Бывший работник МТСБ</td><td>{{ check.former_employee }}</td></tr>
                <tr><td>Проверка по местам работы</td><td>{{ check.check_work_place }}</td></tr>
                <tr><td>Проверка паспорта</td><td>{{ check.check_passport }}</td></tr>
                <tr><td>Проверка ИНН</td><td>{{ check.check_inn }}</td></tr>
                <tr><td>Проверка ФССП</td><td>{{ check.check_debt }}</td></tr>
                <tr><td>Проверка банкротства</td><td>{{ check.check_bankruptcy }}</td></tr>
                <tr><td>Проверка БКИ</td><td>{{ check.check_bki }}</td></tr>
                <tr><td>Проверка судебных дел</td><td>{{ check.check_court }}</td></tr>
                <tr><td>Проверка аффилированности</td><td>{{ check.check_affiliation }}</td></tr>
                <tr><td>Проверка в списке террористов</td><td>{{ check.check_terrorist }}</td></tr>
                <tr><td>Проверка нахождения в розыске</td><td>{{ check.check_mvd }}</td></tr>
                <tr><td>Проверка в открытых источниках</td><td>{{ check.check_internet }}</td></tr>
                <tr><td>Проверка Кронос</td><td>{{ check.check_cronos }}</td></tr>
                <tr><td>Проверка Крос</td><td>{{ check.check_cross }}</td></tr>
                <tr><td>Дополнительная информация</td><td>{{ check.check_addition }}</td></tr>
                <tr><td>Результат проверки</td><td>{{ check.resume }}</td></tr>
                <tr><td>Дата проверки</td><td>{{ check.date_check }}</td></tr>
                <tr><td>Сотрудник СБ</td><td>{{ check.officer }}</td></tr>
            </table>
            <a type="button" class="btn btn-primary"  href="{{ url_for('route.check', cand_id=candidate.id, check_id=checks[0].id) }}" target="_blank">Редактировать проверку</a>
            <a type="button" class="btn btn-info"  href="{{ url_for('route.registr', cand_id=candidate.id, check_id=checks[-1].id) }}" target="_blank">Открыть согласование</a>
            {% endfor %}
            {% endif %}
            {# если кандидат проверялся более 1 раза, создаем список старых проверок #}
            {% if checks|length > 1 %}
            {% for check in checks[:-1] %} {# загружаем проверки все кроме последней #}
            <table class="table table-hover">
                <tr><th colspan="2">Предыдущие проверки</th></tr>
                <tr><td>ID #{{ check.id }}</td><td><a href="{{ check.url }}">Материалы проверки</a></td></tr>
                <tr><td>Должность</td><td>{{ check.staff }}</td></tr>
                <tr><td>Кластер/Блок</td><td>{{ check.department }}</td></tr>
                <tr><td>Проверка работы в МТСБ</td><td>{{ check.former_employee }}</td></tr>
                <tr><td>Проверка по местам работы</td><td>{{ check.check_work_place }}</td></tr>
                <tr><td>Проверка паспорта</td><td>{{ check.check_passport }}</td></tr>
                <tr><td>Проверка ИНН</td><td>{{ check.check_inn }}</td></tr>
                <tr><td>Проверка ФССП</td><td>{{ check.check_debt }}</td></tr>
                <tr><td>Проверка банкротства</td><td>{{ check.check_bankruptcy }}</td></tr>
                <tr><td>Проверка БКИ</td><td>{{ check.check_bki }}</td></tr>
                <tr><td>Проверка судебных дел</td><td>{{ check.check_court }}</td></tr>
                <tr><td>Проверка аффилированности</td><td>{{ check.check_affiliation }}</td></tr>
                <tr><td>Проверка в списке террористов</td><td>{{ check.check_terrorist }}</td></tr>
                <tr><td>Проверка нахождения в розыске</td><td>{{ check.check_mvd }}</td></tr>
                <tr><td>Проверка в открытых источниках</td><td>{{ check.check_internet }}</td></tr>
                <tr><td>Проверка Кронос</td><td>{{ check.check_cronos }}</td></tr>
                <tr><td>Проверка Крос</td><td>{{ check.check_cross }}</td></tr>
                <tr><td>Дополнительная информация</td><td>{{ check.check_addition }}</td></tr>
                <tr><td>Результат проверки</td><td>{{ check.resume }}</td></tr>
                <tr><td>Дата проверки</td><td>{{ check.date_check }}</td></tr>
                <tr><td>Сотрудник СБ</td><td>{{ check.officer }}</td></tr>
            </table>
            {% endfor %}
            {% endif %}
        </div>
        <div class="tab-pane fade" id="registry">
            {% if registries|length > 0 %} {# если кандидат согласовывался ранее, создаем список согласований #}
            {% for registr in registries %}
            <table class="table table-hover">
                <tr><th colspan="2">ID #{{ registr.id }}</th></tr>
                <tr><td>Комментарий</td><td>{{ registr.marks }}</td></tr>
                <tr><td>Решение</td><td>{{ registr.decision }}</td></tr>
                <tr><td>Дата</td><td>{{ registr.dec_date }}</td></tr>
                <tr><td>Руководитель</td><td>{{ registr.supervisor }}</td></tr>
            </table>
            {% endfor %}
            {% endif %}
            <form>
                <a type="button" class="btn btn-primary" href="{{ url_for('route.registr', cand_id=candidate.id, check_id=0) }}">Открыть согласование</a>
            </form>
        </div>
        <div class="tab-pane fade" id="poligraf">
            {% if pfos|length > 0 %}
            {% for pfo in pfos %}
            <table class="table table-hover">
                <tr><th colspan="2">ID #{{ pfo.id }}</th></tr>
                <tr><td>Тематика</td><td>{{ pfo.theme }}</td></tr>
                <tr><td>Результат</td><td>{{ pfo.results }}</td></tr>
                <tr><td>Полиграфолог</td><td>{{ pfo.officer }}</td></tr>
                <tr><td>Дата проверки</td><td>{{ pfo.date_pfo }}</td></tr>
            </table>
            {% endfor %}
            {% endif %}
            <a type="button" class="btn btn-primary" href='{{ url_for("route.poligraf", cand_id=candidate.id) }}'>Добавить проверку</a>
        </div>
        <div class="tab-pane fade" id="investigate">
            {% if invs|length > 0 %}
            {% for inv in invs %}
            <table class="table table-hover">
                <tr><th colspan="2">ID #{{ inv.id }}</th></tr>
                <tr><td>Тематика</td><td>{{ inv.theme }}</td></tr>
                <tr><td>Информация</td><td>{{ inv.info }}</td></tr>
                <tr><td>Дата проверки</td><td>{{ inv.date_inv }}</td></tr>
            </table>
            {% endfor %}
            {% endif %}
            <a type="button" class="btn btn-primary" href="{{ url_for('route.investigation', cand_id=candidate.id) }}">Добавить проверку</a>
        </div>
        <div class="tab-pane fade" id="inquiry">
                {% if inquries|length > 0 %}
            {% for inqury in inquries %}
            <table class="table table-hover">
                <tr><th colspan="2">ID #{{ inqury.id }}</th></tr>
                <tr><td>Информация</td><td>{{ inqury.info }}</td></tr>
                <tr><td>Иннициатор</td><td>{{ inqury.initiator }}</td></tr>
                <tr><td>Дата запроса</td><td>{{ inqury.date_inq }}</td></tr>
            </table>
            {% endfor %}
            {% endif %}
            <a type="button" class="btn btn-primary" href="{{ url_for('route.inquiry', cand_id=candidate.id) }}">Добавить информацию</a>
        </div>
    </div>
</div>
{% endblock %}

